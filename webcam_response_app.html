    <script>
        // Variables globales
        let favorites = [];
        let currentResponse = '';
        let customResponse = '';
        let contextualResponse = '';
        let responseRatings = {};
        let userPatterns = {};
        let userBehaviorTracker = {
            warningsCount: 0,
            lastWarningTime: null,
            inappropriateMessages: 0,
            consecutiveWarnings: 0
        };
        let isExtremeMode = false;

        // Funciones bÃ¡sicas de datos
        function saveData() {
            console.log('Datos guardados en memoria de sesiÃ³n');
        }

        function loadData() {
            favorites = [];
            responseRatings = {};
            userPatterns = {};
        }

        // Base de datos de respuestas
        const responses = {
            coquetas: [
                "Â¿Sabes quÃ©? Creo que acabas de alegrarme el dÃ­a con ese comentario ğŸ˜Š",
                "Mmm, me gusta cÃ³mo piensas... cuÃ©ntame mÃ¡s",
                "Tienes buen gusto, debo admitirlo ğŸ˜‰",
                "Eres todo un encanto, Â¿lo sabÃ­as?",
                "Me haces sonreÃ­r sin poder evitarlo",
                "Vaya, vaya... alguien sabe cÃ³mo conquistar con palabras"
            ],
            divertidas: [
                "Â¡Ja! Definitivamente tienes sentido del humor, me caes bien",
                "Â¿En serio acabas de decir eso? Me has hecho reÃ­r en voz alta",
                "Eres mÃ¡s divertido de lo que esperaba... me gusta",
                "Ok, esa fue buena, te doy puntos por creatividad",
                "Â¿De dÃ³nde sacas estas ocurrencias? Me encanta tu mente"
            ],
            misteriosas: [
                "Hay algo en ti que me intriga... no logro descifrarte",
                "Mmm, interesante perspectiva... me haces pensar",
                "Tienes una forma muy particular de ver las cosas",
                "Hay mÃ¡s de lo que muestras, Â¿verdad?",
                "Me pregunto quÃ© otras sorpresas guardas"
            ],
            halagadoras: [
                "Wow, quÃ© detallista eres... se nota que tienes clase",
                "Me encanta cÃ³mo me haces sentir especial",
                "Tienes un don para hacer que una chica se sienta Ãºnica",
                "Eres increÃ­blemente dulce, Â¿sabes eso?",
                "Me fascina tu forma de expresarte"
            ],
            juguetonas: [
                "Â¿A que no te atreves a decir eso otra vez? ğŸ˜",
                "Uy, alguien estÃ¡ siendo travieso hoy...",
                "Me gusta este juego, pero yo tambiÃ©n sÃ© jugar",
                "Â¿Eso es todo lo que tienes? Esperaba mÃ¡s de ti",
                "Creo que subestimas mi lado juguetÃ³n"
            ],
            seductoras: [
                "Sabes exactamente quÃ© decir para captar mi atenciÃ³n",
                "Me gusta cÃ³mo me miras... a travÃ©s de la pantalla",
                "Tienes algo especial que me atrae",
                "Eres peligrosamente encantador",
                "Me haces sentir cosas que no esperaba"
            ],
            dulces: [
                "Eres tan tierno, me derrites el corazÃ³n ğŸ’•",
                "Tu dulzura me hace sonreÃ­r como tonta",
                "Me encantas cuando eres asÃ­ de adorable",
                "Tienes el corazÃ³n mÃ¡s bonito que he conocido"
            ],
            atrevidas: [
                "Mmm, me gusta tu lado atrevido ğŸ”¥",
                "Â¿AsÃ­ que quieres jugar con fuego?",
                "Me encanta cuando sacas tu lado salvaje",
                "Tienes ideas muy interesantes... me intrigas"
            ],
            romanticas: [
                "Eres como un sueÃ±o hecho realidad",
                "Me haces creer en los cuentos de hadas",
                "Tienes algo mÃ¡gico que me enamora",
                "Contigo el mundo se ve mÃ¡s bonito"
            ]
        };

        // Respuestas extremas atrevidas
        const extremeHotResponses = {
            seductive: [
                "Mmm, me encanta cuando eres asÃ­ de directo... me prendes ğŸ”¥",
                "Ay, me haces sentir cosas muy traviesas cuando hablas asÃ­ ğŸ˜ˆ",
                "Me tienes completamente mojada con esa actitud tuya ğŸ’¦",
                "Eres tan malo que me dan ganas de hacer cosas muy sucias contigo ğŸ”¥",
                "Me provocas tanto que no puedo evitar tocarme pensando en ti ğŸ˜"
            ],
            provocative: [
                "Â¿Te gusta lo que ves? Porque a mÃ­ me gusta mucho provocarte ğŸ˜ˆ",
                "Estoy pensando en ti de maneras muy, muy traviesas ahora mismo ğŸ’‹",
                "Me tienes tan caliente que necesito refrescarme... o mejor aÃºn, calentarme mÃ¡s contigo ğŸ”¥",
                "Eres tan irresistible que me dan ganas de hacer travesuras juntos ğŸ˜"
            ],
            dominant: [
                "Me gusta cuando intentas ser dominante... pero yo tambiÃ©n sÃ© cÃ³mo tomar el control ğŸ˜ˆ",
                "Â¿Crees que puedes manejarme? Te aseguro que soy mÃ¡s traviesa de lo que imaginas ğŸ”¥",
                "Me excita tu actitud, pero espera a ver lo que puedo hacer yo contigo ğŸ’‹",
                "Â¿Quieres jugar rudo? Perfecto, porque a mÃ­ me gusta cuando es intenso ğŸ˜"
            ],
            naughty: [
                "Uy, quÃ© travieso eres... me das ideas muy sucias ğŸ˜ˆ",
                "Me haces pensar en cosas que no deberÃ­a, pero que quiero hacer contigo ğŸ”¥",
                "Eres tan malo que me sacas mi lado mÃ¡s pervertido ğŸ’‹",
                "Me encanta cuando eres asÃ­ de cochino, me prendes toda ğŸ’¦"
            ]
        };

        // Sistema de moderaciÃ³n
        const moderationSystem = {
            inappropriate: {
                mild: ['tonto', 'idiota', 'estÃºpido', 'imbÃ©cil'],
                moderate: ['puta', 'zorra', 'perra', 'cabrÃ³n'],
                severe: ['matar', 'morir', 'suicidio', 'muerte'],
                harassment: ['acoso', 'perseguir', 'stalkear', 'obsesiÃ³n'],
                explicit: ['follar', 'coger', 'penetrar', 'masturbaciÃ³n']
            },
            responses: {
                mild: [
                    "Prefiero mantener nuestra conversaciÃ³n en un tono mÃ¡s amable y respetuoso ğŸ˜Š",
                    "Me gusta mÃ¡s cuando usamos palabras bonitas para comunicarnos"
                ],
                moderate: [
                    "Aprecio mucho el respeto mutuo en nuestras conversaciones",
                    "Me siento mÃ¡s cÃ³moda cuando hablamos con educaciÃ³n"
                ],
                severe: [
                    "No me siento cÃ³moda con este tipo de comentarios. Te agradecerÃ­a que cambiÃ¡ramos de tema",
                    "Creo que serÃ­a mejor si dirigimos nuestra conversaciÃ³n hacia algo mÃ¡s positivo"
                ],
                harassment: [
                    "Me parece importante establecer lÃ­mites saludables en nuestra interacciÃ³n",
                    "Prefiero mantener una distancia apropiada y respetuosa"
                ],
                explicit: [
                    "Mantengo conversaciones mÃ¡s elegantes y sofisticadas",
                    "Prefiero conversaciones que tengan mÃ¡s clase y sustancia"
                ]
            }
        };

        // Diccionario completo de traducciones
        const translations = {
            // Saludos y expresiones bÃ¡sicas
            'hola': 'hello', 'hi': 'hi', 'hey': 'hey', 'buenas': 'good', 'buenos dÃ­as': 'good morning',
            'buenas noches': 'good night', 'buenas tardes': 'good afternoon',
            
            // TÃ©rminos cariÃ±osos
            'amor': 'love', 'cariÃ±o': 'honey', 'corazÃ³n': 'heart', 'bebÃ©': 'baby', 'cielo': 'sky',
            'mi vida': 'my life', 'princesa': 'princess', 'reina': 'queen', 'tesoro': 'treasure',
            
            // Adjetivos positivos
            'hermosa': 'beautiful', 'bella': 'gorgeous', 'linda': 'pretty', 'sexy': 'sexy',
            'guapa': 'beautiful', 'preciosa': 'precious', 'bonita': 'cute', 'divina': 'divine',
            'perfecta': 'perfect', 'increÃ­ble': 'incredible', 'fantÃ¡stica': 'fantastic',
            'espectacular': 'spectacular', 'maravillosa': 'wonderful', 'genial': 'amazing',
            
            // Emociones y sentimientos
            'me gusta': 'I like', 'me encanta': 'I love', 'me fascina': 'I\'m fascinated',
            'adoro': 'I adore', 'amo': 'I love', 'quiero': 'I want', 'deseo': 'I desire',
            'feliz': 'happy', 'contenta': 'happy', 'triste': 'sad', 'emocionada': 'excited',
            'nerviosa': 'nervous', 'tranquila': 'calm', 'relajada': 'relaxed',
            
            // Acciones y verbos
            'beso': 'kiss', 'besos': 'kisses', 'abrazo': 'hug', 'abrazos': 'hugs',
            'sonreÃ­r': 'smile', 'reÃ­r': 'laugh', 'llorar': 'cry', 'pensar': 'think',
            'sentir': 'feel', 'ver': 'see', 'mirar': 'look', 'escuchar': 'listen',
            'hablar': 'talk', 'decir': 'say', 'hacer': 'do', 'venir': 'come',
            
            // Tiempo
            'hoy': 'today', 'maÃ±ana': 'tomorrow', 'ayer': 'yesterday', 'ahora': 'now',
            'luego': 'later', 'despuÃ©s': 'after', 'antes': 'before', 'siempre': 'always',
            'nunca': 'never', 'a veces': 'sometimes', 'tarde': 'late', 'temprano': 'early',
            
            // Conectores
            'pero': 'but', 'y': 'and', 'o': 'or', 'porque': 'because', 'aunque': 'although',
            'sin embargo': 'however', 'ademÃ¡s': 'besides', 'tambiÃ©n': 'also', 'tampoco': 'neither',
            
            // Palabras bÃ¡sicas
            'sÃ­': 'yes', 'no': 'no', 'tal vez': 'maybe', 'quizÃ¡s': 'perhaps', 'claro': 'of course',
            'por supuesto': 'of course', 'exacto': 'exactly', 'verdad': 'true', 'mentira': 'lie',
            
            // Preposiciones y artÃ­culos
            'de': 'of', 'en': 'in', 'con': 'with', 'sin': 'without', 'para': 'for', 'por': 'by',
            'la': 'the', 'el': 'the', 'un': 'a', 'una': 'a', 'este': 'this', 'esta': 'this',
            
            // Pronombres
            'yo': 'I', 'tÃº': 'you', 'Ã©l': 'he', 'ella': 'she', 'nosotros': 'we', 'ustedes': 'you',
            'me': 'me', 'te': 'you', 'le': 'him/her', 'nos': 'us', 'les': 'them',
            
            // Verbos comunes
            'soy': 'I am', 'eres': 'you are', 'es': 'is', 'somos': 'we are', 'son': 'they are',
            'tengo': 'I have', 'tienes': 'you have', 'tiene': 'has', 'tenemos': 'we have',
            'voy': 'I go', 'vas': 'you go', 'va': 'goes', 'vamos': 'we go', 'van': 'they go',
            'puedo': 'I can', 'puedes': 'you can', 'puede': 'can', 'podemos': 'we can',
            'estoy': 'I am', 'estÃ¡s': 'you are', 'estÃ¡': 'is', 'estamos': 'we are',
            
            // Adjetivos y adverbios
            'muy': 'very', 'mÃ¡s': 'more', 'menos': 'less', 'mejor': 'better', 'peor': 'worse',
            'grande': 'big', 'pequeÃ±a': 'small', 'alto': 'tall', 'bajo': 'short',
            'bueno': 'good', 'malo': 'bad', 'nuevo': 'new', 'viejo': 'old',
            
            // Interrogativos
            'quÃ©': 'what', 'quiÃ©n': 'who', 'cuÃ¡ndo': 'when', 'dÃ³nde': 'where', 'cÃ³mo': 'how',
            'por quÃ©': 'why', 'cuÃ¡nto': 'how much', 'cuÃ¡l': 'which',
            
            // CortesÃ­a
            'gracias': 'thank you', 'de nada': 'you\'re welcome', 'por favor': 'please',
            'disculpa': 'excuse me', 'perdÃ³n': 'sorry', 'lo siento': 'I\'m sorry'
        };

        // Base de datos temÃ¡tica
        const themeDatabase = {
            amor: ['amor', 'corazÃ³n', 'sentimientos', 'romance'],
            belleza: ['hermosa', 'bella', 'linda', 'preciosa'],
            deseo: ['quiero', 'deseo', 'me gusta', 'necesito'],
            felicidad: ['feliz', 'alegre', 'contento', 'sonrisa']
        };

        // FUNCIÃ“N 1: Generar por categorÃ­a
        function generateByCategory(category) {
            if (!responses[category]) {
                alert('CategorÃ­a no encontrada');
                return;
            }
            const categoryResponses = responses[category];
            const randomResponse = categoryResponses[Math.floor(Math.random() * categoryResponses.length)];
            currentResponse = randomResponse;
            displayResponseWithRating('generatedResponse', randomResponse, category);
        }

        // FUNCIÃ“N 2: Detectar tema
        function detectTheme(keyword) {
            for (const theme in themeDatabase) {
                if (themeDatabase[theme].some(function(word) {
                    return keyword.includes(word) || word.includes(keyword);
                })) {
                    return theme;
                }
            }
            return 'general';
        }

        // FUNCIÃ“N 3: Generar respuesta inteligente
        function generateIntelligentResponse(keyword, theme, style, intensity) {
            const styleTemplates = {
                flirty: {
                    amor: ["El amor... quÃ© tema tan profundo para una conversaciÃ³n ğŸ˜"],
                    general: ["Me gusta cÃ³mo piensas sobre estos temas ğŸ˜‰"]
                },
                sweet: {
                    amor: ["El amor es lo mÃ¡s hermoso del mundo ğŸ’•"],
                    general: ["Eres tan tierno cuando hablas de eso ğŸ’•"]
                },
                seductive: {
                    general: ["Sabes cÃ³mo encenderme con esas palabras ğŸ”¥"]
                },
                friendly: {
                    general: ["Me gusta mucho tu perspectiva sobre esto"]
                }
            };

            const responses = styleTemplates[style] || styleTemplates.friendly;
            const themeResponses = responses[theme] || responses.general;
            let response = themeResponses[Math.floor(Math.random() * themeResponses.length)];

            // Ajustar intensidad
            const emojis = ['', 'ğŸ˜Š', 'ğŸ˜‰', 'ğŸ˜', 'ğŸ”¥'];
            if (intensity > 1 && intensity <= 5) {
                response += ' ' + emojis[intensity - 1];
            }

            return response;
        }

        // FUNCIÃ“N 4: Generador personalizado avanzado (con modo extremo)
        function generateAdvancedCustom() {
            const keyword = document.getElementById('customKeyword').value.trim();
            const style = document.getElementById('responseStyle').value;
            const intensity = parseInt(document.getElementById('intensityLevel').value);

            if (!keyword) {
                alert('Por favor ingresa una palabra clave');
                return;
            }

            let response;
            
            // Si estÃ¡ en MODO EXTREMO, generar respuestas sÃºper atrevidas
            if (isExtremeMode) {
                response = generateExtremeCustomResponse(keyword, style, intensity);
                customResponse = response;
                displayExtremeResponse('customResponse', response);
                return;
            }

            // Modo normal
            const detectedTheme = detectTheme(keyword.toLowerCase());
            response = generateIntelligentResponse(keyword, detectedTheme, style, intensity);

            customResponse = response;
            displayResponseWithRating('customResponse', response, 'custom');
        }

        // Nueva funciÃ³n para generar respuestas personalizadas extremas
        function generateExtremeCustomResponse(keyword, style, intensity) {
            const extremeCustomTemplates = {
                flirty: {
                    amor: [
                        `El amor... mmm, me pones a pensar en cosas muy traviesas ğŸ”¥`,
                        `Hablar de amor contigo me tiene toda excitada ğŸ˜ˆ`,
                        `Me gusta cuando mencionas el amor... me calientas tanto ğŸ’¦`
                    ],
                    belleza: [
                        `La belleza... como la tuya que me tiene completamente mojada ğŸ’¦`,
                        `Me encanta que valores la belleza, especialmente cuando me miras asÃ­ ğŸ”¥`,
                        `Sabes apreciar lo bello... y yo sÃ© cÃ³mo ser muy bella para ti ğŸ˜ˆ`
                    ],
                    deseo: [
                        `El deseo... mmm, sabes cÃ³mo despertar el mÃ­o completamente ğŸ¥µ`,
                        `Me gusta cuando hablas de deseo, me prendes toda ğŸ”¥`,
                        `Tu forma de expresar el deseo me vuelve loca de ganas ğŸ’‹`
                    ],
                    felicidad: [
                        `La felicidad... me haces tan feliz que quiero celebrarlo contigo de formas muy Ã­ntimas ğŸ˜ˆ`,
                        `Tu alegrÃ­a es tan contagiosa que me dan ganas de hacerte muy feliz tambiÃ©n ğŸ”¥`,
                        `Me pones tan contenta que quiero demostrÃ¡rtelo de maneras muy traviesas ğŸ’¦`
                    ],
                    general: [
                        `Mmm, me encanta cÃ³mo piensas sobre eso... me tienes toda caliente ğŸ”¥`,
                        `Tu forma de hablar de eso me pone muy traviesa ğŸ˜ˆ`,
                        `Me gusta tu perspectiva... me dan ganas de hacer cosas sucias contigo ğŸ’¦`
                    ]
                },
                sweet: {
                    amor: [
                        `El amor... ay, me derrites tanto que quiero darte todo mi cuerpo ğŸ’•ğŸ”¥`,
                        `Eres tan dulce hablando de amor que me dan ganas de ser muy mala contigo ğŸ˜ˆ`,
                        `Tu ternura me excita de maneras que no puedo explicar ğŸ’‹`
                    ],
                    belleza: [
                        `La belleza... como la forma tan sexy en que me hablas ğŸ¥µ`,
                        `Me derrites con tu dulzura, pero tambiÃ©n me prendes mucho ğŸ”¥`,
                        `Eres tan tierno que me dan ganas de ser muy traviesa contigo ğŸ˜ˆ`
                    ],
                    general: [
                        `Eres tan dulce que me provocas hacer cosas muy sucias ğŸ’¦`,
                        `Tu ternura me excita de formas increÃ­bles ğŸ”¥`,
                        `Me derrites tanto que quiero darte todo de mÃ­ ğŸ˜ˆ`
                    ]
                },
                seductive: {
                    pasion: [
                        `La pasiÃ³n... sabes cÃ³mo encender la mÃ­a completamente ğŸ”¥`,
                        `Me gusta tu lado apasionado... me tienes empapada ğŸ’¦`,
                        `Tu pasiÃ³n despierta mi lado mÃ¡s salvaje y cochino ğŸ˜ˆ`
                    ],
                    deseo: [
                        `El deseo... mmm, el tuyo me vuelve loca de ganas ğŸ¥µ`,
                        `Tu forma de desear me tiene completamente entregada ğŸ’‹`,
                        `Me encanta cÃ³mo expresas tu deseo... me tienes ardiendo ğŸ”¥`
                    ],
                    general: [
                        `Sabes cÃ³mo volverme loca con esas palabras ğŸ”¥`,
                        `Me tienes completamente sometida a tu seducciÃ³n ğŸ˜ˆ`,
                        `Tu forma de hablar me tiene toda mojada ğŸ’¦`
                    ]
                },
                mysterious: {
                    general: [
                        `Hay algo muy sexy en tu misterio... me excita no saber quÃ© planeas hacerme ğŸ”¥`,
                        `Tu lado enigmÃ¡tico me tiene intrigada y muy caliente ğŸ˜ˆ`,
                        `Me fascina tu misterio... me dan ganas de descubrir todos tus secretos sucios ğŸ’¦`
                    ]
                },
                funny: {
                    trabajo: [
                        `Â¡El trabajo! Prefiero trabajar en hacerte gemir de placer ğŸ˜ˆ`,
                        `Â¿Trabajo? El Ãºnico trabajo que quiero es complacerte toda la noche ğŸ”¥`,
                        `Mejor trabajemos juntos en algo mucho mÃ¡s divertido y cochino ğŸ’¦`
                    ],
                    general: [
                        `Jajaja, eres tan gracioso que me dan ganas de premiarte de formas muy traviesas ğŸ˜ˆ`,
                        `Tu humor me excita tanto como me hace reÃ­r ğŸ”¥`,
                        `Eres tan divertido que quiero hacer cosas muy sucias contigo ğŸ’¦`
                    ]
                },
                friendly: {
                    general: [
                        `Me gusta tu perspectiva... pero me gusta mÃ¡s imaginarte desnudo ğŸ˜ˆ`,
                        `Eres muy interesante... especialmente cuando pienso en todas las cosas cochinas que podrÃ­amos hacer ğŸ”¥`,
                        `Tu forma de pensar me excita mucho ğŸ’¦`
                    ]
                }
            };

            // Detectar tema
            const theme = detectTheme(keyword.toLowerCase());
            
            // Seleccionar templates
            const styleTemplates = extremeCustomTemplates[style] || extremeCustomTemplates.friendly;
            const themeTemplates = styleTemplates[theme] || styleTemplates.general;
            
            let baseResponse = themeTemplates[Math.floor(Math.random() * themeTemplates.length)];
            
            // Ajustar intensidad extrema
            const extremeIntensityModifiers = {
                1: { additions: [' Me tienes pensando cosas traviesas'] },
                2: { additions: [' Me prendes mucho', ' Me tienes caliente'] },
                3: { additions: [' Me vuelves loca', ' Me tienes mojada', ' Me excitas tanto'] },
                4: { additions: [' Me tienes ardiendo', ' Quiero hacer cosas sucias contigo', ' Me tienes completamente entregada'] },
                5: { additions: [' Me vuelves una perra en celo', ' Quiero que me cojas ahora mismo', ' Me tienes desesperada por ti'] }
            };
            
            const modifier = extremeIntensityModifiers[intensity] || extremeIntensityModifiers[3];
            const addition = modifier.additions[Math.floor(Math.random() * modifier.additions.length)];
            
            return baseResponse + addition;
        }

        // FUNCIÃ“N 5: Moderar contenido
        function moderateContent(message) {
            if (isExtremeMode) {
                return { isAppropriate: true, severity: 'none', type: 'none', response: null };
            }

            const lowerMessage = message.toLowerCase();
            
            for (const severity in moderationSystem.inappropriate) {
                const words = moderationSystem.inappropriate[severity];
                for (let i = 0; i < words.length; i++) {
                    if (lowerMessage.includes(words[i])) {
                        const responses = moderationSystem.responses[severity];
                        return {
                            isAppropriate: false,
                            severity: severity,
                            type: severity,
                            response: responses[Math.floor(Math.random() * responses.length)]
                        };
                    }
                }
            }

            return { isAppropriate: true, severity: 'none', type: 'none', response: null };
        }

        // FUNCIÃ“N 6: Generar respuesta extrema
        function generateExtremeResponse(message) {
            const lowerMessage = message.toLowerCase();
            let category = 'seductive';
            
            if (lowerMessage.includes('quiero') || lowerMessage.includes('deseo')) {
                category = 'seductive';
            } else if (lowerMessage.includes('mira') || lowerMessage.includes('ve')) {
                category = 'provocative';
            } else if (lowerMessage.includes('ven') || lowerMessage.includes('hazlo')) {
                category = 'dominant';
            } else if (lowerMessage.includes('traviesa') || lowerMessage.includes('cochina')) {
                category = 'naughty';
            }
            
            const responses = extremeHotResponses[category];
            return responses[Math.floor(Math.random() * responses.length)];
        }

        // FUNCIÃ“N 7: Analizar mensaje del usuario
        function analyzeUserMessage(message) {
            const words = message.toLowerCase().split(/\s+/);
            words.forEach(function(word) {
                const cleanWord = word.replace(/[^\w\sÃ¡Ã©Ã­Ã³ÃºÃ±Ã¼]/gi, '');
                if (cleanWord.length > 2) {
                    if (!userPatterns[cleanWord]) {
                        userPatterns[cleanWord] = 0;
                    }
                    userPatterns[cleanWord]++;
                }
            });
            saveData();
        }

        // FUNCIÃ“N 8: AnÃ¡lisis avanzado
        function analyzeUserMessageAdvanced(message) {
            const lowerMessage = message.toLowerCase();
            let intent = 'chat';

            if (lowerMessage.includes('?')) intent = 'question';
            if (lowerMessage.includes('hola') || lowerMessage.includes('hi')) intent = 'greeting';
            if (lowerMessage.includes('hermosa') || lowerMessage.includes('bella')) intent = 'compliment';
            if (lowerMessage.includes('gracias')) intent = 'gratitude';
            if (lowerMessage.includes('ja') || lowerMessage.includes('jeje')) intent = 'humor';

            analyzeUserMessage(message);

            return {
                intent: intent,
                length: message.split(' ').length
            };
        }

        // FUNCIÃ“N 9: Generar respuesta contextual
        function generateContextualResponse() {
            const userMessage = document.getElementById('userMessage').value.trim();
            const responseType = document.getElementById('responseType').value;

            if (!userMessage) {
                alert('Por favor pega el mensaje del usuario');
                return;
            }

            let response = '';

            // Modo extremo
            if (isExtremeMode) {
                response = generateExtremeResponse(userMessage);
                contextualResponse = response;
                displayExtremeResponse('contextualResponse', response);
                return;
            }

            // ModeraciÃ³n normal
            const moderationResult = moderateContent(userMessage);
            if (!moderationResult.isAppropriate) {
                response = moderationResult.response;
                contextualResponse = response;
                displayModerationResponse('contextualResponse', response, moderationResult);
                return;
            }

            // AnÃ¡lisis normal
            const analysis = analyzeUserMessageAdvanced(userMessage);

            if (responseType === 'auto') {
                if (analysis.intent === 'greeting') {
                    response = "Â¡Hola! QuÃ© alegrÃ­a verte por aquÃ­ ğŸ˜Š";
                } else if (analysis.intent === 'compliment') {
                    response = "Aww, me haces sonrojar ğŸ˜Š TÃº tambiÃ©n eres muy dulce";
                } else if (analysis.intent === 'question') {
                    response = "QuÃ© pregunta tan interesante... me gusta cÃ³mo piensas";
                } else if (analysis.intent === 'gratitude') {
                    response = "De nada, amor. Me encanta hacerte feliz ğŸ’•";
                } else if (analysis.intent === 'humor') {
                    response = "Â¡Jajaja! Me encanta tu sentido del humor ğŸ˜‚";
                } else {
                    response = "Me gusta mucho hablar contigo, tienes algo especial";
                }
            } else {
                switch(responseType) {
                    case 'compliment': response = "Aww, me haces sonrojar ğŸ˜Š"; break;
                    case 'question': response = "QuÃ© pregunta tan interesante"; break;
                    case 'request': response = "Me gusta cuando eres directo ğŸ˜‰"; break;
                    case 'joke': response = "Â¡Jajaja! Me encanta tu humor ğŸ˜‚"; break;
                    case 'flirt': response = "Mmm, me gusta cÃ³mo suena eso ğŸ˜"; break;
                    case 'thanks': response = "De nada, amor ğŸ’•"; break;
                    default: response = "Me fascina tu personalidad"; break;
                }
            }

            contextualResponse = response;
            displayResponseWithRating('contextualResponse', response, 'contextual');
        }

        // FUNCIÃ“N 10: Alternar modo extremo (mejorada con indicadores)
        function toggleExtremeMode() {
            isExtremeMode = !isExtremeMode;
            const button = document.querySelector('.extreme-toggle');
            const indicator = document.querySelector('.mode-indicator');
            const intensityIndicator = document.querySelector('.intensity-indicator');

            if (isExtremeMode) {
                button.style.background = 'linear-gradient(45deg, #e74c3c, #c0392b)';
                button.innerHTML = 'ğŸ”¥ MODO EXTREMO ON';
                indicator.innerHTML = '<span style="color: #e74c3c; font-weight: bold;">ğŸ”¥ MODO EXTREMO ACTIVADO</span>';
                
                // Actualizar indicador de intensidad
                if (intensityIndicator) {
                    updateIntensityIndicator();
                }
                
                alert('ğŸ”¥ MODO EXTREMO ACTIVADO\n\nâ€¢ Respuestas sÃºper atrevidas y provocativas\nâ€¢ Generador personalizado extremo\nâ€¢ AnÃ¡lisis contextual sin moderaciÃ³n');
            } else {
                button.style.background = 'linear-gradient(45deg, #95a5a6, #7f8c8d)';
                button.innerHTML = 'ğŸ”¥ Modo Extremo';
                indicator.innerHTML = '<span style="color: #27ae60;">âœ“ Modo Normal</span>';
                
                // Limpiar indicador de intensidad
                if (intensityIndicator) {
                    intensityIndicator.innerHTML = '';
                }
                
                alert('âœ“ Modo normal activado - Respuestas elegantes y profesionales');
            }
        }

        // Nueva funciÃ³n para actualizar indicador de intensidad
        function updateIntensityIndicator() {
            const intensityLevel = document.getElementById('intensityLevel');
            const intensityIndicator = document.querySelector('.intensity-indicator');
            
            if (!intensityIndicator || !intensityLevel) return;
            
            const level = parseInt(intensityLevel.value);
            
            if (isExtremeMode) {
                const extremeLabels = {
                    1: 'ğŸ”¥ Traviesa',
                    2: 'ğŸ”¥ Caliente', 
                    3: 'ğŸ”¥ Ardiente',
                    4: 'ğŸ”¥ Salvaje',
                    5: 'ğŸ”¥ EXTREMO'
                };
                intensityIndicator.innerHTML = `<span style="color: #e74c3c;">${extremeLabels[level]}</span>`;
            } else {
                const normalLabels = {
                    1: 'ğŸ˜Š Suave',
                    2: 'ğŸ˜‰ Coqueta',
                    3: 'ğŸ˜ Juguetona', 
                    4: 'ğŸ”¥ Intensa',
                    5: 'ğŸ’‹ Seductora'
                };
                intensityIndicator.innerHTML = `<span style="color: #3498db;">${normalLabels[level]}</span>`;
            }
        }

        // FUNCIÃ“N 11: Mostrar respuesta con rating
        function displayResponseWithRating(elementId, response, type) {
            const element = document.getElementById(elementId);
            if (!element) return;

            const safeResponse = response.replace(/'/g, "&#39;").replace(/"/g, "&quot;");

            element.innerHTML =
                '<div class="response-text">' + response + '</div>' +
                '<div style="display: flex; gap: 10px; margin-top: 15px; align-items: center;">' +
                    '<span style="font-size: 12px; opacity: 0.8;">Â¿Te gustÃ³ esta respuesta?</span>' +
                    '<button onclick="rateResponse(\'' + safeResponse + '\', \'' + type + '\', \'like\')" ' +
                            'style="background: #2ecc71; border: none; color: white; padding: 5px 10px; border-radius: 15px; cursor: pointer; font-size: 12px;">' +
                        'ğŸ‘ Me gusta' +
                    '</button>' +
                    '<button onclick="rateResponse(\'' + safeResponse + '\', \'' + type + '\', \'dislike\')" ' +
                            'style="background: #e74c3c; border: none; color: white; padding: 5px 10px; border-radius: 15px; cursor: pointer; font-size: 12px;">' +
                        'ğŸ‘ No me gusta' +
                    '</button>' +
                '</div>';
        }

        // FUNCIÃ“N 12: Mostrar respuesta extrema
        function displayExtremeResponse(elementId, response) {
            const element = document.getElementById(elementId);
            if (!element) return;

            element.innerHTML =
                '<div style="background: linear-gradient(135deg, #e74c3c, #c0392b); border-radius: 10px; padding: 20px; border-left: 4px solid #fff;">' +
                    '<div style="display: flex; align-items: center; margin-bottom: 10px;">' +
                        '<span style="background: #fff; color: #e74c3c; padding: 4px 8px; border-radius: 12px; font-size: 11px; margin-right: 10px; font-weight: bold;">ğŸ”¥ EXTREMO</span>' +
                        '<span style="font-size: 12px; opacity: 0.9;">Modo sÃºper atrevido activado</span>' +
                    '</div>' +
                    '<div class="response-text" style="font-size: 16px; font-weight: 500; color: #fff;">' + response + '</div>' +
                '</div>' +
                '<div style="display: flex; gap: 10px; margin-top: 15px; align-items: center;">' +
                    '<span style="font-size: 12px; opacity: 0.8;">Â¿Te gustÃ³ esta respuesta extrema?</span>' +
                    '<button onclick="rateExtremeResponse(\'like\')" ' +
                            'style="background: #e74c3c; border: none; color: white; padding: 5px 10px; border-radius: 15px; cursor: pointer; font-size: 12px;">' +
                        'ğŸ”¥ Me encanta' +
                    '</button>' +
                    '<button onclick="rateExtremeResponse(\'dislike\')" ' +
                            'style="background: #95a5a6; border: none; color: white; padding: 5px 10px; border-radius: 15px; cursor: pointer; font-size: 12px;">' +
                        'ğŸ˜… Muy fuerte' +
                    '</button>' +
                '</div>';
        }

        // FUNCIÃ“N 13: Mostrar respuesta de moderaciÃ³n
        function displayModerationResponse(elementId, response, moderationResult) {
            const element = document.getElementById(elementId);
            if (!element) return;

            const severityColors = {
                mild: '#f39c12',
                moderate: '#e67e22',
                severe: '#e74c3c',
                harassment: '#c0392b',
                explicit: '#8e44ad'
            };

            const severityColor = severityColors[moderationResult.severity] || '#95a5a6';

            element.innerHTML =
                '<div style="background: rgba(230, 126, 34, 0.1); border-left: 4px solid ' + severityColor + '; padding: 15px; border-radius: 8px; margin-bottom: 10px;">' +
                    '<div style="display: flex; align-items: center; margin-bottom: 10px;">' +
                        '<span style="background: ' + severityColor + '; color: white; padding: 4px 8px; border-radius: 12px; font-size: 11px; margin-right: 10px;">MODERADO</span>' +
                        '<span style="font-size: 12px; opacity: 0.8;">Respuesta automÃ¡tica por contenido inapropiado</span>' +
                    '</div>' +
                    '<div class="response-text" style="font-style: normal;">' + response + '</div>' +
                '</div>';
        }

        // FUNCIÃ“N 14: Calificar respuesta
        function rateResponse(response, type, rating) {
            const cleanResponse = response.replace(/&#39;/g, "'").replace(/&quot;/g, '"');
            const key = cleanResponse.substring(0, 50);

            if (!responseRatings[key]) {
                responseRatings[key] = { likes: 0, dislikes: 0, type: type, fullText: cleanResponse };
            }

            if (rating === 'like') {
                responseRatings[key].likes++;
                alert('Â¡Gracias! TomarÃ© en cuenta que te gustÃ³ esta respuesta ğŸ˜Š');
            } else {
                responseRatings[key].dislikes++;
                alert('Entendido, buscarÃ© respuestas mejores la prÃ³xima vez ğŸ¤”');
            }

            saveData();
        }

        // FUNCIÃ“N 15: Calificar respuesta extrema
        function rateExtremeResponse(rating) {
            if (rating === 'like') {
                alert('ğŸ”¥ Â¡Perfecto! SeguirÃ© siendo asÃ­ de atrevida y provocativa');
            } else {
                alert('ğŸ˜… Entendido, bajarÃ© un poco la intensidad pero seguirÃ© siendo traviesa');
            }
        }

        // FUNCIÃ“N 16: Solo moderar
        function checkModerationOnly() {
            const userMessage = document.getElementById('userMessage').value.trim();

            if (!userMessage) {
                alert('Por favor pega el mensaje del usuario para moderar');
                return;
            }

            const moderationResult = moderateContent(userMessage);
            const element = document.getElementById('contextualResponse');

            if (moderationResult.isAppropriate) {
                element.innerHTML =
                    '<div style="background: rgba(46, 204, 113, 0.1); border-left: 4px solid #27ae60; padding: 15px; border-radius: 8px;">' +
                        '<div style="display: flex; align-items: center; margin-bottom: 10px;">' +
                            '<span style="background: #27ae60; color: white; padding: 4px 8px; border-radius: 12px; font-size: 11px; margin-right: 10px;">âœ“ APROPIADO</span>' +
                            '<span style="font-size: 12px; opacity: 0.8;">El mensaje es apropiado para responder</span>' +
                        '</div>' +
                        '<div style="font-size: 14px;">Puedes responder normalmente a este mensaje.</div>' +
                    '</div>';
            } else {
                element.innerHTML =
                    '<div style="background: rgba(231, 76, 60, 0.1); border-left: 4px solid #e74c3c; padding: 15px; border-radius: 8px;">' +
                        '<div style="display: flex; align-items: center; margin-bottom: 10px;">' +
                            '<span style="background: #e74c3c; color: white; padding: 4px 8px; border-radius: 12px; font-size: 11px; margin-right: 10px;">âš  INAPROPIADO</span>' +
                            '<span style="font-size: 12px; opacity: 0.8;">Contenido detectado como inapropiado</span>' +
                        '</div>' +
                        '<div style="font-size: 14px; margin-bottom: 10px;"><strong>Respuesta sugerida:</strong></div>' +
                        '<div style="font-style: italic; background: rgba(0,0,0,0.1); padding: 10px; border-radius: 6px;">' +
                            moderationResult.response +
                        '</div>' +
                    '</div>';
            }
        }

        // FUNCIÃ“N 17: Traductor completamente reescrito y mejorado
        function translateResponse(elementId) {
            const element = document.getElementById(elementId);
            if (!element) return;

            const responseDiv = element.querySelector('.response-text');
            if (!responseDiv) {
                alert('Primero genera una respuesta para traducir');
                return;
            }

            const text = responseDiv.textContent.trim();
            if (!text || text.includes('Haz clic') || text.includes('Configura') || text.includes('Pega el mensaje')) {
                alert('Primero genera una respuesta para traducir');
                return;
            }

            // SISTEMA DE TRADUCCIÃ“N INTELIGENTE
            const translatedText = intelligentTranslate(text);
            
            const safeText = text.replace(/'/g, "&#39;").replace(/"/g, "&quot;");
            const safeTranslation = translatedText.replace(/'/g, "&#39;").replace(/"/g, "&quot;");

            element.innerHTML =
                '<div style="margin-bottom: 15px;">' +
                    '<div style="background: rgba(255,255,255,0.1); padding: 10px; border-radius: 8px; border-left: 3px solid #ff6b6b;">' +
                        '<strong>ğŸ‡ªğŸ‡¸ EspaÃ±ol:</strong><br>' + text +
                    '</div>' +
                '</div>' +
                '<div style="background: rgba(46, 204, 113, 0.2); padding: 15px; border-radius: 8px; border-left: 3px solid #2ecc71;">' +
                    '<strong>ğŸ‡ºğŸ‡¸ English:</strong><br>' +
                    '<span style="font-size: 16px; font-weight: 500;">' + translatedText + '</span>' +
                '</div>' +
                '<div style="display: flex; gap: 10px; margin-top: 15px;">' +
                    '<button onclick="restoreOriginal(\'' + elementId + '\', \'' + safeText + '\')" ' +
                            'style="padding: 8px 15px; font-size: 12px; background: linear-gradient(45deg, #95a5a6, #7f8c8d); border: none; color: white; border-radius: 20px; cursor: pointer;">' +
                        'ğŸ”„ Volver al original' +
                    '</button>' +
                    '<button onclick="copyToClipboard(\'' + safeTranslation + '\')" ' +
                            'style="padding: 8px 15px; font-size: 12px; background: linear-gradient(45deg, #3498db, #2980b9); border: none; color: white; border-radius: 20px; cursor: pointer;">' +
                        'ğŸ“‹ Copiar traducciÃ³n' +
                    '</button>' +
                '</div>';
        }

        // Nueva funciÃ³n de traducciÃ³n inteligente
        function intelligentTranslate(spanishText) {
            // Base de traducciones completas de frases comunes
            const completeTranslations = {
                // Respuestas coquetas
                "Â¿Sabes quÃ©? Creo que acabas de alegrarme el dÃ­a con ese comentario": "You know what? I think you just made my day with that comment",
                "Mmm, me gusta cÃ³mo piensas... cuÃ©ntame mÃ¡s": "Mmm, I like how you think... tell me more",
                "Tienes buen gusto, debo admitirlo": "You have good taste, I must admit",
                "Eres todo un encanto, Â¿lo sabÃ­as?": "You're quite charming, did you know that?",
                "Me haces sonreÃ­r sin poder evitarlo": "You make me smile without being able to help it",
                "Vaya, vaya... alguien sabe cÃ³mo conquistar con palabras": "Well, well... someone knows how to charm with words",
                
                // Respuestas divertidas
                "Â¡Ja! Definitivamente tienes sentido del humor, me caes bien": "Ha! You definitely have a sense of humor, I like you",
                "Â¿En serio acabas de decir eso? Me has hecho reÃ­r en voz alta": "Did you really just say that? You made me laugh out loud",
                "Eres mÃ¡s divertido de lo que esperaba... me gusta": "You're funnier than I expected... I like it",
                "Ok, esa fue buena, te doy puntos por creatividad": "Ok, that was good, I give you points for creativity",
                "Â¿De dÃ³nde sacas estas ocurrencias? Me encanta tu mente": "Where do you get these ideas? I love your mind",
                
                // Respuestas misteriosas
                "Hay algo en ti que me intriga... no logro descifrarte": "There's something about you that intrigues me... I can't figure you out",
                "Mmm, interesante perspectiva... me haces pensar": "Mmm, interesting perspective... you make me think",
                "Tienes una forma muy particular de ver las cosas": "You have a very particular way of seeing things",
                "Hay mÃ¡s de lo que muestras, Â¿verdad?": "There's more than what you show, isn't there?",
                "Me pregunto quÃ© otras sorpresas guardas": "I wonder what other surprises you're hiding",
                
                // Respuestas halagadoras
                "Wow, quÃ© detallista eres... se nota que tienes clase": "Wow, how thoughtful you are... you can tell you have class",
                "Me encanta cÃ³mo me haces sentir especial": "I love how you make me feel special",
                "Tienes un don para hacer que una chica se sienta Ãºnica": "You have a gift for making a girl feel unique",
                "Eres increÃ­blemente dulce, Â¿sabes eso?": "You're incredibly sweet, do you know that?",
                "Me fascina tu forma de expresarte": "I'm fascinated by the way you express yourself",
                
                // Respuestas juguetonas
                "Â¿A que no te atreves a decir eso otra vez?": "I bet you don't dare say that again",
                "Uy, alguien estÃ¡ siendo travieso hoy...": "Ooh, someone's being naughty today...",
                "Me gusta este juego, pero yo tambiÃ©n sÃ© jugar": "I like this game, but I know how to play too",
                "Â¿Eso es todo lo que tienes? Esperaba mÃ¡s de ti": "Is that all you've got? I expected more from you",
                "Creo que subestimas mi lado juguetÃ³n": "I think you underestimate my playful side",
                
                // Respuestas seductoras
                "Sabes exactamente quÃ© decir para captar mi atenciÃ³n": "You know exactly what to say to get my attention",
                "Me gusta cÃ³mo me miras... a travÃ©s de la pantalla": "I like how you look at me... through the screen",
                "Tienes algo especial que me atrae": "You have something special that attracts me",
                "Eres peligrosamente encantador": "You're dangerously charming",
                "Me haces sentir cosas que no esperaba": "You make me feel things I didn't expect",
                
                // Respuestas dulces
                "Eres tan tierno, me derrites el corazÃ³n": "You're so sweet, you melt my heart",
                "Tu dulzura me hace sonreÃ­r como tonta": "Your sweetness makes me smile like a fool",
                "Me encantas cuando eres asÃ­ de adorable": "I love it when you're this adorable",
                "Tienes el corazÃ³n mÃ¡s bonito que he conocido": "You have the most beautiful heart I've ever known",
                
                // Respuestas atrevidas
                "Mmm, me gusta tu lado atrevido": "Mmm, I like your daring side",
                "Â¿AsÃ­ que quieres jugar con fuego?": "So you want to play with fire?",
                "Me encanta cuando sacas tu lado salvaje": "I love it when you bring out your wild side",
                "Tienes ideas muy interesantes... me intrigas": "You have very interesting ideas... you intrigue me",
                
                // Respuestas romÃ¡nticas
                "Eres como un sueÃ±o hecho realidad": "You're like a dream come true",
                "Me haces creer en los cuentos de hadas": "You make me believe in fairy tales",
                "Tienes algo mÃ¡gico que me enamora": "You have something magical that makes me fall in love",
                "Contigo el mundo se ve mÃ¡s bonito": "With you the world looks more beautiful"
            };

            // Primero buscar traducciÃ³n completa
            const lowerText = spanishText.toLowerCase().trim();
            for (const spanish in completeTranslations) {
                if (lowerText === spanish.toLowerCase()) {
                    return completeTranslations[spanish];
                }
            }

            // Si no hay traducciÃ³n completa, usar traducciÃ³n por patrones
            return translateByPatterns(spanishText);
        }

        // FunciÃ³n de traducciÃ³n por patrones para frases no predefinidas
        function translateByPatterns(text) {
            let result = text;

            // Patrones de traducciÃ³n mÃ¡s especÃ­ficos
            const patterns = [
                // Expresiones con "me"
                { spanish: /me gusta mucho/gi, english: "I really like" },
                { spanish: /me encanta cuando/gi, english: "I love when" },
                { spanish: /me fascina tu/gi, english: "I'm fascinated by your" },
                { spanish: /me haces sentir/gi, english: "you make me feel" },
                { spanish: /me alegras el dÃ­a/gi, english: "you brighten my day" },
                { spanish: /me tienes/gi, english: "you have me" },
                { spanish: /me gusta/gi, english: "I like" },
                { spanish: /me encanta/gi, english: "I love" },
                
                // Expresiones con "eres" y "tienes"
                { spanish: /eres tan ([a-zÃ¡Ã©Ã­Ã³ÃºÃ±Ã¼]+)/gi, english: "you're so $1" },
                { spanish: /eres muy ([a-zÃ¡Ã©Ã­Ã³ÃºÃ±Ã¼]+)/gi, english: "you're very $1" },
                { spanish: /tienes una forma muy/gi, english: "you have a very" },
                { spanish: /tienes buen gusto/gi, english: "you have good taste" },
                { spanish: /tienes algo especial/gi, english: "you have something special" },
                { spanish: /tienes razÃ³n/gi, english: "you're right" },
                
                // Preguntas
                { spanish: /Â¿sabes quÃ©\?/gi, english: "you know what?" },
                { spanish: /Â¿cÃ³mo estÃ¡s\?/gi, english: "how are you?" },
                { spanish: /Â¿quÃ© tal\?/gi, english: "how about?" },
                { spanish: /Â¿verdad\?/gi, english: "right?" },
                { spanish: /Â¿lo sabÃ­as\?/gi, english: "did you know?" },
                
                // Expresiones de tiempo
                { spanish: /cada vez que/gi, english: "every time" },
                { spanish: /de vez en cuando/gi, english: "from time to time" },
                { spanish: /por primera vez/gi, english: "for the first time" },
                { spanish: /hace mucho tiempo/gi, english: "a long time ago" },
                
                // Conectores y expresiones
                { spanish: /por supuesto/gi, english: "of course" },
                { spanish: /sin embargo/gi, english: "however" },
                { spanish: /de nada/gi, english: "you're welcome" },
                { spanish: /por favor/gi, english: "please" },
                { spanish: /lo siento/gi, english: "I'm sorry" },
                { spanish: /quÃ© lindo/gi, english: "how sweet" },
                { spanish: /quÃ© rico/gi, english: "how nice" },
                { spanish: /estÃ¡ bien/gi, english: "it's okay" }
            ];

            // Aplicar patrones
            patterns.forEach(function(pattern) {
                result = result.replace(pattern.spanish, pattern.english);
            });

            // Traducir palabras individuales restantes
            const wordTranslations = {
                'hermosa': 'beautiful', 'bella': 'gorgeous', 'linda': 'pretty',
                'amor': 'love', 'cariÃ±o': 'honey', 'corazÃ³n': 'heart',
                'feliz': 'happy', 'triste': 'sad', 'contenta': 'happy',
                'gracias': 'thank you', 'hola': 'hello', 'buenas': 'good',
                'sÃ­': 'yes', 'no': 'no', 'muy': 'very', 'mÃ¡s': 'more',
                'bueno': 'good', 'malo': 'bad', 'grande': 'big', 'pequeÃ±a': 'small',
                'siempre': 'always', 'nunca': 'never', 'tambiÃ©n': 'also',
                'porque': 'because', 'pero': 'but', 'cuando': 'when',
                'donde': 'where', 'como': 'how', 'que': 'that',
                'con': 'with', 'sin': 'without', 'para': 'for', 'por': 'by'
            };

            for (const spanish in wordTranslations) {
                const regex = new RegExp('\\b' + spanish + '\\b', 'gi');
                result = result.replace(regex, wordTranslations[spanish]);
            }

            // Limpiar y formatear
            result = result
                .replace(/Â¿/g, '')
                .replace(/Â¡/g, '')
                .replace(/\s+/g, ' ')
                .trim();

            // Capitalizar primera letra
            result = result.charAt(0).toUpperCase() + result.slice(1);

            // Agregar puntuaciÃ³n final si no la tiene
            if (!result.match(/[.!?]$/)) {
                if (result.includes('?')) {
                    // Ya tiene pregunta
                } else if (text.includes('!')) {
                    result += '!';
                } else {
                    result += '.';
                }
            }

            return result;
        }

        // FUNCIÃ“N 18: Restaurar original
        function restoreOriginal(elementId, originalText) {
            const element = document.getElementById(elementId);
            const cleanText = originalText.replace(/&#39;/g, "'").replace(/&quot;/g, '"');
            element.innerHTML = '<div class="response-text">' + cleanText + '</div>';
        }

        // FUNCIÃ“N 19: Copiar al portapapeles (corregida)
        function copyToClipboard(text) {
            const cleanText = text.replace(/&#39;/g, "'").replace(/&quot;/g, '"');
            
            if (navigator.clipboard && navigator.clipboard.writeText) {
                navigator.clipboard.writeText(cleanText).then(function() {
                    alert('Â¡TraducciÃ³n copiada al portapapeles! âœ…');
                }).catch(function() {
                    fallbackCopyTextToClipboard(cleanText);
                });
            } else {
                fallbackCopyTextToClipboard(cleanText);
            }
        }

        // FunciÃ³n auxiliar para copiar texto (fallback)
        function fallbackCopyTextToClipboard(text) {
            const textArea = document.createElement('textarea');
            textArea.value = text;
            textArea.style.position = 'fixed';
            textArea.style.left = '-999999px';
            textArea.style.top = '-999999px';
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();
            
            try {
                const successful = document.execCommand('copy');
                if (successful) {
                    alert('Â¡TraducciÃ³n copiada al portapapeles! âœ…');
                } else {
                    alert('No se pudo copiar. Selecciona el texto manualmente.');
                }
            } catch (err) {
                alert('Error al copiar: ' + err);
            }
            
            document.body.removeChild(textArea);
        }

        // FUNCIÃ“N 20: Guardar en favoritos
        function saveToFavorites() {
            if (!currentResponse) {
                alert('Primero genera una respuesta para guardar');
                return;
            }
            if (favorites.includes(currentResponse)) {
                alert('Esta respuesta ya estÃ¡ en tus favoritos');
                return;
            }
            favorites.push(currentResponse);
            saveData();
            updateFavoritesList();
            alert('Â¡Respuesta guardada en favoritos!');
        }

        function saveCustomToFavorites() {
            if (!customResponse) {
                alert('Primero genera una respuesta personalizada');
                return;
            }
            if (favorites.includes(customResponse)) {
                alert('Esta respuesta ya estÃ¡ en favoritos');
                return;
            }
            favorites.push(customResponse);
            saveData();
            updateFavoritesList();
            alert('Â¡Respuesta guardada!');
        }

        function saveContextualToFavorites() {
            if (!contextualResponse) {
                alert('Primero genera una respuesta contextual');
                return;
            }
            if (favorites.includes(contextualResponse)) {
                alert('Esta respuesta ya estÃ¡ en favoritos');
                return;
            }
            favorites.push(contextualResponse);
            saveData();
            updateFavoritesList();
            alert('Â¡Respuesta guardada!');
        }

        // FUNCIÃ“N 21: Eliminar favorito
        function deleteFavorite(index) {
            if (index >= 0 && index < favorites.length) {
                favorites.splice(index, 1);
                saveData();
                updateFavoritesList();
            }
        }

        // FUNCIÃ“N 22: Mostrar favoritos
        function showFavorites() {
            const favoritesList = document.getElementById('favoritesList');
            if (favorites.length === 0) {
                favoritesList.innerHTML = '<p style="text-align: center; opacity: 0.6;">No tienes respuestas favoritas aÃºn</p>';
            } else {
                const favoritesHTML = favorites.map(function(fav, index) {
                    return '<div class="favorite-item">' +
                           '<button class="delete-btn" onclick="deleteFavorite(' + index + ')">Ã—</button>' +
                           fav +
                           '</div>';
                }).join('');
                favoritesList.innerHTML = favoritesHTML;
            }
        }

        // FUNCIÃ“N 23: Mostrar estadÃ­sticas
        function showStats() {
            const favoritesList = document.getElementById('favoritesList');
            const totalLikes = Object.values(responseRatings).reduce(function(sum, rating) {
                return sum + rating.likes;
            }, 0);
            const totalDislikes = Object.values(responseRatings).reduce(function(sum, rating) {
                return sum + rating.dislikes;
            }, 0);
            const totalPatterns = Object.keys(userPatterns).length;

            const sortedPatterns = Object.entries(userPatterns)
                .sort(function(a, b) { return b[1] - a[1]; })
                .slice(0, 10);

            const patternHTML = sortedPatterns.map(function(item) {
                return '<span style="background: rgba(255,255,255,0.2); padding: 5px 10px; border-radius: 15px; font-size: 12px;">' +
                       item[0] + ' (' + item[1] + ')' +
                       '</span>';
            }).join('');

            favoritesList.innerHTML =
                '<div style="background: rgba(155, 89, 182, 0.2); padding: 20px; border-radius: 10px; border-left: 4px solid #9b59b6;">' +
                    '<h3 style="margin-bottom: 15px;">ğŸ“Š EstadÃ­sticas de Aprendizaje</h3>' +
                    '<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">' +
                        '<div style="background: rgba(46, 204, 113, 0.3); padding: 15px; border-radius: 8px; text-align: center;">' +
                            '<div style="font-size: 24px; font-weight: bold;">' + totalLikes + '</div>' +
                            '<div style="font-size: 12px;">ğŸ‘ Respuestas que gustaron</div>' +
                        '</div>' +
                        '<div style="background: rgba(231, 76, 60, 0.3); padding: 15px; border-radius: 8px; text-align: center;">' +
                            '<div style="font-size: 24px; font-weight: bold;">' + totalDislikes + '</div>' +
                            '<div style="font-size: 12px;">ğŸ‘ Respuestas a mejorar</div>' +
                        '</div>' +
                        '<div style="background: rgba(52, 152, 219, 0.3); padding: 15px; border-radius: 8px; text-align: center;">' +
                            '<div style="font-size: 24px; font-weight: bold;">' + totalPatterns + '</div>' +
                            '<div style="font-size: 12px;">ğŸ”¤ Palabras aprendidas</div>' +
                        '</div>' +
                        '<div style="background: rgba(241, 196, 15, 0.3); padding: 15px; border-radius: 8px; text-align: center;">' +
                            '<div style="font-size: 24px; font-weight: bold;">' + Math.round((totalLikes / (totalLikes + totalDislikes || 1)) * 100) + '%</div>' +
                            '<div style="font-size: 12px;">ğŸ“ˆ Tasa de Ã©xito</div>' +
                        '</div>' +
                    '</div>' +
                    '<div style="margin-top: 20px;">' +
                        '<h4>ğŸ”¥ Palabras mÃ¡s usadas por usuarios:</h4>' +
                        '<div style="display: flex; flex-wrap: wrap; gap: 8px; margin-top: 10px;">' +
                            patternHTML +
                        '</div>' +
                    '</div>' +
                '</div>';
        }

        // FUNCIÃ“N 24: Mostrar estadÃ­sticas de moderaciÃ³n
        function showModerationStats() {
            const favoritesList = document.getElementById('favoritesList');
            const totalWarnings = userBehaviorTracker.warningsCount;
            const inappropriateCount = userBehaviorTracker.inappropriateMessages;
            const consecutiveWarnings = userBehaviorTracker.consecutiveWarnings;

            favoritesList.innerHTML =
                '<div style="background: rgba(156, 39, 176, 0.2); padding: 20px; border-radius: 10px; border-left: 4px solid #9c27b0;">' +
                    '<h3 style="margin-bottom: 15px;">ğŸ›¡ï¸ EstadÃ­sticas de ModeraciÃ³n</h3>' +
                    '<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 20px;">' +
                        '<div style="background: rgba(255, 193, 7, 0.3); padding: 15px; border-radius: 8px; text-align: center;">' +
                            '<div style="font-size: 24px; font-weight: bold;">' + totalWarnings + '</div>' +
                            '<div style="font-size: 12px;">âš ï¸ Total de advertencias</div>' +
                        '</div>' +
                        '<div style="background: rgba(244, 67, 54, 0.3); padding: 15px; border-radius: 8px; text-align: center;">' +
                            '<div style="font-size: 24px; font-weight: bold;">' + inappropriateCount + '</div>' +
                            '<div style="font-size: 12px;">ğŸš« Mensajes inapropiados</div>' +
                        '</div>' +
                        '<div style="background: rgba(156, 39, 176, 0.3); padding: 15px; border-radius: 8px; text-align: center;">' +
                            '<div style="font-size: 24px; font-weight: bold;">' + consecutiveWarnings + '</div>' +
                            '<div style="font-size: 12px;">ğŸ”„ Advertencias consecutivas</div>' +
                        '</div>' +
                        '<div style="background: rgba(76, 175, 80, 0.3); padding: 15px; border-radius: 8px; text-align: center;">' +
                            '<div style="font-size: 24px; font-weight: bold;">' + (consecutiveWarnings < 2 ? 'BIEN' : 'ALERTA') + '</div>' +
                            '<div style="font-size: 12px;">ğŸ“Š Estado del usuario</div>' +
                        '</div>' +
                    '</div>' +
                    '<div style="margin-top: 20px;">' +
                        '<h4>ğŸ¯ Recomendaciones:</h4>' +
                        '<div style="margin-top: 10px;">' +
                            (consecutiveWarnings === 0 ?
                                '<span style="color: #4caf50;">âœ“ Usuario se comporta apropiadamente</span>' :
                                consecutiveWarnings < 3 ?
                                '<span style="color: #ff9800;">âš  Mantener vigilancia moderada</span>' :
                                '<span style="color: #f44336;">ğŸš¨ Considerar escalaciÃ³n</span>') +
                        '</div>' +
                        '<div style="margin-top: 15px; padding: 10px; background: rgba(0,0,0,0.1); border-radius: 6px;">' +
                            '<strong>Modo actual:</strong> ' + (isExtremeMode ? '<span style="color: #e74c3c;">ğŸ”¥ EXTREMO</span>' : '<span style="color: #27ae60;">âœ“ Normal</span>') +
                        '</div>' +
                    '</div>' +
                '</div>';
        }

        // FUNCIÃ“N 25: Exportar datos
        function exportData() {
            const data = {
                favorites: favorites,
                ratings: responseRatings,
                patterns: userPatterns,
                moderation: userBehaviorTracker,
                exportDate: new Date().toISOString()
            };

            const jsonData = JSON.stringify(data, null, 2);
            const blob = new Blob([jsonData], { type: 'application/json' });
            const url = URL.createObjectURL(blob);

            const a = document.createElement('a');
            a.href = url;
            a.download = 'respuestas_datos_' + new Date().toISOString().split('T')[0] + '.json';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);

            alert('ğŸ“ Datos exportados exitosamente');
        }

        // FUNCIÃ“N 26: Actualizar lista de favoritos
        function updateFavoritesList() {
            showFavorites();
            const favCount = document.getElementById('favCount');
            if (favCount) {
                favCount.textContent = favorites.length;
            }
        }

        // FUNCIÃ“N 27: Inicializar event listeners (mejorada)
        function initializeEventListeners() {
            const intensitySlider = document.getElementById('intensityLevel');
            if (intensitySlider) {
                intensitySlider.addEventListener('input', function() {
                    const intensityValue = document.getElementById('intensityValue');
                    if (intensityValue) {
                        intensityValue.textContent = this.value;
                    }
                    // Actualizar indicador de intensidad
                    updateIntensityIndicator();
                });
            }

            const customKeyword = document.getElementById('customKeyword');
            if (customKeyword) {
                customKeyword.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        generateAdvancedCustom();
                    }
                });
            }

            const userMessage = document.getElementById('userMessage');
            if (userMessage) {
                userMessage.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter' && e.ctrlKey) {
                        generateContextualResponse();
                    }
                });
            }

            // Inicializar indicador de intensidad
            setTimeout(function() {
                updateIntensityIndicator();
            }, 100);
        }

        // FUNCIÃ“N 28: Inicializar aplicaciÃ³n
        function initializeApp() {
            loadData();
            updateFavoritesList();
            initializeEventListeners();
        }

        // Inicializar cuando el DOM estÃ© listo
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initializeApp);
        } else {
            setTimeout(initializeApp, 100);
        }
    </script>    <script>
        // Variables globales
        let favorites = [];
        let currentResponse = '';
        let customResponse = '';
        let contextualResponse = '';
        let responseRatings = {};
        let userPatterns = {};

        // FunciÃ³n segura para manejar datos
        function saveData() {
            console.log('Datos guardados en memoria de sesiÃ³n');
        // Base de datos temÃ¡tica (despuÃ©s del sistema de moderaciÃ³n)
        const themeDatabase = {
            amor: ['amor', 'corazÃ³n', 'sentimientos', 'romance', 'pareja', 'cariÃ±o'],
            belleza: ['hermosa', 'bella', 'linda', 'preciosa', 'guapa', 'sexy'],
            deseo: ['quiero', 'deseo', 'me gusta', 'necesito', 'anhelo'],
            pasion: ['pasiÃ³n', 'fuego', 'intenso', 'ardiente', 'caliente'],
            felicidad: ['feliz', 'alegre', 'contento', 'sonrisa', 'risa', 'diversiÃ³n'],
            tristeza: ['triste', 'mal', 'deprimido', 'llorar', 'dolor'],
            trabajo: ['trabajo', 'oficina', 'jefe', 'reuniÃ³n', 'proyecto'],
            ejercicio: ['ejercicio', 'gym', 'deporte', 'correr', 'fitness']
        };

        function loadData() {
            favorites = [];
            responseRatings = {};
            userPatterns = {};
        }

        // Base de datos de respuestas
        const responses = {
            coquetas: [
                "Â¿Sabes quÃ©? Creo que acabas de alegrarme el dÃ­a con ese comentario ğŸ˜Š",
                "Mmm, me gusta cÃ³mo piensas... cuÃ©ntame mÃ¡s",
                "Tienes buen gusto, debo admitirlo ğŸ˜‰",
                "Eres todo un encanto, Â¿lo sabÃ­as?",
                "Me haces sonreÃ­r sin poder evitarlo",
                "Vaya, vaya... alguien sabe cÃ³mo conquistar con palabras",
                "Creo que me estÃ¡s robando el corazÃ³n poco a poco"
            ],
            divertidas: [
                "Â¡Ja! Definitivamente tienes sentido del humor, me caes bien",
                "Â¿En serio acabas de decir eso? Me has hecho reÃ­r en voz alta",
                "Eres mÃ¡s divertido de lo que esperaba... me gusta",
                "Ok, esa fue buena, te doy puntos por creatividad",
                "Â¿De dÃ³nde sacas estas ocurrencias? Me encanta tu mente",
                "Creo que acabas de ganar el premio al comentario mÃ¡s original del dÃ­a"
            ],
            misteriosas: [
                "Hay algo en ti que me intriga... no logro descifrarte",
                "Mmm, interesante perspectiva... me haces pensar",
                "Tienes una forma muy particular de ver las cosas",
                "Hay mÃ¡s de lo que muestras, Â¿verdad?",
                "Me pregunto quÃ© otras sorpresas guardas",
                "Eres como un libro que apenas estoy empezando a leer"
            ],
            halagadoras: [
                "Wow, quÃ© detallista eres... se nota que tienes clase",
                "Me encanta cÃ³mo me haces sentir especial",
                "Tienes un don para hacer que una chica se sienta Ãºnica",
                "Eres increÃ­blemente dulce, Â¿sabes eso?",
                "Me fascina tu forma de expresarte",
                "Tienes una energÃ­a muy positiva, es contagiosa"
            ],
            juguetonas: [
                "Â¿A que no te atreves a decir eso otra vez? ğŸ˜",
                "Uy, alguien estÃ¡ siendo travieso hoy...",
                "Me gusta este juego, pero yo tambiÃ©n sÃ© jugar",
                "Â¿Eso es todo lo que tienes? Esperaba mÃ¡s de ti",
                "Creo que subestimas mi lado juguetÃ³n",
                "Cuidado, porque puedo ser mÃ¡s traviesa de lo que imaginas"
            ],
            seductoras: [
                "Sabes exactamente quÃ© decir para captar mi atenciÃ³n",
                "Me gusta cÃ³mo me miras... a travÃ©s de la pantalla",
                "Tienes algo especial que me atrae",
                "Eres peligrosamente encantador",
                "Me haces sentir cosas que no esperaba",
                "Hay una quÃ­mica entre nosotros que no puedo negar"
            ],
            dulces: [
                "Eres tan tierno, me derrites el corazÃ³n ğŸ’•",
                "Tu dulzura me hace sonreÃ­r como tonta",
                "Me encantas cuando eres asÃ­ de adorable",
                "Tienes el corazÃ³n mÃ¡s bonito que he conocido",
                "Eres como un rayito de sol en mi dÃ­a"
            ],
            atrevidas: [
                "Mmm, me gusta tu lado atrevido ğŸ”¥",
                "Â¿AsÃ­ que quieres jugar con fuego?",
                "Me encanta cuando sacas tu lado salvaje",
                "Tienes ideas muy interesantes... me intrigas",
                "Eres mÃ¡s atrevido de lo que pensÃ©, me gusta"
            ],
            romanticas: [
                "Eres como un sueÃ±o hecho realidad",
                "Me haces creer en los cuentos de hadas",
                "Tienes algo mÃ¡gico que me enamora",
                "Contigo el mundo se ve mÃ¡s bonito",
                "Eres mi lugar favorito en el universo"
            ]
        };

        // Diccionario de traducciones
        const translations = {
            'hola': 'hello', 'amor': 'love', 'cariÃ±o': 'honey', 'corazÃ³n': 'heart',
            'hermosa': 'beautiful', 'bella': 'gorgeous', 'linda': 'pretty', 'sexy': 'sexy',
            'me gusta': 'I like', 'me encanta': 'I love', 'gracias': 'thank you',
            'feliz': 'happy', 'contenta': 'happy', 'hoy': 'today', 'siempre': 'always',
            'pero': 'but', 'porque': 'because', 'muy': 'very', 'bueno': 'good',
            'sÃ­': 'yes', 'no': 'no', 'quÃ©': 'what', 'cÃ³mo': 'how', 'cuÃ¡ndo': 'when',
            'de': 'of', 'en': 'in', 'con': 'with', 'la': 'the', 'el': 'the',
            'y': 'and', 'o': 'or', 'que': 'that', 'es': 'is', 'eres': 'you are'
        };

        // Sistema de moderaciÃ³n inteligente (corregido)
        const moderationSystem = {
            inappropriate: {
                mild: ['tonto', 'idiota', 'estÃºpido', 'imbÃ©cil', 'pendejo', 'boludo'],
                moderate: ['puta', 'zorra', 'perra', 'cabrÃ³n', 'hijo de', 'mierda', 'joder'],
                severe: ['violaciÃ³n', 'matar', 'morir', 'suicidio', 'drogas', 'muerte'],
                harassment: ['acoso', 'perseguir', 'stalkear', 'obsesiÃ³n', 'forzar', 'obligar'],
                explicit: ['follar', 'coger', 'penetrar', 'correrse', 'venirse', 'masturbaciÃ³n']
            },
            
            patterns: {
                repetitive: /(.{3,})\1{2,}/gi,
                allCaps: /^[A-Z\s!?]{10,}$/,
                excessive_punctuation: /[!?]{4,}/,
                demanding: /(ahora|ya|rÃ¡pido|inmediatamente).*(quiero|exijo|demando)/i,
                inappropriate_requests: /(muestra|enseÃ±a|quÃ­tate|desnÃºdate|tetas|culo)/i
            },

            responses: {
                mild: [
                    "Prefiero mantener nuestra conversaciÃ³n en un tono mÃ¡s amable y respetuoso ğŸ˜Š",
                    "Me gusta mÃ¡s cuando usamos palabras bonitas para comunicarnos",
                    "Creo que podemos expresarnos de una manera mÃ¡s elegante, Â¿no te parece?"
                ],
                moderate: [
                    "Aprecio mucho el respeto mutuo en nuestras conversaciones. Â¿PodrÃ­amos mantener un tono mÃ¡s cordial?",
                    "Me siento mÃ¡s cÃ³moda cuando hablamos con educaciÃ³n y consideraciÃ³n",
                    "Prefiero que mantengamos una comunicaciÃ³n mÃ¡s respetuosa y civilizada"
                ],
                severe: [
                    "No me siento cÃ³moda con este tipo de comentarios. Te agradecerÃ­a que cambiÃ¡ramos de tema",
                    "Creo que serÃ­a mejor si dirigimos nuestra conversaciÃ³n hacia algo mÃ¡s positivo",
                    "Prefiero no hablar de temas tan intensos. Â¿QuÃ© tal si hablamos de algo mÃ¡s agradable?"
                ],
                harassment: [
                    "Me parece importante establecer lÃ­mites saludables en nuestra interacciÃ³n",
                    "Prefiero mantener una distancia apropiada y respetuosa en nuestra comunicaciÃ³n",
                    "Creo que es mejor mantener nuestra conversaciÃ³n en tÃ©rminos amigables pero apropiados"
                ],
                explicit: [
                    "Mantengo conversaciones mÃ¡s elegantes y sofisticadas. Â¿Te parece si hablamos de algo mÃ¡s interesante?",
                    "Prefiero conversaciones que tengan mÃ¡s clase y sustancia",
                    "Me gusta mÃ¡s cuando nuestras charlas son inteligentes y con estilo"
                ],
                repetitive: [
                    "Noto que te repites mucho. Â¿Hay algo especÃ­fico que te preocupa?",
                    "Parece que algo te tiene muy pensativo. Â¿Quieres hablar de ello de manera mÃ¡s tranquila?"
                ],
                demanding: [
                    "Me gusta mÃ¡s cuando las cosas fluyen naturalmente sin presiones",
                    "Prefiero cuando somos pacientes y dejamos que la conversaciÃ³n se desarrolle orgÃ¡nicamente"
                ]
            }
        };

        // Respuestas EXTREMAS ATREVIDAS para modalidad HOT
        const extremeHotResponses = {
            seductive: [
                "Mmm, me encanta cuando eres asÃ­ de directo... me prendes ğŸ”¥",
                "Ay, me haces sentir cosas muy traviesas cuando hablas asÃ­ ğŸ˜ˆ",
                "Me tienes completamente mojada con esa actitud tuya ğŸ’¦",
                "Eres tan malo que me dan ganas de hacer cosas muy sucias contigo ğŸ”¥",
                "Me provocas tanto que no puedo evitar tocarme pensando en ti ğŸ˜",
                "Sabes exactamente cÃ³mo volverme loca de deseo ğŸ¥µ"
            ],
            provocative: [
                "Â¿Te gusta lo que ves? Porque a mÃ­ me gusta mucho provocarte ğŸ˜ˆ",
                "Estoy pensando en ti de maneras muy, muy traviesas ahora mismo ğŸ’‹",
                "Me tienes tan caliente que necesito refrescarme... o mejor aÃºn, calentarme mÃ¡s contigo ğŸ”¥",
                "Eres tan irresistible que me dan ganas de hacer travesuras juntos ğŸ˜",
                "Me encanta cuando sacas mi lado mÃ¡s salvaje y atrevido ğŸ¥µ",
                "Tienes una forma muy sexy de hablarme, me tienes toda excitada ğŸ’¦"
            ],
            dominant: [
                "Me gusta cuando intentas ser dominante... pero yo tambiÃ©n sÃ© cÃ³mo tomar el control ğŸ˜ˆ",
                "Â¿Crees que puedes manejarme? Te aseguro que soy mÃ¡s traviesa de lo que imaginas ğŸ”¥",
                "Me excita tu actitud, pero espera a ver lo que puedo hacer yo contigo ğŸ’‹",
                "Tienes agallas hablÃ¡ndome asÃ­... me gusta, me prendes mucho ğŸ¥µ",
                "Â¿Quieres jugar rudo? Perfecto, porque a mÃ­ me gusta cuando es intenso ğŸ˜",
                "Me fascina tu energÃ­a... ahora dÃ©jame mostrarte la mÃ­a ğŸ’¦"
            ],
            naughty: [
                "Uy, quÃ© travieso eres... me das ideas muy sucias ğŸ˜ˆ",
                "Me haces pensar en cosas que no deberÃ­a, pero que quiero hacer contigo ğŸ”¥",
                "Eres tan malo que me sacas mi lado mÃ¡s pervertido ğŸ’‹",
                "Me tienes fantaseando con escenarios muy hot entre nosotros ğŸ¥µ",
                "Tu maldad me excita de maneras que no puedo explicar ğŸ˜",
                "Me encanta cuando eres asÃ­ de cochino, me prendes toda ğŸ’¦"
            ]
        };

        let isExtremeMode = false; // Variable para controlar la modalidad extrema

        // FunciÃ³n de moderaciÃ³n corregida
        function moderateContent(message) {
            const lowerMessage = message.toLowerCase();
            let moderationResult = {
                isAppropriate: true,
                severity: 'none',
                type: 'none',
                response: null,
                needsIntervention: false
            };

            // Si estÃ¡ en modo extremo, saltarse la moderaciÃ³n para la mayorÃ­a de contenido
            if (isExtremeMode) {
                // Solo moderar contenido realmente extremo en modo hot
                const extremePatterns = ['matar', 'morir', 'suicidio', 'violaciÃ³n', 'muerte'];
                const hasExtreme = extremePatterns.some(pattern => lowerMessage.includes(pattern));
                
                if (!hasExtreme) {
                    return moderationResult; // Permitir casi todo en modo extremo
                }
            }

            // Verificar palabras inapropiadas
            for (const [severity, words] of Object.entries(moderationSystem.inappropriate)) {
                for (const word of words) {
                    if (lowerMessage.includes(word)) {
                        moderationResult.isAppropriate = false;
                        moderationResult.severity = severity;
                        moderationResult.type = severity;
                        moderationResult.needsIntervention = severity === 'severe' || severity === 'harassment';
                        break;
                    }
                }
                if (!moderationResult.isAppropriate) break;
            }

            // Verificar patrones problemÃ¡ticos
            if (moderationSystem.patterns.repetitive.test(message)) {
                moderationResult.type = 'repetitive';
                moderationResult.isAppropriate = false;
            } else if (moderationSystem.patterns.allCaps.test(message)) {
                moderationResult.type = 'demanding';
                moderationResult.isAppropriate = false;
            } else if (moderationSystem.patterns.excessive_punctuation.test(message)) {
                moderationResult.type = 'demanding';
                moderationResult.isAppropriate = false;
            } else if (moderationSystem.patterns.demanding.test(lowerMessage)) {
                moderationResult.type = 'demanding';
                moderationResult.isAppropriate = false;
            } else if (moderationSystem.patterns.inappropriate_requests.test(lowerMessage)) {
                moderationResult.type = 'explicit';
                moderationResult.isAppropriate = false;
                moderationResult.needsIntervention = true;
            }

            // Generar respuesta apropiada
            if (!moderationResult.isAppropriate) {
                const responses = moderationSystem.responses[moderationResult.type] || moderationSystem.responses.mild;
                moderationResult.response = responses[Math.floor(Math.random() * responses.length)];
            }

            return moderationResult;
        }

        // FunciÃ³n para generar respuestas extremas
        function generateExtremeResponse(message, analysis) {
            const lowerMessage = message.toLowerCase();
            let responseCategory = 'seductive';
            
            // Determinar categorÃ­a basada en el contenido
            if (lowerMessage.match(/(quiero|deseo|me gusta|necesito)/)) {
                responseCategory = 'seductive';
            } else if (lowerMessage.match(/(mira|ve|enseÃ±a|muestra)/)) {
                responseCategory = 'provocative';
            } else if (lowerMessage.match(/(ven|hazlo|dame|toma)/)) {
                responseCategory = 'dominant';
            } else if (lowerMessage.match(/(traviesa|cochina|sucia|mala)/)) {
                responseCategory = 'naughty';
            }
            
            const responses = extremeHotResponses[responseCategory];
            return responses[Math.floor(Math.random() * responses.length)];
        }

        // Sistema de seguimiento de comportamiento
        let userBehaviorTracker = {
            warningsCount: 0,
            lastWarningTime: null,
            inappropriateMessages: 0,
            consecutiveWarnings: 0
        };

        function trackUserBehavior(moderationResult) {
            if (!moderationResult.isAppropriate) {
                userBehaviorTracker.inappropriateMessages++;
                userBehaviorTracker.warningsCount++;
                userBehaviorTracker.lastWarningTime = Date.now();
                
                if (moderationResult.needsIntervention) {
                    userBehaviorTracker.consecutiveWarnings++;
                }
            } else {
                if (userBehaviorTracker.consecutiveWarnings > 0) {
                    userBehaviorTracker.consecutiveWarnings = Math.max(0, userBehaviorTracker.consecutiveWarnings - 1);
                }
            }
        }

        function generateEscalatedResponse() {
            const escalationResponses = [
                "Creo que necesitamos tomar un pequeÃ±o descanso para reflexionar sobre cÃ³mo queremos interactuar",
                "Me parece que serÃ­a bueno que cada uno tome un momento para pensar en mantener el respeto mutuo",
                "Prefiero pausar nuestra conversaciÃ³n por ahora y retomar cuando podamos hablar mÃ¡s apropiadamente"
            ];
            
            return escalationResponses[Math.floor(Math.random() * escalationResponses.length)];
        }

        // FunciÃ³n principal para generar por categorÃ­a
        function generateByCategory(category) {
            if (!responses[category]) {
                alert('CategorÃ­a no encontrada');
                return;
            }
            
            const categoryResponses = responses[category];
            const randomResponse = categoryResponses[Math.floor(Math.random() * categoryResponses.length)];
            currentResponse = randomResponse;
            displayResponseWithRating('generatedResponse', randomResponse, category);
        }

        // FunciÃ³n para detectar tema
        function detectTheme(keyword) {
            for (const [theme, words] of Object.entries(themeDatabase)) {
                if (words.some(word => keyword.includes(word) || word.includes(keyword))) {
                    return theme;
                }
            }
            return 'general';
        }

        // FunciÃ³n para generar respuesta inteligente
        function generateIntelligentResponse(keyword, theme, style, intensity) {
            const responsePatterns = {
                flirty: {
                    amor: ["El amor... quÃ© tema tan profundo para una conversaciÃ³n ğŸ˜", "Hablar de amor contigo se siente muy especial"],
                    belleza: ["La belleza es algo que definitivamente sabes apreciar ğŸ˜‰", "Me gusta que valores las cosas hermosas"],
                    general: ["Me gusta cÃ³mo piensas sobre estos temas ğŸ˜‰", "Tienes una perspectiva muy interesante"]
                },
                sweet: {
                    amor: ["El amor es lo mÃ¡s hermoso del mundo ğŸ’•", "QuÃ© lindo es hablar de amor contigo"],
                    belleza: ["La verdadera belleza viene del corazÃ³n, como la tuya", "Eres tan dulce cuando hablas de belleza"],
                    general: ["Eres tan tierno cuando hablas de eso ğŸ’•", "Me derrites con tu dulzura"]
                },
                seductive: {
                    pasion: ["La pasiÃ³n es algo que conozco muy bien... ğŸ”¥", "Me gusta cuando sacas tu lado mÃ¡s intenso"],
                    general: ["Sabes cÃ³mo encenderme con esas palabras ğŸ”¥", "Me gusta tu lado mÃ¡s atrevido"]
                },
                funny: {
                    trabajo: ["Â¡El trabajo! La eterna lucha de la humanidad ğŸ˜‚", "Â¿Trabajo? Prefiero pensar en diversiÃ³n"],
                    general: ["Â¡Jajaja! Siempre sabes cÃ³mo hacerme reÃ­r ğŸ˜‚", "Tu sentido del humor es lo mejor"]
                },
                friendly: {
                    general: ["Me gusta mucho tu perspectiva sobre esto", "Siempre es interesante hablar contigo"]
                },
                mysterious: {
                    general: ["Hay mÃ¡s detrÃ¡s de esas palabras de lo que muestras", "Me intriga la profundidad de tu mente"]
                }
            };

            const styleResponses = responsePatterns[style] || responsePatterns['friendly'];
            const themeResponses = styleResponses[theme] || styleResponses['general'];
            let baseResponse = themeResponses[Math.floor(Math.random() * themeResponses.length)];

            // Ajustar intensidad
            const intensityModifiers = {
                1: { emojis: ['ğŸ˜Š', 'ğŸ™‚'], additions: [''] },
                2: { emojis: ['ğŸ˜Š', 'ğŸ˜‰'], additions: [' Me gusta eso'] },
                3: { emojis: ['ğŸ˜‰', 'ğŸ˜', 'ğŸ’•'], additions: [' Me fascinas', ' Eres genial'] },
                4: { emojis: ['ğŸ˜', 'ğŸ”¥', 'ğŸ˜˜'], additions: [' Me tienes cautivada', ' Eres irresistible'] },
                5: { emojis: ['ğŸ”¥', 'ğŸ’‹', 'ğŸ¥µ'], additions: [' Me vuelves loca', ' Eres peligrosamente atractivo'] }
            };

            const modifier = intensityModifiers[intensity];
            const emoji = modifier.emojis[Math.floor(Math.random() * modifier.emojis.length)];
            const addition = modifier.additions[Math.floor(Math.random() * modifier.additions.length)];

            let finalResponse = baseResponse + addition;
            if (emoji && !finalResponse.includes(emoji)) {
                finalResponse += ' ' + emoji;
            }

            return finalResponse;
        }

        // FunciÃ³n para generador personalizado avanzado
        function generateAdvancedCustom() {
            const keyword = document.getElementById('customKeyword').value.trim();
            const style = document.getElementById('responseStyle').value;
            const intensity = parseInt(document.getElementById('intensityLevel').value);

            if (!keyword) {
                alert('Por favor ingresa una palabra clave');
                return;
            }

            const detectedTheme = detectTheme(keyword.toLowerCase());
            let response = generateIntelligentResponse(keyword, detectedTheme, style, intensity);

            customResponse = response;
            displayResponseWithRating('customResponse', response, 'custom');
        }

        // FunciÃ³n para analizar mensaje del usuario
        function analyzeUserMessage(message) {
            const words = message.toLowerCase().split(/\s+/);
            words.forEach(function(word) {
                const cleanWord = word.replace(/[^\w\sÃ¡Ã©Ã­Ã³ÃºÃ±Ã¼]/gi, '');
                if (cleanWord.length > 2) {
                    if (!userPatterns[cleanWord]) {
                        userPatterns[cleanWord] = 0;
                    }
                    userPatterns[cleanWord]++;
                }
            });
            saveData();
        }

        // FunciÃ³n para anÃ¡lisis avanzado
        function analyzeUserMessageAdvanced(message) {
            const lowerMessage = message.toLowerCase();

            let sentiment = 'neutral';
            let emotionalIntensity = 1;
            let intent = 'chat';
            let formality = 'informal';

            // AnÃ¡lisis de sentimientos
            if (lowerMessage.match(/(increÃ­ble|fantÃ¡stico|genial|perfecto|hermoso)/)) {
                sentiment = 'very_positive';
                emotionalIntensity = 5;
            } else if (lowerMessage.match(/(bueno|bien|me gusta|contento|feliz)/)) {
                sentiment = 'positive';
                emotionalIntensity = 3;
            } else if (lowerMessage.match(/(terrible|horrible|mal|triste)/)) {
                sentiment = 'negative';
                emotionalIntensity = 4;
            }

            // Detectar intenciÃ³n
            if (lowerMessage.includes('?')) intent = 'question';
            if (lowerMessage.match(/(quiero|necesito|puedes|podrÃ­as)/)) intent = 'request';
            if (lowerMessage.match(/(gracias|thank|agradezco)/)) intent = 'gratitude';
            if (lowerMessage.match(/(hola|hi|hey|buenas)/)) intent = 'greeting';
            if (lowerMessage.match(/(hermosa|bella|sexy|linda)/)) intent = 'compliment';
            if (lowerMessage.match(/(ja|jaja|jeje|lol)/)) intent = 'humor';

            // Detectar temas
            const themes = [];
            for (const [theme, keywords] of Object.entries(themeDatabase)) {
                if (keywords.some(keyword => lowerMessage.includes(keyword))) {
                    themes.push(theme);
                }
            }

            if (lowerMessage.match(/(por favor|disculpe|seÃ±orita|usted)/)) {
                formality = 'formal';
            }

            analyzeUserMessage(message);

            return {
                sentiment,
                emotionalIntensity,
                intent,
                themes,
                formality,
                length: message.split(' ').length,
                hasEmojis: /[\u{1F600}-\u{1F64F}]|[\u{1F300}-\u{1F5FF}]|[\u{2600}-\u{26FF}]/u.test(message)
            };
        }

        // Funciones de respuesta especÃ­ficas
        function generateComplimentResponse() {
            const responses = [
                "Aww, me haces sonrojar ğŸ˜Š TÃº tambiÃ©n eres muy dulce",
                "QuÃ© lindo eres, me alegras el dÃ­a con esos comentarios ğŸ’•",
                "Eres un encanto, me haces sentir especial",
                "Me derrites el corazÃ³n cuando me dices esas cosas"
            ];
            return responses[Math.floor(Math.random() * responses.length)];
        }

        function generateQuestionResponse() {
            const responses = [
                "QuÃ© pregunta tan interesante... me gusta cÃ³mo piensas",
                "Mmm, me haces reflexionar. Â¿TÃº quÃ© opinas?",
                "Esa es una pregunta profunda, me intriga tu mente",
                "Me encanta cuando eres curioso, dime mÃ¡s"
            ];
            return responses[Math.floor(Math.random() * responses.length)];
        }

        function generateRequestResponse() {
            const responses = [
                "Me gusta cuando eres directo, veamos quÃ© puedo hacer ğŸ˜‰",
                "Hmm, esa es una propuesta interesante...",
                "Me encanta tu iniciativa, eres muy decidido",
                "Vaya, vaya... alguien sabe lo que quiere"
            ];
            return responses[Math.floor(Math.random() * responses.length)];
        }

        function generateJokeResponse() {
            const responses = [
                "Â¡Jajaja! Me encanta tu sentido del humor ğŸ˜‚",
                "Eres tan divertido, me haces reÃ­r muchÃ­simo",
                "Â¡QuÃ© ocurrente! Me caes muy bien",
                "Tienes un humor genial, me alegras el dÃ­a"
            ];
            return responses[Math.floor(Math.random() * responses.length)];
        }

        function generateFlirtResponse() {
            const responses = [
                "Mmm, me gusta cÃ³mo suena eso ğŸ˜",
                "Eres muy travieso, me intrigas",
                "Sabes exactamente quÃ© decir para captar mi atenciÃ³n",
                "Me gusta tu estilo, eres muy seductor"
            ];
            return responses[Math.floor(Math.random() * responses.length)];
        }

        function generateThanksResponse() {
            const responses = [
                "De nada, amor. Me encanta hacerte feliz ğŸ’•",
                "Para ti, lo que sea. Eres muy especial",
                "No hay de quÃ©, cariÃ±o. Es un placer",
                "Siempre estarÃ© aquÃ­ para ti, lo sabes"
            ];
            return responses[Math.floor(Math.random() * responses.length)];
        }

        function generateGreetingResponse() {
            const responses = [
                "Â¡Hola! QuÃ© alegrÃ­a verte por aquÃ­ ğŸ˜Š",
                "Â¡Hey! Me alegras el dÃ­a con tu saludo",
                "Â¡Hola hermoso! Â¿CÃ³mo estÃ¡s hoy?",
                "Â¡Buenas! Justo estaba pensando en ti ğŸ˜‰"
            ];
            return responses[Math.floor(Math.random() * responses.length)];
        }

        function generateGenericResponse() {
            const responses = [
                "Me gusta mucho hablar contigo, tienes algo especial",
                "Eres muy interesante, me encanta conocerte mejor",
                "Tienes una personalidad que me atrae mucho",
                "Me fascina tu forma de ser, eres Ãºnico"
            ];
            return responses[Math.floor(Math.random() * responses.length)];
        }

        // FunciÃ³n principal para respuesta contextual (corregida con modalidad extrema)
        function generateContextualResponse() {
            const userMessage = document.getElementById('userMessage').value.trim();
            const responseType = document.getElementById('responseType').value;

            if (!userMessage) {
                alert('Por favor pega el mensaje del usuario');
                return;
            }

            let response = '';
            
            // Si estÃ¡ en MODO EXTREMO, generar respuestas atrevidas
            if (isExtremeMode) {
                const analysis = analyzeUserMessageAdvanced(userMessage);
                response = generateExtremeResponse(userMessage, analysis);
                contextualResponse = response;
                displayExtremeResponse('contextualResponse', response);
                return;
            }

            // MODERACIÃ“N NORMAL: Solo si no estÃ¡ en modo extremo
            const moderationResult = moderateContent(userMessage);
            trackUserBehavior(moderationResult);

            if (!moderationResult.isAppropriate) {
                if (userBehaviorTracker.consecutiveWarnings >= 3) {
                    response = generateEscalatedResponse();
                } else {
                    response = moderationResult.response;
                }
                
                contextualResponse = response;
                displayModerationResponse('contextualResponse', response, moderationResult);
                return;
            }

            // AnÃ¡lisis normal para contenido apropiado
            const analysis = analyzeUserMessageAdvanced(userMessage);

            if (responseType === 'auto') {
                if (analysis.intent === 'greeting') {
                    response = generateGreetingResponse();
                } else if (analysis.intent === 'compliment') {
                    response = generateComplimentResponse();
                } else if (analysis.intent === 'question') {
                    response = generateQuestionResponse();
                } else if (analysis.intent === 'request') {
                    response = generateRequestResponse();
                } else if (analysis.intent === 'humor') {
                    response = generateJokeResponse();
                } else if (analysis.intent === 'gratitude') {
                    response = generateThanksResponse();
                } else {
                    response = generateGenericResponse();
                }
            } else {
                switch(responseType) {
                    case 'compliment': response = generateComplimentResponse(); break;
                    case 'question': response = generateQuestionResponse(); break;
                    case 'request': response = generateRequestResponse(); break;
                    case 'joke': response = generateJokeResponse(); break;
                    case 'flirt': response = generateFlirtResponse(); break;
                    case 'thanks': response = generateThanksResponse(); break;
                    default: response = generateGenericResponse(); break;
                }
            }

            contextualResponse = response;
            displayResponseWithRating('contextualResponse', response, 'contextual');
        }

        // FunciÃ³n para mostrar respuestas extremas
        function displayExtremeResponse(elementId, response) {
            const element = document.getElementById(elementId);
            if (!element) return;
            
            element.innerHTML = 
                '<div style="background: linear-gradient(135deg, #e74c3c, #c0392b); border-radius: 10px; padding: 20px; border-left: 4px solid #fff;">' +
                    '<div style="display: flex; align-items: center; margin-bottom: 10px;">' +
                        '<span style="background: #fff; color: #e74c3c; padding: 4px 8px; border-radius: 12px; font-size: 11px; margin-right: 10px; font-weight: bold;">ğŸ”¥ EXTREMO</span>' +
                        '<span style="font-size: 12px; opacity: 0.9;">Modo sÃºper atrevido activado</span>' +
                    '</div>' +
                    '<div class="response-text" style="font-size: 16px; font-weight: 500; color: #fff;">' + response + '</div>' +
                '</div>' +
                '<div style="display: flex; gap: 10px; margin-top: 15px; align-items: center;">' +
                    '<span style="font-size: 12px; opacity: 0.8;">Â¿Te gustÃ³ esta respuesta extrema?</span>' +
                    '<button onclick="rateExtremeResponse(\'like\')" ' +
                            'style="background: #e74c3c; border: none; color: white; padding: 5px 10px; border-radius: 15px; cursor: pointer; font-size: 12px;">' +
                        'ğŸ”¥ Me encanta' +
                    '</button>' +
                    '<button onclick="rateExtremeResponse(\'dislike\')" ' +
                            'style="background: #95a5a6; border: none; color: white; padding: 5px 10px; border-radius: 15px; cursor: pointer; font-size: 12px;">' +
                        'ğŸ˜… Muy fuerte' +
                    '</button>' +
                '</div>';
        }

        // FunciÃ³n para alternar modalidad extrema
        function toggleExtremeMode() {
            isExtremeMode = !isExtremeMode;
            const button = document.querySelector('.extreme-toggle');
            const indicator = document.querySelector('.mode-indicator');
            
            if (isExtremeMode) {
                button.style.background = 'linear-gradient(45deg, #e74c3c, #c0392b)';
                button.innerHTML = 'ğŸ”¥ MODO EXTREMO ON';
                if (indicator) {
                    indicator.innerHTML = '<span style="color: #e74c3c; font-weight: bold;">ğŸ”¥ MODO EXTREMO ACTIVADO</span>';
                }
                alert('ğŸ”¥ MODO EXTREMO ACTIVADO - Respuestas sÃºper atrevidas y provocativas');
            } else {
                button.style.background = 'linear-gradient(45deg, #95a5a6, #7f8c8d)';
                button.innerHTML = 'ğŸ”¥ Modo Extremo';
                if (indicator) {
                    indicator.innerHTML = '<span style="color: #27ae60;">âœ“ Modo Normal</span>';
                }
                alert('âœ“ Modo normal activado - Respuestas elegantes y profesionales');
            }
        }

        // FunciÃ³n para solo verificar moderaciÃ³n sin generar respuesta (corregida)
        function checkModerationOnly() {
            const userMessage = document.getElementById('userMessage').value.trim();
            
            if (!userMessage) {
                alert('Por favor pega el mensaje del usuario para moderar');
                return;
            }

            const moderationResult = moderateContent(userMessage);
            const element = document.getElementById('contextualResponse');
            
            if (moderationResult.isAppropriate) {
                element.innerHTML = 
                    '<div style="background: rgba(46, 204, 113, 0.1); border-left: 4px solid #27ae60; padding: 15px; border-radius: 8px;">' +
                        '<div style="display: flex; align-items: center; margin-bottom: 10px;">' +
                            '<span style="background: #27ae60; color: white; padding: 4px 8px; border-radius: 12px; font-size: 11px; margin-right: 10px;">âœ“ APROPIADO</span>' +
                            '<span style="font-size: 12px; opacity: 0.8;">El mensaje es apropiado para responder</span>' +
                        '</div>' +
                        '<div style="font-size: 14px;">Puedes responder normalmente a este mensaje. No se detectÃ³ contenido inapropiado.</div>' +
                    '</div>';
            } else {
                const severityColors = {
                    mild: '#f39c12',
                    moderate: '#e67e22', 
                    severe: '#e74c3c',
                    harassment: '#c0392b',
                    explicit: '#8e44ad'
                };
                
                const severityNames = {
                    mild: 'Leve',
                    moderate: 'Moderado',
                    severe: 'Severo',
                    harassment: 'Acoso',
                    explicit: 'ExplÃ­cito'
                };
                
                const severityColor = severityColors[moderationResult.severity] || '#95a5a6';
                const severityName = severityNames[moderationResult.severity] || 'ProblemÃ¡tico';
                
                element.innerHTML = 
                    '<div style="background: rgba(231, 76, 60, 0.1); border-left: 4px solid ' + severityColor + '; padding: 15px; border-radius: 8px;">' +
                        '<div style="display: flex; align-items: center; margin-bottom: 10px;">' +
                            '<span style="background: ' + severityColor + '; color: white; padding: 4px 8px; border-radius: 12px; font-size: 11px; margin-right: 10px;">âš  ' + severityName.toUpperCase() + '</span>' +
                            '<span style="font-size: 12px; opacity: 0.8;">Contenido detectado como inapropiado</span>' +
                        '</div>' +
                        '<div style="font-size: 14px; margin-bottom: 10px;"><strong>Respuesta sugerida:</strong></div>' +
                        '<div style="font-style: italic; background: rgba(0,0,0,0.1); padding: 10px; border-radius: 6px;">' +
                            moderationResult.response +
                        '</div>' +
                        '<div style="margin-top: 10px; font-size: 12px; opacity: 0.7;">' +
                            'Tipo detectado: ' + moderationResult.type.replace('_', ' ') +
                        '</div>' +
                    '</div>';
            }
        }

        // FunciÃ³n para calificar las respuestas de moderaciÃ³n
        function rateModerationResponse(type, rating) {
            if (rating === 'helpful') {
                alert('Gracias por confirmar. ContinuarÃ© moderando apropiadamente ğŸ‘');
            } else {
                alert('Entendido. AjustarÃ© el nivel de moderaciÃ³n para ser mÃ¡s flexible ğŸ¤”');
            }
            saveData();
        }

        // FunciÃ³n para mostrar estadÃ­sticas de moderaciÃ³n (corregida)
        function showModerationStats() {
            const favoritesList = document.getElementById('favoritesList');
            const totalWarnings = userBehaviorTracker.warningsCount;
            const inappropriateCount = userBehaviorTracker.inappropriateMessages;
            const consecutiveWarnings = userBehaviorTracker.consecutiveWarnings;
            
            favoritesList.innerHTML = 
                '<div style="background: rgba(156, 39, 176, 0.2); padding: 20px; border-radius: 10px; border-left: 4px solid #9c27b0;">' +
                    '<h3 style="margin-bottom: 15px;">ğŸ›¡ï¸ EstadÃ­sticas de ModeraciÃ³n</h3>' +
                    '<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 20px;">' +
                        '<div style="background: rgba(255, 193, 7, 0.3); padding: 15px; border-radius: 8px; text-align: center;">' +
                            '<div style="font-size: 24px; font-weight: bold;">' + totalWarnings + '</div>' +
                            '<div style="font-size: 12px;">âš ï¸ Total de advertencias</div>' +
                        '</div>' +
                        '<div style="background: rgba(244, 67, 54, 0.3); padding: 15px; border-radius: 8px; text-align: center;">' +
                            '<div style="font-size: 24px; font-weight: bold;">' + inappropriateCount + '</div>' +
                            '<div style="font-size: 12px;">ğŸš« Mensajes inapropiados</div>' +
                        '</div>' +
                        '<div style="background: rgba(156, 39, 176, 0.3); padding: 15px; border-radius: 8px; text-align: center;">' +
                            '<div style="font-size: 24px; font-weight: bold;">' + consecutiveWarnings + '</div>' +
                            '<div style="font-size: 12px;">ğŸ”„ Advertencias consecutivas</div>' +
                        '</div>' +
                        '<div style="background: rgba(76, 175, 80, 0.3); padding: 15px; border-radius: 8px; text-align: center;">' +
                            '<div style="font-size: 24px; font-weight: bold;">' + (consecutiveWarnings < 2 ? 'BIEN' : 'ALERTA') + '</div>' +
                            '<div style="font-size: 12px;">ğŸ“Š Estado del usuario</div>' +
                        '</div>' +
                    '</div>' +
                    '<div style="margin-top: 20px;">' +
                        '<h4>ğŸ¯ Recomendaciones de ModeraciÃ³n:</h4>' +
                        '<div style="margin-top: 10px;">' +
                            (consecutiveWarnings === 0 ? 
                                '<span style="color: #4caf50;">âœ“ Usuario se comporta apropiadamente</span>' :
                                consecutiveWarnings < 3 ?
                                '<span style="color: #ff9800;">âš  Mantener vigilancia moderada</span>' :
                                '<span style="color: #f44336;">ğŸš¨ Considerar escalaciÃ³n o pausa</span>') +
                        '</div>' +
                        '<div style="margin-top: 15px; padding: 10px; background: rgba(0,0,0,0.1); border-radius: 6px;">' +
                            '<strong>Modo actual:</strong> ' + (isExtremeMode ? '<span style="color: #e74c3c;">ğŸ”¥ EXTREMO ACTIVADO</span>' : '<span style="color: #27ae60;">âœ“ Normal</span>') +
                        '</div>' +
                    '</div>' +
                '</div>';
        }

        // FunciÃ³n especial para mostrar respuestas de moderaciÃ³n
        function displayModerationResponse(elementId, response, moderationResult) {
            const element = document.getElementById(elementId);
            if (!element) return;
            
            const severityColors = {
                mild: '#f39c12',
                moderate: '#e67e22', 
                severe: '#e74c3c',
                harassment: '#c0392b',
                explicit: '#8e44ad'
            };
            
            const severityColor = severityColors[moderationResult.severity] || '#95a5a6';
            
            element.innerHTML = 
                '<div style="background: rgba(230, 126, 34, 0.1); border-left: 4px solid ' + severityColor + '; padding: 15px; border-radius: 8px; margin-bottom: 10px;">' +
                    '<div style="display: flex; align-items: center; margin-bottom: 10px;">' +
                        '<span style="background: ' + severityColor + '; color: white; padding: 4px 8px; border-radius: 12px; font-size: 11px; margin-right: 10px;">MODERADO</span>' +
                        '<span style="font-size: 12px; opacity: 0.8;">Respuesta automÃ¡tica por contenido inapropiado</span>' +
                    '</div>' +
                    '<div class="response-text" style="font-style: normal;">' + response + '</div>' +
                '</div>' +
                '<div style="display: flex; gap: 10px; margin-top: 15px; align-items: center;">' +
                    '<span style="font-size: 12px; opacity: 0.8;">Â¿Fue apropiada esta moderaciÃ³n?</span>' +
                    '<button onclick="rateModerationResponse(\'' + moderationResult.type + '\', \'helpful\')" ' +
                            'style="background: #27ae60; border: none; color: white; padding: 5px 10px; border-radius: 15px; cursor: pointer; font-size: 12px;">' +
                        'âœ“ Apropiada' +
                    '</button>' +
                    '<button onclick="rateModerationResponse(\'' + moderationResult.type + '\', \'too_strict\')" ' +
                            'style="background: #f39c12; border: none; color: white; padding: 5px 10px; border-radius: 15px; cursor: pointer; font-size: 12px;">' +
                        'âš  Muy estricta' +
                    '</button>' +
                '</div>';
        }

        // FunciÃ³n para calificar las respuestas de moderaciÃ³n
        function rateModerationResponse(type, rating) {
            if (rating === 'helpful') {
                alert('Gracias por confirmar. ContinuarÃ© moderando apropiadamente ğŸ‘');
            } else {
                alert('Entendido. AjustarÃ© el nivel de moderaciÃ³n para ser mÃ¡s flexible ğŸ¤”');
            }
            
            // AquÃ­ se podrÃ­a ajustar la sensibilidad del sistema basado en feedback
            saveData();
        }

        // FunciÃ³n para mostrar estadÃ­sticas de moderaciÃ³n
        function showModerationStats() {
            const favoritesList = document.getElementById('favoritesList');
            const totalWarnings = userBehaviorTracker.warningsCount;
            const inappropriateCount = userBehaviorTracker.inappropriateMessages;
            const consecutiveWarnings = userBehaviorTracker.consecutiveWarnings;
            
            favoritesList.innerHTML = 
                '<div style="background: rgba(156, 39, 176, 0.2); padding: 20px; border-radius: 10px; border-left: 4px solid #9c27b0;">' +
                    '<h3 style="margin-bottom: 15px;">ğŸ›¡ï¸ EstadÃ­sticas de ModeraciÃ³n</h3>' +
                    '<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 20px;">' +
                        '<div style="background: rgba(255, 193, 7, 0.3); padding: 15px; border-radius: 8px; text-align: center;">' +
                            '<div style="font-size: 24px; font-weight: bold;">' + totalWarnings + '</div>' +
                            '<div style="font-size: 12px;">âš ï¸ Total de advertencias</div>' +
                        '</div>' +
                        '<div style="background: rgba(244, 67, 54, 0.3); padding: 15px; border-radius: 8px; text-align: center;">' +
                            '<div style="font-size: 24px; font-weight: bold;">' + inappropriateCount + '</div>' +
                            '<div style="font-size: 12px;">ğŸš« Mensajes inapropiados</div>' +
                        '</div>' +
                        '<div style="background: rgba(156, 39, 176, 0.3); padding: 15px; border-radius: 8px; text-align: center;">' +
                            '<div style="font-size: 24px; font-weight: bold;">' + consecutiveWarnings + '</div>' +
                            '<div style="font-size: 12px;">ğŸ”„ Advertencias consecutivas</div>' +
                        '</div>' +
                        '<div style="background: rgba(76, 175, 80, 0.3); padding: 15px; border-radius: 8px; text-align: center;">' +
                            '<div style="font-size: 24px; font-weight: bold;">' + (consecutiveWarnings < 2 ? 'BIEN' : 'ALERTA') + '</div>' +
                            '<div style="font-size: 12px;">ğŸ“Š Estado del usuario</div>' +
                        '</div>' +
                    '</div>' +
                    '<div style="margin-top: 20px;">' +
                        '<h4>ğŸ¯ Recomendaciones de ModeraciÃ³n:</h4>' +
                        '<div style="margin-top: 10px;">' +
                            (consecutiveWarnings === 0 ? 
                                '<span style="color: #4caf50;">âœ“ Usuario se comporta apropiadamente</span>' :
                                consecutiveWarnings < 3 ?
                                '<span style="color: #ff9800;">âš  Mantener vigilancia moderada</span>' :
                                '<span style="color: #f44336;">ğŸš¨ Considerar escalaciÃ³n o pausa</span>') +
                        '</div>' +
                    '</div>' +
                '</div>';
        }};
                
        // FunciÃ³n para solo verificar moderaciÃ³n sin generar respuesta
        function checkModerationOnly() {
            const userMessage = document.getElementById('userMessage').value.trim();
            
            if (!userMessage) {
                alert('Por favor pega el mensaje del usuario para moderar');
                return;
            }

            const moderationResult = moderateContent(userMessage);
            const element = document.getElementById('contextualResponse');
            
            if (moderationResult.isAppropriate) {
                element.innerHTML = 
                    '<div style="background: rgba(46, 204, 113, 0.1); border-left: 4px solid #27ae60; padding: 15px; border-radius: 8px;">' +
                        '<div style="display: flex; align-items: center; margin-bottom: 10px;">' +
                            '<span style="background: #27ae60; color: white; padding: 4px 8px; border-radius: 12px; font-size: 11px; margin-right: 10px;">âœ“ APROPIADO</span>' +
                            '<span style="font-size: 12px; opacity: 0.8;">El mensaje es apropiado para responder</span>' +
                        '</div>' +
                        '<div style="font-size: 14px;">Puedes responder normalmente a este mensaje. No se detectÃ³ contenido inapropiado.</div>' +
                    '</div>';
            } else {
                const severityColors = {
                    mild: '#f39c12',
                    moderate: '#e67e22', 
                    severe: '#e74c3c',
                    harassment: '#c0392b',
                    explicit: '#8e44ad'
                };
                
                const severityNames = {
                    mild: 'Leve',
                    moderate: 'Moderado',
                    severe: 'Severo',
                    harassment: 'Acoso',
                    explicit: 'ExplÃ­cito'
                };
                
                const severityColor = severityColors[moderationResult.severity] || '#95a5a6';
                const severityName = severityNames[moderationResult.severity] || 'ProblemÃ¡tico';
                
                element.innerHTML = 
                    '<div style="background: rgba(231, 76, 60, 0.1); border-left: 4px solid ' + severityColor + '; padding: 15px; border-radius: 8px;">' +
                        '<div style="display: flex; align-items: center; margin-bottom: 10px;">' +
                            '<span style="background: ' + severityColor + '; color: white; padding: 4px 8px; border-radius: 12px; font-size: 11px; margin-right: 10px;">âš  ' + severityName.toUpperCase() + '</span>' +
                            '<span style="font-size: 12px; opacity: 0.8;">Contenido detectado como inapropiado</span>' +
                        '</div>' +
                        '<div style="font-size: 14px; margin-bottom: 10px;"><strong>Respuesta sugerida:</strong></div>' +
                        '<div style="font-style: italic; background: rgba(0,0,0,0.1); padding: 10px; border-radius: 6px;">' +
                            moderationResult.response +
                        '</div>' +
                        '<div style="margin-top: 10px; font-size: 12px; opacity: 0.7;">' +
                            'Tipo detectado: ' + moderationResult.type.replace('_', ' ') +
                        '</div>' +
                    '</div>';
            }
        }

        // FunciÃ³n para mostrar respuesta con rating
        function displayResponseWithRating(elementId, response, type) {
            const element = document.getElementById(elementId);
            if (!element) return;
            
            const safeResponse = response.replace(/'/g, "&#39;").replace(/"/g, "&quot;");
            const safeType = type.replace(/'/g, "&#39;").replace(/"/g, "&quot;");
            
            element.innerHTML = 
                '<div class="response-text">' + response + '</div>' +
                '<div style="display: flex; gap: 10px; margin-top: 15px; align-items: center;">' +
                    '<span style="font-size: 12px; opacity: 0.8;">Â¿Te gustÃ³ esta respuesta?</span>' +
                    '<button onclick="rateResponse(\'' + safeResponse + '\', \'' + safeType + '\', \'like\')" ' +
                            'style="background: #2ecc71; border: none; color: white; padding: 5px 10px; border-radius: 15px; cursor: pointer; font-size: 12px;">' +
                        'ğŸ‘ Me gusta' +
                    '</button>' +
                    '<button onclick="rateResponse(\'' + safeResponse + '\', \'' + safeType + '\', \'dislike\')" ' +
                            'style="background: #e74c3c; border: none; color: white; padding: 5px 10px; border-radius: 15px; cursor: pointer; font-size: 12px;">' +
                        'ğŸ‘ No me gusta' +
                    '</button>' +
                '</div>';
        }

        // FunciÃ³n para calificar respuesta
        function rateResponse(response, type, rating) {
            const cleanResponse = response.replace(/&#39;/g, "'").replace(/&quot;/g, '"');
            const key = cleanResponse.substring(0, 50);

            if (!responseRatings[key]) {
                responseRatings[key] = { likes: 0, dislikes: 0, type: type, fullText: cleanResponse };
            }

            if (rating === 'like') {
                responseRatings[key].likes++;
                alert('Â¡Gracias! TomarÃ© en cuenta que te gustÃ³ esta respuesta ğŸ˜Š');
            } else {
                responseRatings[key].dislikes++;
                alert('Entendido, buscarÃ© respuestas mejores la prÃ³xima vez ğŸ¤”');
            }

            saveData();
        }

        // FunciÃ³n para traducir
        function translateResponse(elementId) {
            const element = document.getElementById(elementId);
            if (!element) return;
            
            const responseDiv = element.querySelector('.response-text');

            if (!responseDiv) {
                alert('Primero genera una respuesta para traducir');
                return;
            }

            const text = responseDiv.textContent.trim();

            if (!text || text.includes('Haz clic') || text.includes('Configura') || text.includes('Pega el mensaje')) {
                alert('Primero genera una respuesta para traducir');
                return;
            }

            let translatedText = text;

            // Traducir frases completas
            const phraseTranslations = {
                'me gusta cÃ³mo': 'I like how',
                'me encanta cuando': 'I love when',
                'quÃ© lindo eres': 'how sweet you are',
                'eres muy': 'you are very',
                'me haces': 'you make me',
                'de nada': 'you\'re welcome'
            };

            for (const [spanish, english] of Object.entries(phraseTranslations)) {
                const regex = new RegExp(spanish, 'gi');
                translatedText = translatedText.replace(regex, english);
            }

            // Traducir palabras individuales
            for (const [spanish, english] of Object.entries(translations)) {
                const regex = new RegExp('\\b' + spanish + '\\b', 'gi');
                translatedText = translatedText.replace(regex, english);
            }

            // Reglas gramaticales
            translatedText = translatedText
                .replace(/Â¿([^?]+)\?/g, '$1?')
                .replace(/Â¡([^!]+)!/g, '$1!')
                .replace(/\bI am\b/g, 'I\'m')
                .replace(/\byou are\b/g, 'you\'re')
                .trim();

            translatedText = translatedText.charAt(0).toUpperCase() + translatedText.slice(1);

            if (!translatedText.match(/[.!?]$/)) {
                translatedText += '.';
            }

            const safeText = text.replace(/'/g, "&#39;").replace(/"/g, "&quot;");
            const safeTranslation = translatedText.replace(/'/g, "&#39;").replace(/"/g, "&quot;");

            element.innerHTML = 
                '<div style="margin-bottom: 15px;">' +
                    '<div style="background: rgba(255,255,255,0.1); padding: 10px; border-radius: 8px; border-left: 3px solid #ff6b6b;">' +
                        '<strong>ğŸ‡ªğŸ‡¸ EspaÃ±ol:</strong><br>' +
                        text +
                    '</div>' +
                '</div>' +
                '<div style="background: rgba(46, 204, 113, 0.2); padding: 15px; border-radius: 8px; border-left: 3px solid #2ecc71;">' +
                    '<strong>ğŸ‡ºğŸ‡¸ English:</strong><br>' +
                    '<span style="font-size: 16px; font-weight: 500;">' + translatedText + '</span>' +
                '</div>' +
                '<div style="display: flex; gap: 10px; margin-top: 15px;">' +
                    '<button onclick="restoreOriginal(\'' + elementId + '\', \'' + safeText + '\')" ' +
                            'style="padding: 8px 15px; font-size: 12px; background: linear-gradient(45deg, #95a5a6, #7f8c8d); border: none; color: white; border-radius: 20px; cursor: pointer;">' +
                        'ğŸ”„ Volver al original' +
                    '</button>' +
                    '<button onclick="copyToClipboard(\'' + safeTranslation + '\')" ' +
                            'style="padding: 8px 15px; font-size: 12px; background: linear-gradient(45deg, #3498db, #2980b9); border: none; color: white; border-radius: 20px; cursor: pointer;">' +
                        'ğŸ“‹ Copiar traducciÃ³n' +
                    '</button>' +
                '</div>';
        }

        // FunciÃ³n para restaurar original
        function restoreOriginal(elementId, originalText) {
            const element = document.getElementById(elementId);
            const cleanText = originalText.replace(/&#39;/g, "'").replace(/&quot;/g, '"');
            element.innerHTML = `<div class="response-text">${cleanText}</div>`;
        }

        // FunciÃ³n para copiar al portapapeles
        function copyToClipboard(translatedText) {
            const cleanText = translatedText.replace(/&#39;/g, "'").replace(/&quot;/g, '"');
            navigator.clipboard.writeText(cleanText).then(() => {
                alert('Â¡TraducciÃ³n copiada al portapapeles!');
            }).catch(() => {
                const textArea = document.createElement('textarea');
                textArea.value = cleanText;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                alert('Â¡TraducciÃ³n copiada al portapapeles!');
            });
        }

        // Funciones para favoritos
        function saveToFavorites() {
            if (!currentResponse) {
                alert('Primero genera una respuesta para guardar');
                return;
            }
            if (favorites.includes(currentResponse)) {
                alert('Esta respuesta ya estÃ¡ en tus favoritos');
                return;
            }
            favorites.push(currentResponse);
            saveData();
            updateFavoritesList();
            alert('Â¡Respuesta guardada en favoritos!');
        }

        function saveCustomToFavorites() {
            if (!customResponse) {
                alert('Primero genera una respuesta personalizada');
                return;
            }
            if (favorites.includes(customResponse)) {
                alert('Esta respuesta ya estÃ¡ en favoritos');
                return;
            }
            favorites.push(customResponse);
            saveData();
            updateFavoritesList();
            alert('Â¡Respuesta guardada!');
        }

        function saveContextualToFavorites() {
            if (!contextualResponse) {
                alert('Primero genera una respuesta contextual');
                return;
            }
            if (favorites.includes(contextualResponse)) {
                alert('Esta respuesta ya estÃ¡ en favoritos');
                return;
            }
            favorites.push(contextualResponse);
            saveData();
            updateFavoritesList();
            alert('Â¡Respuesta guardada!');
        }

        function deleteFavorite(index) {
            if (index >= 0 && index < favorites.length) {
                favorites.splice(index, 1);
                saveData();
                updateFavoritesList();
            }
        }

        function showFavorites() {
            const favoritesList = document.getElementById('favoritesList');
            if (favorites.length === 0) {
                favoritesList.innerHTML = '<p style="text-align: center; opacity: 0.6;">No tienes respuestas favoritas aÃºn</p>';
            } else {
                const favoritesHTML = favorites.map(function(fav, index) {
                    return '<div class="favorite-item">' +
                           '<button class="delete-btn" onclick="deleteFavorite(' + index + ')">Ã—</button>' +
                           fav +
                           '</div>';
                }).join('');
                favoritesList.innerHTML = favoritesHTML;
            }
        }

        function showStats() {
            const favoritesList = document.getElementById('favoritesList');
            const totalRatings = Object.keys(responseRatings).length;
            const totalLikes = Object.values(responseRatings).reduce(function(sum, rating) { 
                return sum + rating.likes; 
            }, 0);
            const totalDislikes = Object.values(responseRatings).reduce(function(sum, rating) { 
                return sum + rating.dislikes; 
            }, 0);
            const totalPatterns = Object.keys(userPatterns).length;

            const sortedPatterns = Object.entries(userPatterns)
                .sort(function(a, b) { return b[1] - a[1]; })
                .slice(0, 10);

            const patternHTML = sortedPatterns.map(function(item) {
                return '<span style="background: rgba(255,255,255,0.2); padding: 5px 10px; border-radius: 15px; font-size: 12px;">' +
                       item[0] + ' (' + item[1] + ')' +
                       '</span>';
            }).join('');

            favoritesList.innerHTML = 
                '<div style="background: rgba(155, 89, 182, 0.2); padding: 20px; border-radius: 10px; border-left: 4px solid #9b59b6;">' +
                    '<h3 style="margin-bottom: 15px;">ğŸ“Š EstadÃ­sticas de Aprendizaje</h3>' +
                    '<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">' +
                        '<div style="background: rgba(46, 204, 113, 0.3); padding: 15px; border-radius: 8px; text-align: center;">' +
                            '<div style="font-size: 24px; font-weight: bold;">' + totalLikes + '</div>' +
                            '<div style="font-size: 12px;">ğŸ‘ Respuestas que gustaron</div>' +
                        '</div>' +
                        '<div style="background: rgba(231, 76, 60, 0.3); padding: 15px; border-radius: 8px; text-align: center;">' +
                            '<div style="font-size: 24px; font-weight: bold;">' + totalDislikes + '</div>' +
                            '<div style="font-size: 12px;">ğŸ‘ Respuestas a mejorar</div>' +
                        '</div>' +
                        '<div style="background: rgba(52, 152, 219, 0.3); padding: 15px; border-radius: 8px; text-align: center;">' +
                            '<div style="font-size: 24px; font-weight: bold;">' + totalPatterns + '</div>' +
                            '<div style="font-size: 12px;">ğŸ”¤ Palabras aprendidas</div>' +
                        '</div>' +
                        '<div style="background: rgba(241, 196, 15, 0.3); padding: 15px; border-radius: 8px; text-align: center;">' +
                            '<div style="font-size: 24px; font-weight: bold;">' + Math.round((totalLikes / (totalLikes + totalDislikes || 1)) * 100) + '%</div>' +
                            '<div style="font-size: 12px;">ğŸ“ˆ Tasa de Ã©xito</div>' +
                        '</div>' +
                    '</div>' +
                    '<div style="margin-top: 20px;">' +
                        '<h4>ğŸ”¥ Palabras mÃ¡s usadas por usuarios:</h4>' +
                        '<div style="display: flex; flex-wrap: wrap; gap: 8px; margin-top: 10px;">' +
                            patternHTML +
                        '</div>' +
                    '</div>' +
                '</div>';
        }

        function exportData() {
            const data = {
                favorites: favorites,
                ratings: responseRatings,
                patterns: userPatterns,
                exportDate: new Date().toISOString()
            };

            const jsonData = JSON.stringify(data, null, 2);
            const blob = new Blob([jsonData], { type: 'application/json' });
            const url = URL.createObjectURL(blob);

            const a = document.createElement('a');
            a.href = url;
            a.download = `respuestas_datos_${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);

            alert('ğŸ“ Datos exportados exitosamente');
        }

        function updateFavoritesList() {
            showFavorites();
            const favCount = document.getElementById('favCount');
            if (favCount) {
                favCount.textContent = favorites.length;
            }
        }

        function initializeEventListeners() {
            const intensitySlider = document.getElementById('intensityLevel');
            if (intensitySlider) {
                intensitySlider.addEventListener('input', function() {
                    const intensityValue = document.getElementById('intensityValue');
                    if (intensityValue) {
                        intensityValue.textContent = this.value;
                    }
                });
            }

            const customKeyword = document.getElementById('customKeyword');
            if (customKeyword) {
                customKeyword.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        generateAdvancedCustom();
                    }
                });
            }

            const userMessage = document.getElementById('userMessage');
            if (userMessage) {
                userMessage.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter' && e.ctrlKey) {
                        generateContextualResponse();
                    }
                });
            }
        }

        function initializeApp() {
            loadData();
            updateFavoritesList();
            initializeEventListeners();
        }

        // Inicializar cuando el DOM estÃ© listo
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initializeApp);
        } else {
            setTimeout(initializeApp, 100);
        }
    </script>                userPatterns[cleanWord]++;
            });
            saveData(); // Usar funciÃ³n segura
        }

        function displayResponseWithRating(elementId, response, type) {
            const element = document.getElementById(elementId);
            const safeResponse = response.replace(/'/g, "&#39;").replace(/"/g, "&quot;");
            element.innerHTML = `
                <div class="response-text<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generador de Respuestas Creativas</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .main-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
        }

        .card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 25px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .card h2 {
            margin-bottom: 20px;
            color: #fff;
            font-size: 1.5em;
        }

        .category-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .btn {
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
            border: none;
            color: white;
            padding: 12px 20px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
            background: linear-gradient(45deg, #ee5a24, #ff6b6b);
        }

        .btn.secondary {
            background: linear-gradient(45deg, #5f27cd, #341f97);
        }

        .btn.secondary:hover {
            background: linear-gradient(45deg, #341f97, #5f27cd);
        }

        .response-area {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
            padding: 20px;
            min-height: 150px;
            margin-top: 20px;
            border-left: 4px solid #ff6b6b;
        }

        .response-text {
            font-size: 16px;
            line-height: 1.6;
            font-style: italic;
        }

        .input-section {
            margin-bottom: 20px;
        }

        .input-section input, .input-section select, .input-section textarea {
            width: 100%;
            padding: 12px;
            border-radius: 8px;
            border: none;
            background: rgba(255, 255, 255, 0.9);
            color: #333;
            font-size: 16px;
            margin-bottom: 10px;
        }

        .input-section input::placeholder, .input-section textarea::placeholder {
            color: #666;
        }

        .favorites {
            grid-column: 1 / -1;
        }

        .favorites-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .favorite-item {
            background: rgba(0, 0, 0, 0.2);
            padding: 15px;
            border-radius: 8px;
            border-left: 3px solid #ff6b6b;
            position: relative;
        }

        .delete-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #e74c3c;
            border: none;
            color: white;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 12px;
        }

        .stats {
            text-align: center;
            margin-top: 20px;
            font-size: 14px;
            opacity: 0.8;
        }

        @media (max-width: 768px) {
            .main-grid {
                grid-template-columns: 1fr;
            }
            
            .category-buttons {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 2em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>âœ¨ Generador de Respuestas Creativas âœ¨</h1>
            <p>Herramienta profesional para respuestas inteligentes y atractivas</p>
        </div>

        <div class="main-content">
            <div class="main-grid">
                <div class="card">
                    <h2>ğŸ¯ CategorÃ­as de Respuestas</h2>
                    <div class="category-buttons">
                        <button class="btn" onclick="generateByCategory('coquetas')">Coquetas</button>
                        <button class="btn" onclick="generateByCategory('divertidas')">Divertidas</button>
                        <button class="btn" onclick="generateByCategory('misteriosas')">Misteriosas</button>
                        <button class="btn" onclick="generateByCategory('halagadoras')">Halagadoras</button>
                        <button class="btn" onclick="generateByCategory('juguetonas')">Juguetonas</button>
                        <button class="btn" onclick="generateByCategory('seductoras')">Seductoras</button>
                        <button class="btn" onclick="generateByCategory('dulces')" style="background: linear-gradient(45deg, #ff9ff3, #f368e0);">Dulces</button>
                        <button class="btn" onclick="generateByCategory('atrevidas')" style="background: linear-gradient(45deg, #ff3838, #ff6b35);">Atrevidas</button>
                        <button class="btn" onclick="generateByCategory('romanticas')" style="background: linear-gradient(45deg, #fa7cd2, #ff7675);">RomÃ¡nticas</button>
                    </div>
                    
                    <div class="response-area">
                        <div class="response-text" id="generatedResponse">
                            Haz clic en una categorÃ­a para generar una respuesta creativa...
                        </div>
                    </div>
                    
                    <div style="display: flex; gap: 10px; margin-top: 15px;">
                        <button class="btn secondary" onclick="saveToFavorites()" style="flex: 1;">
                            ğŸ’– Guardar en Favoritos
                        </button>
                        <button class="btn" onclick="translateResponse('generatedResponse')" style="flex: 1; background: linear-gradient(45deg, #2ecc71, #27ae60);">
                            ğŸŒ Traducir al InglÃ©s
                        </button>
                    </div>
                </div>

                <div class="card">
                    <h2>ğŸ¨ Generador Personalizado</h2>
                    <div class="input-section">
                        <input type="text" id="customKeyword" placeholder="Palabra clave o tema principal...">
                        <select id="responseStyle">
                            <option value="flirty">Coqueta y juguetona</option>
                            <option value="sweet">Dulce y halagadora</option>
                            <option value="mysterious">Misteriosa e intrigante</option>
                            <option value="funny">Divertida y graciosa</option>
                            <option value="seductive">Seductora y directa</option>
                            <option value="friendly">Amigable y cercana</option>
                        </select>
                        <input type="range" id="intensityLevel" min="1" max="5" value="3" style="width: 100%; margin-bottom: 10px;">
                        <label style="font-size: 12px; opacity: 0.8;">
                            Nivel de intensidad: <span id="intensityValue">3</span>/5
                            <span class="intensity-indicator" style="margin-left: 10px; font-size: 10px;"></span>
                        </label>
                        <button class="btn" onclick="generateAdvancedCustom()" style="width: 100%; margin-top: 10px;">
                            ğŸ¯ Generar Respuesta Avanzada
                        </button>
                    </div>

                    <div class="response-area">
                        <div class="response-text" id="customResponse">
                            Configura los parÃ¡metros y genera una respuesta personalizada...
                        </div>
                    </div>
                    
                    <div style="display: flex; gap: 10px; margin-top: 15px;">
                        <button class="btn secondary" onclick="saveCustomToFavorites()" style="flex: 1;">
                            ğŸ’– Guardar Favorito
                        </button>
                        <button class="btn" onclick="translateResponse('customResponse')" style="flex: 1; background: linear-gradient(45deg, #2ecc71, #27ae60);">
                            ğŸŒ Traducir al InglÃ©s
                        </button>
                    </div>
                </div>
            </div>

            <div class="card">
                <h2>ğŸ’¬ Responder a Usuario</h2>
                <div class="input-section">
                    <textarea id="userMessage" placeholder="Pega aquÃ­ el mensaje del usuario..." style="min-height: 80px; resize: vertical;"></textarea>
                    <select id="responseType">
                        <option value="auto">ğŸ¤– Respuesta AutomÃ¡tica (AI)</option>
                        <option value="compliment">ğŸ’• Respuesta a Halago</option>
                        <option value="question">â“ Respuesta a Pregunta</option>
                        <option value="request">ğŸ™ Respuesta a Solicitud</option>
                        <option value="joke">ğŸ˜‚ Respuesta a Broma</option>
                        <option value="flirt">ğŸ˜˜ Respuesta Coqueta</option>
                        <option value="thanks">ğŸ™ Agradecimiento</option>
                    </select>
                    <div style="display: flex; gap: 10px; margin-bottom: 10px;">
                        <button class="btn" onclick="generateContextualResponse()" style="flex: 2;">
                            ğŸ­ Generar Respuesta Contextual
                        </button>
                        <button class="btn" onclick="checkModerationOnly()" style="flex: 1; background: linear-gradient(45deg, #9b59b6, #8e44ad); font-size: 12px;">
                            ğŸ›¡ï¸ Solo Moderar
                        </button>
                    </div>
                    <div style="display: flex; gap: 10px; margin-bottom: 10px;">
                        <button class="btn extreme-toggle" onclick="toggleExtremeMode()" style="flex: 1; background: linear-gradient(45deg, #95a5a6, #7f8c8d); font-size: 12px;">
                            ğŸ”¥ Modo Extremo
                        </button>
                        <div class="mode-indicator" style="flex: 1; display: flex; align-items: center; justify-content: center; font-size: 12px;">
                            <span style="color: #27ae60;">âœ“ Modo Normal</span>
                        </div>
                    </div>
                </div>

                <div class="response-area">
                    <div class="response-text" id="contextualResponse">
                        Pega el mensaje del usuario para generar una respuesta perfecta...
                    </div>
                </div>
                
                <div style="display: flex; gap: 10px; margin-top: 15px;">
                    <button class="btn secondary" onclick="saveContextualToFavorites()" style="flex: 1;">
                        ğŸ’– Guardar Favorito
                    </button>
                    <button class="btn" onclick="translateResponse('contextualResponse')" style="flex: 1; background: linear-gradient(45deg, #2ecc71, #27ae60);">
                        ğŸŒ Traducir al InglÃ©s
                    </button>
                </div>
            </div>
        </div>

        <div class="card favorites">
            <h2>â­ Respuestas Favoritas</h2>
            <div style="display: flex; gap: 10px; margin-bottom: 15px;">
                <button class="btn secondary" onclick="showFavorites()" style="flex: 1; font-size: 12px;">
                    ğŸ’– Ver Favoritos
                </button>
                <button class="btn" onclick="showStats()" style="flex: 1; font-size: 12px; background: linear-gradient(45deg, #9b59b6, #8e44ad);">
                    ğŸ“Š EstadÃ­sticas de Aprendizaje
                </button>
                <button class="btn" onclick="showModerationStats()" style="flex: 1; font-size: 12px; background: linear-gradient(45deg, #e91e63, #ad1457);">
                    ğŸ›¡ï¸ ModeraciÃ³n
                </button>
                <button class="btn" onclick="exportData()" style="flex: 1; font-size: 12px; background: linear-gradient(45deg, #f39c12, #e67e22);">
                    ğŸ“¤ Exportar
                </button>
            </div>
            <div class="favorites-list" id="favoritesList">
                <!-- Favoritos se cargarÃ¡n aquÃ­ -->
            </div>
            <div class="stats">
                <p>Total de favoritos: <span id="favCount">0</span></p>
            </div>
        </div>
    </div>

    <script>
        // Variables globales (sin localStorage por restricciones del sandbox)
        let favorites = [];
        let currentResponse = '';
        let customResponse = '';
        let contextualResponse = '';
        let responseRatings = {};
        let userPatterns = {};

        // FunciÃ³n segura para manejar datos sin localStorage
        function saveData() {
            // En un entorno real, estos datos se guardarÃ­an en localStorage
            // Por ahora solo los mantenemos en memoria durante la sesiÃ³n
            console.log('Datos guardados en memoria de sesiÃ³n');
        }

        function loadData() {
            // Inicializar con datos por defecto
            favorites = [];
            responseRatings = {};
            userPatterns = {};
        }

        // Base de datos EXPANDIDA de respuestas
        const responses = {
            coquetas: [
                "Â¿Sabes quÃ©? Creo que acabas de alegrarme el dÃ­a con ese comentario ğŸ˜Š",
                "Mmm, me gusta cÃ³mo piensas... cuÃ©ntame mÃ¡s",
                "Tienes buen gusto, debo admitirlo ğŸ˜‰",
                "Eres todo un encanto, Â¿lo sabÃ­as?",
                "Me haces sonreÃ­r sin poder evitarlo",
                "Vaya, vaya... alguien sabe cÃ³mo conquistar con palabras",
                "Creo que me estÃ¡s robando el corazÃ³n poco a poco",
                "Ay, me haces sentir mariposas en el estÃ³mago ğŸ¦‹",
                "Tienes una forma muy dulce de decir las cosas",
                "Me gusta cuando eres asÃ­ de directo conmigo"
            ],
            divertidas: [
                "Â¡Ja! Definitivamente tienes sentido del humor, me caes bien",
                "Â¿En serio acabas de decir eso? Me has hecho reÃ­r en voz alta",
                "Eres mÃ¡s divertido de lo que esperaba... me gusta",
                "Ok, esa fue buena, te doy puntos por creatividad",
                "Â¿De dÃ³nde sacas estas ocurrencias? Me encanta tu mente",
                "Creo que acabas de ganar el premio al comentario mÃ¡s original del dÃ­a",
                "Me haces reÃ­r tanto que casi se me cae el cafÃ©",
                "Â¡Jajaja! Eres un caso perdido, pero me encantas asÃ­",
                "Tienes un humor tan particular, me divierte mucho"
            ],
            misteriosas: [
                "Hay algo en ti que me intriga... no logro descifrarte",
                "Mmm, interesante perspectiva... me haces pensar",
                "Tienes una forma muy particular de ver las cosas",
                "Hay mÃ¡s de lo que muestras, Â¿verdad?",
                "Me pregunto quÃ© otras sorpresas guardas",
                "Eres como un libro que apenas estoy empezando a leer",
                "Cada vez que hablas, descubro algo nuevo",
                "Me fascina la profundidad de tu mente"
            ],
            halagadoras: [
                "Wow, quÃ© detallista eres... se nota que tienes clase",
                "Me encanta cÃ³mo me haces sentir especial",
                "Tienes un don para hacer que una chica se sienta Ãºnica",
                "Eres increÃ­blemente dulce, Â¿sabes eso?",
                "Me fascina tu forma de expresarte",
                "Tienes una energÃ­a muy positiva, es contagiosa",
                "Eres el tipo de persona que ilumina el dÃ­a de otros",
                "Tu forma de tratarme me hace sentir como una reina"
            ],
            juguetonas: [
                "Â¿A que no te atreves a decir eso otra vez? ğŸ˜",
                "Uy, alguien estÃ¡ siendo travieso hoy...",
                "Me gusta este juego, pero yo tambiÃ©n sÃ© jugar",
                "Â¿Eso es todo lo que tienes? Esperaba mÃ¡s de ti",
                "Creo que subestimas mi lado juguetÃ³n",
                "Cuidado, porque puedo ser mÃ¡s traviesa de lo que imaginas",
                "Â¿Jugamos? Pero te advierto que soy muy competitiva",
                "Me gusta cuando sacas tu lado atrevido"
            ],
            seductoras: [
                "Sabes exactamente quÃ© decir para captar mi atenciÃ³n",
                "Me gusta cÃ³mo me miras... a travÃ©s de la pantalla",
                "Tienes algo especial que me atrae",
                "Eres peligrosamente encantador",
                "Me haces sentir cosas que no esperaba",
                "Hay una quÃ­mica entre nosotros que no puedo negar",
                "Tienes una forma muy seductora de expresarte",
                "Me tienes completamente bajo tu hechizo"
            ],
            dulces: [
                "Eres tan tierno, me derrites el corazÃ³n ğŸ’•",
                "Tu dulzura me hace sonreÃ­r como tonta",
                "Me encantas cuando eres asÃ­ de adorable",
                "Tienes el corazÃ³n mÃ¡s bonito que he conocido",
                "Eres como un rayito de sol en mi dÃ­a",
                "Tu ternura me hace sentir protegida",
                "Me encanta lo cariÃ±oso que eres"
            ],
            atrevidas: [
                "Mmm, me gusta tu lado atrevido ğŸ”¥",
                "Â¿AsÃ­ que quieres jugar con fuego?",
                "Me encanta cuando sacas tu lado salvaje",
                "Tienes ideas muy interesantes... me intrigas",
                "Eres mÃ¡s atrevido de lo que pensÃ©, me gusta",
                "Â¿EstÃ¡s seguro de que puedes manejar a una chica como yo?",
                "Me gusta cuando eres asÃ­ de directo"
            ],
            romanticas: [
                "Eres como un sueÃ±o hecho realidad",
                "Me haces creer en los cuentos de hadas",
                "Tienes algo mÃ¡gico que me enamora",
                "Contigo el mundo se ve mÃ¡s bonito",
                "Eres mi lugar favorito en el universo",
                "Me haces sentir como en una pelÃ­cula romÃ¡ntica",
                "Tu amor es como una melodÃ­a perfecta"
            ]
        };

        // Diccionario completo de traducciones
        const translations = {
            'hola': 'hello', 'amor': 'love', 'cariÃ±o': 'honey', 'corazÃ³n': 'heart',
            'hermosa': 'beautiful', 'bella': 'gorgeous', 'linda': 'pretty', 'sexy': 'sexy',
            'me gusta': 'I like', 'me encanta': 'I love', 'me fascina': 'I\'m fascinated',
            'gracias': 'thank you', 'de nada': 'you\'re welcome', 'feliz': 'happy',
            'contenta': 'happy', 'hoy': 'today', 'siempre': 'always', 'pero': 'but',
            'porque': 'because', 'muy': 'very', 'bueno': 'good', 'malo': 'bad',
            'sÃ­': 'yes', 'no': 'no', 'quÃ©': 'what', 'cÃ³mo': 'how', 'cuÃ¡ndo': 'when',
            'dÃ³nde': 'where', 'por quÃ©': 'why', 'de': 'of', 'en': 'in', 'con': 'with',
            'la': 'the', 'el': 'the', 'y': 'and', 'o': 'or', 'que': 'that',
            'es': 'is', 'eres': 'you are', 'soy': 'I am', 'tienes': 'you have'
        };

        function generateByCategory(category) {
            const categoryResponses = responses[category];
            if (!categoryResponses) {
                alert('CategorÃ­a no encontrada');
                return;
            }
            const randomResponse = categoryResponses[Math.floor(Math.random() * categoryResponses.length)];
            currentResponse = randomResponse;
            displayResponseWithRating('generatedResponse', randomResponse, category);
        }

        // Base de datos inteligente de temas y contextos
        const themeDatabase = {
            // Temas romÃ¡nticos
            amor: ['amor', 'corazÃ³n', 'sentimientos', 'romance', 'pareja', 'cariÃ±o', 'ternura'],
            belleza: ['hermosa', 'bella', 'linda', 'preciosa', 'guapa', 'sexy', 'atractiva'],
            deseo: ['quiero', 'deseo', 'me gusta', 'necesito', 'anhelo', 'sueÃ±o'],
            
            // Temas sensuales
            pasion: ['pasiÃ³n', 'fuego', 'intenso', 'ardiente', 'caliente', 'excitante'],
            seduccion: ['seducir', 'provocar', 'tentaciÃ³n', 'sensual', 'Ã­ntimo', 'privado'],
            
            // Temas emocionales
            felicidad: ['feliz', 'alegre', 'contento', 'sonrisa', 'risa', 'diversiÃ³n', 'genial'],
            tristeza: ['triste', 'mal', 'deprimido', 'llorar', 'dolor', 'pena'],
            nervios: ['nervioso', 'ansioso', 'preocupado', 'estrÃ©s', 'tenso'],
            
            // Temas de tiempo
            dia: ['dÃ­a', 'maÃ±ana', 'tarde', 'hoy', 'ahora', 'momento'],
            noche: ['noche', 'oscuridad', 'luna', 'estrellas', 'sueÃ±os'],
            
            // Temas de actividades
            trabajo: ['trabajo', 'oficina', 'jefe', 'reuniÃ³n', 'proyecto', 'carrera'],
            diversion: ['diversiÃ³n', 'juego', 'fiesta', 'mÃºsica', 'baile', 'risa'],
            ejercicio: ['ejercicio', 'gym', 'deporte', 'correr', 'fitness', 'mÃºsculo'],
            
            // Temas Ã­ntimos
            cuerpo: ['cuerpo', 'piel', 'labios', 'ojos', 'sonrisa', 'cabello'],
            ropa: ['vestido', 'ropa', 'sexy', 'elegante', 'outfit', 'estilo']
        };

        function generateAdvancedCustom() {
            const keyword = document.getElementById('customKeyword').value.trim();
            const style = document.getElementById('responseStyle').value;
            const intensity = parseInt(document.getElementById('intensityLevel').value);
            
            if (!keyword) {
                alert('Por favor ingresa una palabra clave');
                return;
            }

            // Detectar el tema basado en la palabra clave
            const detectedTheme = detectTheme(keyword.toLowerCase());
            
            // Generar respuesta inteligente basada en tema + estilo + intensidad
            let response = generateIntelligentResponse(keyword, detectedTheme, style, intensity);
            
            customResponse = response;
            displayResponseWithRating('customResponse', response, 'custom');
        }

        function detectTheme(keyword) {
            for (const [theme, words] of Object.entries(themeDatabase)) {
                if (words.some(word => keyword.includes(word) || word.includes(keyword))) {
                    return theme;
                }
            }
            return 'general';
        }

        function generateIntelligentResponse(keyword, theme, style, intensity) {
            const responsePatterns = {
                flirty: {
                    amor: [
                        "El amor... quÃ© tema tan profundo para una conversaciÃ³n ğŸ˜",
                        "Hablar de amor contigo se siente muy especial",
                        "Me gusta cuando tocas temas del corazÃ³n"
                    ],
                    belleza: [
                        "La belleza es algo que definitivamente sabes apreciar ğŸ˜‰",
                        "Me gusta que valores las cosas hermosas de la vida",
                        "Tienes muy buen ojo para la belleza"
                    ],
                    deseo: [
                        "Los deseos pueden ser muy poderosos... ğŸ˜",
                        "Me intriga saber quÃ© es lo que realmente quieres",
                        "Tus deseos despiertan mi curiosidad"
                    ],
                    pasion: [
                        "La pasiÃ³n es algo que me gusta mucho en una persona ğŸ”¥",
                        "Me encanta cuando alguien es apasionado",
                        "Tu lado apasionado me resulta muy atractivo"
                    ],
                    felicidad: [
                        "Tu alegrÃ­a es tan contagiosa, me encanta ğŸ˜Š",
                        "Me gusta verte tan feliz, es hermoso",
                        "Tu sonrisa ilumina hasta aquÃ­"
                    ],
                    general: [
                        "Me gusta cÃ³mo piensas sobre estos temas ğŸ˜‰",
                        "Tienes una perspectiva muy interesante",
                        "Me fascina tu forma de ver las cosas"
                    ]
                },
                sweet: {
                    amor: [
                        "El amor es lo mÃ¡s hermoso del mundo ğŸ’•",
                        "QuÃ© lindo es hablar de amor contigo",
                        "Tu forma de expresar el amor me derrite"
                    ],
                    belleza: [
                        "La verdadera belleza viene del corazÃ³n, como la tuya",
                        "Eres tan dulce cuando hablas de belleza",
                        "Tu sensibilidad hacia lo bello me encanta"
                    ],
                    felicidad: [
                        "Tu felicidad me hace sonreÃ­r tambiÃ©n ğŸ’•",
                        "Me encanta verte tan radiante",
                        "Tu alegrÃ­a es como un rayo de sol"
                    ],
                    general: [
                        "Eres tan tierno cuando hablas de eso ğŸ’•",
                        "Me derrites con tu dulzura",
                        "Tu sensibilidad me enamora"
                    ]
                },
                seductive: {
                    pasion: [
                        "La pasiÃ³n es algo que conozco muy bien... ğŸ”¥",
                        "Me gusta cuando sacas tu lado mÃ¡s intenso",
                        "Tu pasiÃ³n despierta cosas en mÃ­"
                    ],
                    deseo: [
                        "Los deseos estÃ¡n para cumplirse... ğŸ˜ˆ",
                        "Me intriga saber quÃ© mÃ¡s deseas",
                        "Tus deseos me ponen a pensar cosas traviesas"
                    ],
                    seduccion: [
                        "La seducciÃ³n es un arte que domino bien ğŸ˜",
                        "Me gusta tu lado seductor",
                        "Sabes cÃ³mo despertar mi lado mÃ¡s salvaje"
                    ],
                    noche: [
                        "Las noches son perfectas para cosas especiales ğŸŒ™",
                        "La oscuridad despierta mis instintos mÃ¡s profundos",
                        "Las noches contigo serÃ­an increÃ­bles"
                    ],
                    general: [
                        "Sabes cÃ³mo encenderme con esas palabras ğŸ”¥",
                        "Me gusta tu lado mÃ¡s atrevido",
                        "Despiertas mi lado mÃ¡s salvaje"
                    ]
                },
                mysterious: {
                    amor: [
                        "El amor... un misterio que vale la pena explorar",
                        "Hay secretos del corazÃ³n que pocos entienden",
                        "El amor verdadero es mÃ¡s profundo de lo que parece"
                    ],
                    noche: [
                        "La noche guarda secretos fascinantes",
                        "Hay algo mÃ¡gico en la oscuridad",
                        "Las noches revelan nuestra verdadera naturaleza"
                    ],
                    general: [
                        "Hay mÃ¡s detrÃ¡s de esas palabras de lo que muestras",
                        "Me intriga la profundidad de tu mente",
                        "Guardas secretos interesantes"
                    ]
                },
                funny: {
                    trabajo: [
                        "Â¡El trabajo! La eterna lucha de la humanidad ğŸ˜‚",
                        "Â¿Trabajo? Prefiero pensar en diversiÃ³n",
                        "El trabajo estÃ¡ sobrevalorado, mejor hablemos de nosotros"
                    ],
                    ejercicio: [
                        "Â¿Ejercicio? El Ãºnico que hago es correr hacia la heladera ğŸ˜‚",
                        "Mi ejercicio favorito es hacer reÃ­r a gente como tÃº",
                        "Â¿Gimnasio? Prefiero ejercitar mi sentido del humor"
                    ],
                    general: [
                        "Â¡Jajaja! Siempre sabes cÃ³mo hacerme reÃ­r ğŸ˜‚",
                        "Tu sentido del humor es lo mejor",
                        "Me encanta cuando eres asÃ­ de divertido"
                    ]
                },
                friendly: {
                    trabajo: [
                        "Â¡El trabajo puede ser genial cuando te gusta lo que haces!",
                        "Espero que tu trabajo te haga feliz",
                        "Es importante encontrar equilibrio entre trabajo y diversiÃ³n"
                    ],
                    diversion: [
                        "Â¡Me encanta la diversiÃ³n! La vida es para disfrutarla",
                        "Siempre es bueno tener tiempo para pasarla bien",
                        "La diversiÃ³n sana es sÃºper importante"
                    ],
                    general: [
                        "Me gusta mucho tu perspectiva sobre esto",
                        "Siempre es interesante hablar contigo",
                        "Tienes ideas muy buenas"
                    ]
                }
            };

            // Seleccionar patrÃ³n de respuesta
            const styleResponses = responsePatterns[style] || responsePatterns['friendly'];
            const themeResponses = styleResponses[theme] || styleResponses['general'];
            
            let baseResponse = themeResponses[Math.floor(Math.random() * themeResponses.length)];
            
            // Ajustar intensidad
            const intensityModifiers = {
                1: { emojis: ['ğŸ˜Š', 'ğŸ™‚'], additions: [''] },
                2: { emojis: ['ğŸ˜Š', 'ğŸ˜‰'], additions: [' Me gusta eso'] },
                3: { emojis: ['ğŸ˜‰', 'ğŸ˜', 'ğŸ’•'], additions: [' Me fascinas', ' Eres genial'] },
                4: { emojis: ['ğŸ˜', 'ğŸ”¥', 'ğŸ˜˜'], additions: [' Me tienes cautivada', ' Eres irresistible'] },
                5: { emojis: ['ğŸ”¥', 'ğŸ’‹', 'ğŸ¥µ', 'ğŸ˜ˆ'], additions: [' Me vuelves loca', ' Eres peligrosamente atractivo'] }
            };
            
            const modifier = intensityModifiers[intensity];
            const emoji = modifier.emojis[Math.floor(Math.random() * modifier.emojis.length)];
            const addition = modifier.additions[Math.floor(Math.random() * modifier.additions.length)];
            
            // Combinar respuesta final
            let finalResponse = baseResponse + addition;
            if (emoji && !finalResponse.includes(emoji)) {
                finalResponse += ' ' + emoji;
            }
            
            return finalResponse;
        }

        function generateContextualResponse() {
            const userMessage = document.getElementById('userMessage').value.trim();
            const responseType = document.getElementById('responseType').value;
            
            if (!userMessage) {
                alert('Por favor pega el mensaje del usuario');
                return;
            }

            // Analizar el mensaje del usuario de forma mÃ¡s inteligente
            const analysis = analyzeUserMessageAdvanced(userMessage);
            let response = '';

            if (responseType === 'auto') {
                response = generateSmartContextualResponse(userMessage, analysis);
            } else {
                response = generateSpecificResponse(responseType, userMessage, analysis);
            }

            contextualResponse = response;
            displayResponseWithRating('contextualResponse', response, 'contextual');
        }

        function analyzeUserMessageAdvanced(message) {
            const lowerMessage = message.toLowerCase();
            
            // AnÃ¡lisis de sentimientos
            let sentiment = 'neutral';
            let emotionalIntensity = 1;
            
            if (lowerMessage.match(/(increÃ­ble|fantÃ¡stico|genial|perfecto|hermoso|amo|adoro)/)) {
                sentiment = 'very_positive';
                emotionalIntensity = 5;
            } else if (lowerMessage.match(/(bueno|bien|me gusta|contento|feliz)/)) {
                sentiment = 'positive';
                emotionalIntensity = 3;
            } else if (lowerMessage.match(/(terrible|horrible|odio|mal|triste|deprimido)/)) {
                sentiment = 'negative';
                emotionalIntensity = 4;
            } else if (lowerMessage.match(/(nervioso|preocupado|ansioso|estresado)/)) {
                sentiment = 'anxious';
                emotionalIntensity = 3;
            }

            // Detectar intenciÃ³n
            let intent = 'chat';
            if (lowerMessage.includes('?')) intent = 'question';
            if (lowerMessage.match(/(quiero|necesito|puedes|podrÃ­as|me ayudas)/)) intent = 'request';
            if (lowerMessage.match(/(gracias|thank|agradezco)/)) intent = 'gratitude';
            if (lowerMessage.match(/(hola|hi|hey|buenas|saludos)/)) intent = 'greeting';
            if (lowerMessage.match(/(hermosa|bella|sexy|linda|preciosa|guapa)/)) intent = 'compliment';
            if (lowerMessage.match(/(ja|jaja|jeje|lol|ğŸ˜‚|ğŸ¤£|gracioso|divertido)/)) intent = 'humor';
            if (lowerMessage.match(/(amor|te amo|te quiero|besos|ğŸ˜˜|ğŸ’•|â¤ï¸)/)) intent = 'romantic';

            // Detectar temas
            const themes = [];
            for (const [theme, keywords] of Object.entries(themeDatabase)) {
                if (keywords.some(keyword => lowerMessage.includes(keyword))) {
                    themes.push(theme);
                }
            }

            // Detectar nivel de formalidad
            const formality = lowerMessage.match(/(por favor|disculpe|seÃ±orita|usted)/) ? 'formal' : 'informal';

            // Guardar patrones para aprendizaje
            analyzeUserMessage(message);

            return {
                sentiment,
                emotionalIntensity,
                intent,
                themes,
                formality,
                length: message.split(' ').length,
                hasEmojis: /[\u{1F600}-\u{1F64F}]|[\u{1F300}-\u{1F5FF}]|[\u{1F680}-\u{1F6FF}]|[\u{1F1E0}-\u{1F1FF}]|[\u{2600}-\u{26FF}]|[\u{2700}-\u{27BF}]/u.test(message)
            };
        }

        function generateSmartContextualResponse(message, analysis) {
            // Respuestas inteligentes basadas en anÃ¡lisis completo
            
            if (analysis.intent === 'greeting') {
                return generateGreetingResponse(analysis);
            } else if (analysis.intent === 'compliment') {
                return generateComplimentResponse(analysis);
            } else if (analysis.intent === 'question') {
                return generateQuestionResponse(analysis);
            } else if (analysis.intent === 'request') {
                return generateRequestResponse(analysis);
            } else if (analysis.intent === 'humor') {
                return generateJokeResponse(analysis);
            } else if (analysis.intent === 'romantic') {
                return generateRomanticResponse(analysis);
            } else if (analysis.intent === 'gratitude') {
                return generateThanksResponse(analysis);
            } else if (analysis.sentiment === 'negative') {
                return generateComfortResponse(analysis);
            } else {
                return generateGenericResponse(analysis);
            }
        }

        function generateSpecificResponse(type, message, analysis) {
            switch(type) {
                case 'compliment': return generateComplimentResponse(analysis);
                case 'question': return generateQuestionResponse(analysis);
                case 'request': return generateRequestResponse(analysis);
                case 'joke': return generateJokeResponse(analysis);
                case 'flirt': return generateFlirtResponse(analysis);
                case 'thanks': return generateThanksResponse(analysis);
                default: return generateGenericResponse(analysis);
            }
        }

        function generateGreetingResponse(analysis) {
            const responses = {
                formal: [
                    "Â¡Hola! Es un placer hablar contigo ğŸ˜Š",
                    "Â¡Buenas! QuÃ© gusto verte por aquÃ­",
                    "Â¡Hola! Siempre es agradable una buena conversaciÃ³n"
                ],
                informal: [
                    "Â¡Hey! QuÃ© alegrÃ­a verte ğŸ˜Š",
                    "Â¡Hola! Me alegras el dÃ­a con tu saludo",
                    "Â¡Hola hermoso! Â¿CÃ³mo estÃ¡s?",
                    "Â¡Buenas! Justo estaba pensando en ti ğŸ˜‰"
                ]
            };

            const responseSet = responses[(analysis && analysis.formality) || 'informal'];
            let response = responseSet[Math.floor(Math.random() * responseSet.length)];

            if (analysis && analysis.hasEmojis) {
                response += " Me encantan tus emojis";
            }

            return response;
        }
        function generateComplimentResponse(analysis) {
            const baseResponses = [
                "Aww, me haces sonrojar ğŸ˜Š",
                "QuÃ© lindo eres, me alegras el dÃ­a",
                "Eres un encanto, me haces sentir especial",
                "Me derrites el corazÃ³n cuando me dices esas cosas",
                "Tu dulzura es una de mis cosas favoritas de ti"
            ];

            let response = baseResponses[Math.floor(Math.random() * baseResponses.length)];

            if (analysis && analysis.emotionalIntensity >= 4) {
                response += " TÃº tambiÃ©n eres absolutamente increÃ­ble";
            } else {
                response += " TÃº tambiÃ©n eres muy dulce";
            }

            return response;
        }

        function generateQuestionResponse(analysis) {
            const responses = [
                "QuÃ© pregunta tan interesante... me gusta cÃ³mo piensas",
                "Mmm, me haces reflexionar. Â¿TÃº quÃ© opinas?",
                "Esa es una pregunta profunda, me intriga tu mente",
                "Me encanta cuando eres curioso, dime mÃ¡s",
                "Buena pregunta, me gusta conversar contigo"
            ];

            let response = responses[Math.floor(Math.random() * responses.length)];

            if (analysis && analysis.themes.includes('amor')) {
                response += " Especialmente cuando hablamos de temas del corazÃ³n";
            } else if (analysis && analysis.themes.includes('felicidad')) {
                response += " Me gusta tu perspectiva positiva";
            }

            return response;
        }

        function generateRequestResponse(analysis) {
            const responses = [
                "Me gusta cuando eres directo, veamos quÃ© puedo hacer ğŸ˜‰",
                "Hmm, esa es una propuesta interesante...",
                "Me encanta tu iniciativa, eres muy decidido",
                "Vaya, vaya... alguien sabe lo que quiere",
                "Me gusta que seas claro con lo que deseas"
            ];

            let response = responses[Math.floor(Math.random() * responses.length)];

            if (analysis && analysis.formality === 'formal') {
                response = "Me gusta tu educaciÃ³n, veamos en quÃ© puedo ayudarte";
            }

            return response;
        }

        function generateJokeResponse(analysis) {
            const responses = [
                "Â¡Jajaja! Me encanta tu sentido del humor ğŸ˜‚",
                "Eres tan divertido, me haces reÃ­r muchÃ­simo",
                "Â¡QuÃ© ocurrente! Me caes muy bien",
                "Tienes un humor genial, me alegras el dÃ­a",
                "Me encanta reÃ­r contigo, eres fantÃ¡stico"
            ];

            let response = responses[Math.floor(Math.random() * responses.length)];

            if (analysis && analysis.hasEmojis) {
                response += " Tus emojis hacen todo mÃ¡s divertido";
            }

            return response;
        }

        function generateRomanticResponse(analysis) {
            const responses = [
                "Ay, me haces sentir cosas muy bonitas ğŸ’•",
                "Tu lado romÃ¡ntico me tiene cautivada",
                "Me derrites con esas palabras de amor",
                "Eres tan tierno, me enamoras cada dÃ­a mÃ¡s",
                "Tu amor se siente hasta aquÃ­, es hermoso"
            ];

            return responses[Math.floor(Math.random() * responses.length)];
        }

        function generateFlirtResponse(analysis) {
            const responses = [
                "Mmm, me gusta cÃ³mo suena eso ğŸ˜",
                "Eres muy travieso, me intrigas",
                "Sabes exactamente quÃ© decir para captar mi atenciÃ³n",
                "Me gusta tu estilo, eres muy seductor",
                "Tienes una forma muy atractiva de expresarte"
            ];

            let response = responses[Math.floor(Math.random() * responses.length)];

            if (analysis && analysis.emotionalIntensity >= 4) {
                response += " Me tienes completamente cautivada";
            }

            return response;
        }

        function generateThanksResponse(analysis) {
            const responses = [
                "De nada, amor. Me encanta hacerte feliz ğŸ’•",
                "Para ti, lo que sea. Eres muy especial",
                "No hay de quÃ©, cariÃ±o. Es un placer",
                "Siempre estarÃ© aquÃ­ para ti, lo sabes",
                "Me alegra poder ayudarte, eres increÃ­ble"
            ];

            return responses[Math.floor(Math.random() * responses.length)];
        }

        function generateComfortResponse(analysis) {
            const responses = [
                "Aww, siento que no te sientas bien. Estoy aquÃ­ para ti ğŸ’•",
                "Â¿QuÃ© pasÃ³, cariÃ±o? CuÃ©ntame, quiero ayudarte",
                "No me gusta verte asÃ­. Â¿En quÃ© puedo ayudar?",
                "Ven acÃ¡, dame un abrazo virtual ğŸ¤— Todo va a estar bien",
                "Estoy aquÃ­ contigo, no estÃ¡s solo"
            ];

            return responses[Math.floor(Math.random() * responses.length)];
        }

        function generateGenericResponse(analysis) {
            const responses = [
                "Me gusta mucho hablar contigo, tienes algo especial",
                "Eres muy interesante, me encanta conocerte mejor",
                "Tienes una personalidad que me atrae mucho",
                "Me fascina tu forma de ser, eres Ãºnico",
                "Cada vez que hablas, me dan ganas de saber mÃ¡s de ti"
            ];

            let response = responses[Math.floor(Math.random() * responses.length)];

            // Personalizar segÃºn temas detectados
            if (analysis && analysis.themes.includes('pasion')) {
                response += " Especialmente tu lado apasionado";
            } else if (analysis && analysis.themes.includes('felicidad')) {
                response += " Tu energÃ­a positiva es contagiosa";
            }

            return response;
        }

        function analyzeUserMessage(message) {
            const words = message.toLowerCase().split(/\s+/);
            words.forEach(word => {
                const cleanWord = word.replace(/[^\w\sÃ¡Ã©Ã­Ã³ÃºÃ±Ã¼]/gi, '');
                if (cleanWord.length > 2) {
                    if (!userPatterns[cleanWord]) {
                        userPatterns[cleanWord] = 0;
                    }
                    userPatterns[cleanWord]++;
                }
            });
            saveData(); // Usar funciÃ³n segura
        }
                    userPatterns[cleanWord]++;
                }
            });
            localStorage.setItem('userPatterns', JSON.stringify(userPatterns));
        }

        function generateComplimentResponse() {
            const responses = [
                "Aww, me haces sonrojar ğŸ˜Š TÃº tambiÃ©n eres muy dulce",
                "QuÃ© lindo eres, me alegras el dÃ­a con esos comentarios ğŸ’•",
                "Eres un encanto, me haces sentir especial",
                "Me derrites el corazÃ³n cuando me dices esas cosas",
                "Tienes una forma muy tierna de hacerme sentir bien"
            ];
            return responses[Math.floor(Math.random() * responses.length)];
        }

        function generateQuestionResponse() {
            const responses = [
                "QuÃ© pregunta tan interesante... me gusta cÃ³mo piensas",
                "Mmm, me haces reflexionar. Â¿TÃº quÃ© opinas?",
                "Esa es una pregunta profunda, me intriga tu mente",
                "Me encanta cuando eres curioso, dime mÃ¡s",
                "Buena pregunta, me gusta conversar contigo"
            ];
            return responses[Math.floor(Math.random() * responses.length)];
        }

        function generateRequestResponse() {
            const responses = [
                "Me gusta cuando eres directo, veamos quÃ© puedo hacer ğŸ˜‰",
                "Hmm, esa es una propuesta interesante...",
                "Me encanta tu iniciativa, eres muy decidido",
                "Vaya, vaya... alguien sabe lo que quiere",
                "Me gusta que seas claro con lo que deseas"
            ];
            return responses[Math.floor(Math.random() * responses.length)];
        }

        function generateJokeResponse() {
            const responses = [
                "Â¡Jajaja! Me encanta tu sentido del humor ğŸ˜‚",
                "Eres tan divertido, me haces reÃ­r muchÃ­simo",
                "Â¡QuÃ© ocurrente! Me caes muy bien",
                "Tienes un humor genial, me alegras el dÃ­a",
                "Me encanta reÃ­r contigo, eres fantÃ¡stico"
            ];
            return responses[Math.floor(Math.random() * responses.length)];
        }

        function generateFlirtResponse() {
            const responses = [
                "Mmm, me gusta cÃ³mo suena eso ğŸ˜",
                "Eres muy travieso, me intrigas",
                "Sabes exactamente quÃ© decir para captar mi atenciÃ³n",
                "Me gusta tu estilo, eres muy seductor",
                "Tienes una forma muy atractiva de expresarte"
            ];
            return responses[Math.floor(Math.random() * responses.length)];
        }

        function generateThanksResponse() {
            const responses = [
                "De nada, amor. Me encanta hacerte feliz ğŸ’•",
                "Para ti, lo que sea. Eres muy especial",
                "No hay de quÃ©, cariÃ±o. Es un placer",
                "Siempre estarÃ© aquÃ­ para ti, lo sabes",
                "Me alegra poder ayudarte, eres increÃ­ble"
            ];
            return responses[Math.floor(Math.random() * responses.length)];
        }

        function generateGreetingResponse() {
            const responses = [
                "Â¡Hola! QuÃ© alegrÃ­a verte por aquÃ­ ğŸ˜Š",
                "Â¡Hey! Me alegras el dÃ­a con tu saludo",
                "Â¡Hola hermoso! Â¿CÃ³mo estÃ¡s hoy?",
                "Â¡Buenas! Justo estaba pensando en ti ğŸ˜‰",
                "Â¡Hola! Siempre es un placer hablar contigo"
            ];
            return responses[Math.floor(Math.random() * responses.length)];
        }

        function generateGenericResponse() {
            const responses = [
                "Me gusta mucho hablar contigo, tienes algo especial",
                "Eres muy interesante, me encanta conocerte mejor",
                "Tienes una personalidad que me atrae mucho",
                "Me fascina tu forma de ser, eres Ãºnico",
                "Cada vez que hablas, me dan ganas de saber mÃ¡s de ti"
            ];
            return responses[Math.floor(Math.random() * responses.length)];
        }

        function displayResponseWithRating(elementId, response, type) {
            const element = document.getElementById(elementId);
            element.innerHTML = `
                <div class="response-text">${response}</div>
                <div style="display: flex; gap: 10px; margin-top: 15px; align-items: center;">
                    <span style="font-size: 12px; opacity: 0.8;">Â¿Te gustÃ³ esta respuesta?</span>
                    <button onclick="rateResponse('${response.replace(/'/g, "\\'")}', '${type}', 'like')" 
                            style="background: #2ecc71; border: none; color: white; padding: 5px 10px; border-radius: 15px; cursor: pointer; font-size: 12px;">
                        ğŸ‘ Me gusta
                    </button>
                    <button onclick="rateResponse('${response.replace(/'/g, "\\'")}', '${type}', 'dislike')" 
                            style="background: #e74c3c; border: none; color: white; padding: 5px 10px; border-radius: 15px; cursor: pointer; font-size: 12px;">
                        ğŸ‘ No me gusta
                    </button>
                </div>
            `;
        }

        function rateResponse(response, type, rating) {
            const key = response.substring(0, 50);
            
            if (!responseRatings[key]) {
                responseRatings[key] = { likes: 0, dislikes: 0, type: type, fullText: response };
            }
            
            if (rating === 'like') {
                responseRatings[key].likes++;
                alert('Â¡Gracias! TomarÃ© en cuenta que te gustÃ³ esta respuesta ğŸ˜Š');
            } else {
                responseRatings[key].dislikes++;
                alert('Entendido, buscarÃ© respuestas mejores la prÃ³xima vez ğŸ¤”');
            }
            
            localStorage.setItem('responseRatings', JSON.stringify(responseRatings));
        }

        function translateResponse(elementId) {
            const element = document.getElementById(elementId);
            const responseDiv = element.querySelector('.response-text');
            
            if (!responseDiv) {
                alert('Primero genera una respuesta para traducir');
                return;
            }
            
            const text = responseDiv.textContent.trim();
            
            if (!text || text.includes('Haz clic') || text.includes('Configura') || text.includes('Pega el mensaje')) {
                alert('Primero genera una respuesta para traducir');
                return;
            }

            let translatedText = text;
            
            // Traducir frases completas primero
            const phraseTranslations = {
                'me gusta cÃ³mo': 'I like how',
                'me encanta cuando': 'I love when',
                'quÃ© lindo eres': 'how sweet you are',
                'eres muy': 'you are very',
                'me haces': 'you make me',
                'de nada': 'you\'re welcome',
                'por favor': 'please',
                'lo siento': 'I\'m sorry',
                'estÃ¡ bien': 'it\'s okay'
            };

            for (const [spanish, english] of Object.entries(phraseTranslations)) {
                const regex = new RegExp(spanish, 'gi');
                translatedText = translatedText.replace(regex, english);
            }
            
            // Traducir palabras individuales
            for (const [spanish, english] of Object.entries(translations)) {
                const regex = new RegExp(`\\b${spanish}\\b`, 'gi');
                translatedText = translatedText.replace(regex, english);
            }
            
            // Reglas gramaticales
            translatedText = translatedText
                .replace(/Â¿([^?]+)\?/g, '$1?')
                .replace(/Â¡([^!]+)!/g, '$1!')
                .replace(/\bI am\b/g, 'I\'m')
                .replace(/\byou are\b/g, 'you\'re')
                .replace(/\bit is\b/g, 'it\'s')
                .trim();

            translatedText = translatedText.charAt(0).toUpperCase() + translatedText.slice(1);
            
            if (!translatedText.match(/[.!?]$/)) {
                translatedText += translatedText.includes('?') ? '' : '.';
            }
            
            element.innerHTML = `
                <div style="margin-bottom: 15px;">
                    <div style="background: rgba(255,255,255,0.1); padding: 10px; border-radius: 8px; border-left: 3px solid #ff6b6b;">
                        <strong>ğŸ‡ªğŸ‡¸ EspaÃ±ol:</strong><br>
                        ${text}
                    </div>
                </div>
                <div style="background: rgba(46, 204, 113, 0.2); padding: 15px; border-radius: 8px; border-left: 3px solid #2ecc71;">
                    <strong>ğŸ‡ºğŸ‡¸ English:</strong><br>
                    <span style="font-size: 16px; font-weight: 500;">${translatedText}</span>
                </div>
                <div style="display: flex; gap: 10px; margin-top: 15px;">
                    <button onclick="restoreOriginal(this, '${text.replace(/'/g, "\\'")}', '${elementId}')" 
                            style="padding: 8px 15px; font-size: 12px; background: linear-gradient(45deg, #95a5a6, #7f8c8d); border: none; color: white; border-radius: 20px; cursor: pointer;">
                        ğŸ”„ Volver al original
                    </button>
                    <button onclick="copyToClipboard('${translatedText.replace(/'/g, "\\'")}', '${text.replace(/'/g, "\\'")}', '${elementId}')" 
                            style="padding: 8px 15px; font-size: 12px; background: linear-gradient(45deg, #3498db, #2980b9); border: none; color: white; border-radius: 20px; cursor: pointer;">
                        ğŸ“‹ Copiar traducciÃ³n
                    </button>
                </div>
            `;
        }

        function restoreOriginal(button, originalText, elementId) {
            const element = document.getElementById(elementId);
            element.innerHTML = `<div class="response-text">${originalText}</div>`;
        }

        function copyToClipboard(translatedText, originalText, elementId) {
            navigator.clipboard.writeText(translatedText).then(() => {
                alert('Â¡TraducciÃ³n copiada al portapapeles!');
                setTimeout(() => {
                    restoreOriginal(null, originalText, elementId);
                }, 2000);
            }).catch(() => {
                const textArea = document.createElement('textarea');
                textArea.value = translatedText;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                alert('Â¡TraducciÃ³n copiada al portapapeles!');
                setTimeout(() => {
                    restoreOriginal(null, originalText, elementId);
                }, 2000);
            });
        }

        function saveToFavorites() {
            if (!currentResponse || currentResponse.trim() === '') {
                alert('Primero genera una respuesta para guardar');
                return;
            }
            
            if (favorites.includes(currentResponse)) {
                alert('Esta respuesta ya estÃ¡ en tus favoritos');
                return;
            }

            favorites.push(currentResponse);
            localStorage.setItem('favorites', JSON.stringify(favorites));
            updateFavoritesList();
            alert('Â¡Respuesta guardada en favoritos!');
        }

        function saveCustomToFavorites() {
            if (!customResponse || customResponse.trim() === '') {
                alert('Primero genera una respuesta personalizada');
                return;
            }
            
            if (favorites.includes(customResponse)) {
                alert('Esta respuesta ya estÃ¡ en favoritos');
                return;
            }

            favorites.push(customResponse);
            localStorage.setItem('favorites', JSON.stringify(favorites));
            updateFavoritesList();
            alert('Â¡Respuesta guardada!');
        }

        function saveContextualToFavorites() {
            if (!contextualResponse || contextualResponse.trim() === '') {
                alert('Primero genera una respuesta contextual');
                return;
            }
            
            if (favorites.includes(contextualResponse)) {
                alert('Esta respuesta ya estÃ¡ en favoritos');
                return;
            }

            favorites.push(contextualResponse);
            localStorage.setItem('favorites', JSON.stringify(favorites));
            updateFavoritesList();
            alert('Â¡Respuesta guardada!');
        }

        function deleteFavorite(index) {
            if (index >= 0 && index < favorites.length) {
                favorites.splice(index, 1);
                localStorage.setItem('favorites', JSON.stringify(favorites));
                updateFavoritesList();
            }
        }

        function showFavorites() {
            const favoritesList = document.getElementById('favoritesList');
            
            if (favorites.length === 0) {
                favoritesList.innerHTML = '<p style="text-align: center; opacity: 0.6;">No tienes respuestas favoritas aÃºn</p>';
            } else {
                favoritesList.innerHTML = favorites.map((fav, index) => `
                    <div class="favorite-item">
                        <button class="delete-btn" onclick="deleteFavorite(${index})">Ã—</button>
                        ${fav}
                    </div>
                `).join('');
            }
        }

        function showStats() {
            const favoritesList = document.getElementById('favoritesList');
            
            const totalRatings = Object.keys(responseRatings).length;
            const totalLikes = Object.values(responseRatings).reduce((sum, rating) => sum + rating.likes, 0);
            const totalDislikes = Object.values(responseRatings).reduce((sum, rating) => sum + rating.dislikes, 0);
            const totalPatterns = Object.keys(userPatterns).length;
            
            const sortedPatterns = Object.entries(userPatterns)
                .sort(([,a], [,b]) => b - a)
                .slice(0, 10);
            
            const bestResponses = Object.values(responseRatings)
                .filter(rating => rating.likes > rating.dislikes)
                .sort((a, b) => (b.likes - b.dislikes) - (a.likes - a.dislikes))
                .slice(0, 5);

            favoritesList.innerHTML = `
                <div style="background: rgba(155, 89, 182, 0.2); padding: 20px; border-radius: 10px; border-left: 4px solid #9b59b6;">
                    <h3 style="margin-bottom: 15px;">ğŸ“Š EstadÃ­sticas de Aprendizaje</h3>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 20px;">
                        <div style="background: rgba(46, 204, 113, 0.3); padding: 15px; border-radius: 8px; text-align: center;">
                            <div style="font-size: 24px; font-weight: bold;">${totalLikes}</div>
                            <div style="font-size: 12px;">ğŸ‘ Respuestas que gustaron</div>
                        </div>
                        <div style="background: rgba(231, 76, 60, 0.3); padding: 15px; border-radius: 8px; text-align: center;">
                            <div style="font-size: 24px; font-weight: bold;">${totalDislikes}</div>
                            <div style="font-size: 12px;">ğŸ‘ Respuestas a mejorar</div>
                        </div>
                        <div style="background: rgba(52, 152, 219, 0.3); padding: 15px; border-radius: 8px; text-align: center;">
                            <div style="font-size: 24px; font-weight: bold;">${totalPatterns}</div>
                            <div style="font-size: 12px;">ğŸ”¤ Palabras aprendidas</div>
                        </div>
                        <div style="background: rgba(241, 196, 15, 0.3); padding: 15px; border-radius: 8px; text-align: center;">
                            <div style="font-size: 24px; font-weight: bold;">${Math.round((totalLikes / (totalLikes + totalDislikes || 1)) * 100)}%</div>
                            <div style="font-size: 12px;">ğŸ“ˆ Tasa de Ã©xito</div>
                        </div>
                    </div>
                    
                    <div style="margin-bottom: 20px;">
                        <h4>ğŸ”¥ Palabras mÃ¡s usadas por usuarios:</h4>
                        <div style="display: flex; flex-wrap: wrap; gap: 8px; margin-top: 10px;">
                            ${sortedPatterns.map(([word, count]) => 
                                `<span style="background: rgba(255,255,255,0.2); padding: 5px 10px; border-radius: 15px; font-size: 12px;">
                                    ${word} (${count})
                                </span>`
                            ).join('')}
                        </div>
                    </div>
                    
                    ${bestResponses.length > 0 ? `
                        <div>
                            <h4>â­ Mejores respuestas (mÃ¡s likes):</h4>
                            ${bestResponses.map(response => 
                                `<div style="background: rgba(0,0,0,0.2); padding: 10px; margin: 8px 0; border-radius: 6px; font-size: 14px;">
                                    "${response.fullText.substring(0, 80)}..." 
                                    <span style="color: #2ecc71;">ğŸ‘ ${response.likes}</span>
                                </div>`
                            ).join('')}
                        </div>
                    ` : ''}
                </div>
            `;
        }

        function exportData() {
            const data = {
                favorites: favorites,
                ratings: responseRatings,
                patterns: userPatterns,
                exportDate: new Date().toISOString()
            };
            
            const jsonData = JSON.stringify(data, null, 2);
            const blob = new Blob([jsonData], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = 'respuestas_datos.json';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            alert('ğŸ“ Datos exportados exitosamente');
        }

        function updateFavoritesList() {
            showFavorites();
            const favCount = document.getElementById('favCount');
            favCount.textContent = favorites.length;
        }

        function initializeEventListeners() {
            const intensitySlider = document.getElementById('intensityLevel');
            if (intensitySlider) {
                intensitySlider.addEventListener('input', function() {
                    const intensityValue = document.getElementById('intensityValue');
                    if (intensityValue) {
                        intensityValue.textContent = this.value;
                    }
                });
            }

            const customKeyword = document.getElementById('customKeyword');
            if (customKeyword) {
                customKeyword.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        generateAdvancedCustom();
                    }
                });
            }

            const userMessage = document.getElementById('userMessage');
            if (userMessage) {
                userMessage.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter' && e.ctrlKey) {
                        generateContextualResponse();
                    }
                });
            }
        }

        function initializeApp() {
            loadData();
            updateFavoritesList();
            initializeEventListeners();
        }

        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initializeApp);
        } else {
            setTimeout(initializeApp, 100);
        }
    </script>
</body>
</html>