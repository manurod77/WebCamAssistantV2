    <script>
        // Variables globales
        let favorites = [];
        let currentResponse = '';
        let customResponse = '';
        let contextualResponse = '';
        let responseRatings = {};
        let userPatterns = {};
        let userBehaviorTracker = {
            warningsCount: 0,
            lastWarningTime: null,
            inappropriateMessages: 0,
            consecutiveWarnings: 0
        };
        let isExtremeMode = false;

        // Funciones básicas de datos
        function saveData() {
            console.log('Datos guardados en memoria de sesión');
        }

        function loadData() {
            favorites = [];
            responseRatings = {};
            userPatterns = {};
        }

        // Base de datos de respuestas
        const responses = {
            coquetas: [
                "¿Sabes qué? Creo que acabas de alegrarme el día con ese comentario 😊",
                "Mmm, me gusta cómo piensas... cuéntame más",
                "Tienes buen gusto, debo admitirlo 😉",
                "Eres todo un encanto, ¿lo sabías?",
                "Me haces sonreír sin poder evitarlo",
                "Vaya, vaya... alguien sabe cómo conquistar con palabras"
            ],
            divertidas: [
                "¡Ja! Definitivamente tienes sentido del humor, me caes bien",
                "¿En serio acabas de decir eso? Me has hecho reír en voz alta",
                "Eres más divertido de lo que esperaba... me gusta",
                "Ok, esa fue buena, te doy puntos por creatividad",
                "¿De dónde sacas estas ocurrencias? Me encanta tu mente"
            ],
            misteriosas: [
                "Hay algo en ti que me intriga... no logro descifrarte",
                "Mmm, interesante perspectiva... me haces pensar",
                "Tienes una forma muy particular de ver las cosas",
                "Hay más de lo que muestras, ¿verdad?",
                "Me pregunto qué otras sorpresas guardas"
            ],
            halagadoras: [
                "Wow, qué detallista eres... se nota que tienes clase",
                "Me encanta cómo me haces sentir especial",
                "Tienes un don para hacer que una chica se sienta única",
                "Eres increíblemente dulce, ¿sabes eso?",
                "Me fascina tu forma de expresarte"
            ],
            juguetonas: [
                "¿A que no te atreves a decir eso otra vez? 😏",
                "Uy, alguien está siendo travieso hoy...",
                "Me gusta este juego, pero yo también sé jugar",
                "¿Eso es todo lo que tienes? Esperaba más de ti",
                "Creo que subestimas mi lado juguetón"
            ],
            seductoras: [
                "Sabes exactamente qué decir para captar mi atención",
                "Me gusta cómo me miras... a través de la pantalla",
                "Tienes algo especial que me atrae",
                "Eres peligrosamente encantador",
                "Me haces sentir cosas que no esperaba"
            ],
            dulces: [
                "Eres tan tierno, me derrites el corazón 💕",
                "Tu dulzura me hace sonreír como tonta",
                "Me encantas cuando eres así de adorable",
                "Tienes el corazón más bonito que he conocido"
            ],
            atrevidas: [
                "Mmm, me gusta tu lado atrevido 🔥",
                "¿Así que quieres jugar con fuego?",
                "Me encanta cuando sacas tu lado salvaje",
                "Tienes ideas muy interesantes... me intrigas"
            ],
            romanticas: [
                "Eres como un sueño hecho realidad",
                "Me haces creer en los cuentos de hadas",
                "Tienes algo mágico que me enamora",
                "Contigo el mundo se ve más bonito"
            ]
        };

        // Respuestas extremas atrevidas
        const extremeHotResponses = {
            seductive: [
                "Mmm, me encanta cuando eres así de directo... me prendes 🔥",
                "Ay, me haces sentir cosas muy traviesas cuando hablas así 😈",
                "Me tienes completamente mojada con esa actitud tuya 💦",
                "Eres tan malo que me dan ganas de hacer cosas muy sucias contigo 🔥",
                "Me provocas tanto que no puedo evitar tocarme pensando en ti 😏"
            ],
            provocative: [
                "¿Te gusta lo que ves? Porque a mí me gusta mucho provocarte 😈",
                "Estoy pensando en ti de maneras muy, muy traviesas ahora mismo 💋",
                "Me tienes tan caliente que necesito refrescarme... o mejor aún, calentarme más contigo 🔥",
                "Eres tan irresistible que me dan ganas de hacer travesuras juntos 😏"
            ],
            dominant: [
                "Me gusta cuando intentas ser dominante... pero yo también sé cómo tomar el control 😈",
                "¿Crees que puedes manejarme? Te aseguro que soy más traviesa de lo que imaginas 🔥",
                "Me excita tu actitud, pero espera a ver lo que puedo hacer yo contigo 💋",
                "¿Quieres jugar rudo? Perfecto, porque a mí me gusta cuando es intenso 😏"
            ],
            naughty: [
                "Uy, qué travieso eres... me das ideas muy sucias 😈",
                "Me haces pensar en cosas que no debería, pero que quiero hacer contigo 🔥",
                "Eres tan malo que me sacas mi lado más pervertido 💋",
                "Me encanta cuando eres así de cochino, me prendes toda 💦"
            ]
        };

        // Sistema de moderación
        const moderationSystem = {
            inappropriate: {
                mild: ['tonto', 'idiota', 'estúpido', 'imbécil'],
                moderate: ['puta', 'zorra', 'perra', 'cabrón'],
                severe: ['matar', 'morir', 'suicidio', 'muerte'],
                harassment: ['acoso', 'perseguir', 'stalkear', 'obsesión'],
                explicit: ['follar', 'coger', 'penetrar', 'masturbación']
            },
            responses: {
                mild: [
                    "Prefiero mantener nuestra conversación en un tono más amable y respetuoso 😊",
                    "Me gusta más cuando usamos palabras bonitas para comunicarnos"
                ],
                moderate: [
                    "Aprecio mucho el respeto mutuo en nuestras conversaciones",
                    "Me siento más cómoda cuando hablamos con educación"
                ],
                severe: [
                    "No me siento cómoda con este tipo de comentarios. Te agradecería que cambiáramos de tema",
                    "Creo que sería mejor si dirigimos nuestra conversación hacia algo más positivo"
                ],
                harassment: [
                    "Me parece importante establecer límites saludables en nuestra interacción",
                    "Prefiero mantener una distancia apropiada y respetuosa"
                ],
                explicit: [
                    "Mantengo conversaciones más elegantes y sofisticadas",
                    "Prefiero conversaciones que tengan más clase y sustancia"
                ]
            }
        };

        // Diccionario completo de traducciones
        const translations = {
            // Saludos y expresiones básicas
            'hola': 'hello', 'hi': 'hi', 'hey': 'hey', 'buenas': 'good', 'buenos días': 'good morning',
            'buenas noches': 'good night', 'buenas tardes': 'good afternoon',
            
            // Términos cariñosos
            'amor': 'love', 'cariño': 'honey', 'corazón': 'heart', 'bebé': 'baby', 'cielo': 'sky',
            'mi vida': 'my life', 'princesa': 'princess', 'reina': 'queen', 'tesoro': 'treasure',
            
            // Adjetivos positivos
            'hermosa': 'beautiful', 'bella': 'gorgeous', 'linda': 'pretty', 'sexy': 'sexy',
            'guapa': 'beautiful', 'preciosa': 'precious', 'bonita': 'cute', 'divina': 'divine',
            'perfecta': 'perfect', 'increíble': 'incredible', 'fantástica': 'fantastic',
            'espectacular': 'spectacular', 'maravillosa': 'wonderful', 'genial': 'amazing',
            
            // Emociones y sentimientos
            'me gusta': 'I like', 'me encanta': 'I love', 'me fascina': 'I\'m fascinated',
            'adoro': 'I adore', 'amo': 'I love', 'quiero': 'I want', 'deseo': 'I desire',
            'feliz': 'happy', 'contenta': 'happy', 'triste': 'sad', 'emocionada': 'excited',
            'nerviosa': 'nervous', 'tranquila': 'calm', 'relajada': 'relaxed',
            
            // Acciones y verbos
            'beso': 'kiss', 'besos': 'kisses', 'abrazo': 'hug', 'abrazos': 'hugs',
            'sonreír': 'smile', 'reír': 'laugh', 'llorar': 'cry', 'pensar': 'think',
            'sentir': 'feel', 'ver': 'see', 'mirar': 'look', 'escuchar': 'listen',
            'hablar': 'talk', 'decir': 'say', 'hacer': 'do', 'venir': 'come',
            
            // Tiempo
            'hoy': 'today', 'mañana': 'tomorrow', 'ayer': 'yesterday', 'ahora': 'now',
            'luego': 'later', 'después': 'after', 'antes': 'before', 'siempre': 'always',
            'nunca': 'never', 'a veces': 'sometimes', 'tarde': 'late', 'temprano': 'early',
            
            // Conectores
            'pero': 'but', 'y': 'and', 'o': 'or', 'porque': 'because', 'aunque': 'although',
            'sin embargo': 'however', 'además': 'besides', 'también': 'also', 'tampoco': 'neither',
            
            // Palabras básicas
            'sí': 'yes', 'no': 'no', 'tal vez': 'maybe', 'quizás': 'perhaps', 'claro': 'of course',
            'por supuesto': 'of course', 'exacto': 'exactly', 'verdad': 'true', 'mentira': 'lie',
            
            // Preposiciones y artículos
            'de': 'of', 'en': 'in', 'con': 'with', 'sin': 'without', 'para': 'for', 'por': 'by',
            'la': 'the', 'el': 'the', 'un': 'a', 'una': 'a', 'este': 'this', 'esta': 'this',
            
            // Pronombres
            'yo': 'I', 'tú': 'you', 'él': 'he', 'ella': 'she', 'nosotros': 'we', 'ustedes': 'you',
            'me': 'me', 'te': 'you', 'le': 'him/her', 'nos': 'us', 'les': 'them',
            
            // Verbos comunes
            'soy': 'I am', 'eres': 'you are', 'es': 'is', 'somos': 'we are', 'son': 'they are',
            'tengo': 'I have', 'tienes': 'you have', 'tiene': 'has', 'tenemos': 'we have',
            'voy': 'I go', 'vas': 'you go', 'va': 'goes', 'vamos': 'we go', 'van': 'they go',
            'puedo': 'I can', 'puedes': 'you can', 'puede': 'can', 'podemos': 'we can',
            'estoy': 'I am', 'estás': 'you are', 'está': 'is', 'estamos': 'we are',
            
            // Adjetivos y adverbios
            'muy': 'very', 'más': 'more', 'menos': 'less', 'mejor': 'better', 'peor': 'worse',
            'grande': 'big', 'pequeña': 'small', 'alto': 'tall', 'bajo': 'short',
            'bueno': 'good', 'malo': 'bad', 'nuevo': 'new', 'viejo': 'old',
            
            // Interrogativos
            'qué': 'what', 'quién': 'who', 'cuándo': 'when', 'dónde': 'where', 'cómo': 'how',
            'por qué': 'why', 'cuánto': 'how much', 'cuál': 'which',
            
            // Cortesía
            'gracias': 'thank you', 'de nada': 'you\'re welcome', 'por favor': 'please',
            'disculpa': 'excuse me', 'perdón': 'sorry', 'lo siento': 'I\'m sorry'
        };

        // Base de datos temática
        const themeDatabase = {
            amor: ['amor', 'corazón', 'sentimientos', 'romance'],
            belleza: ['hermosa', 'bella', 'linda', 'preciosa'],
            deseo: ['quiero', 'deseo', 'me gusta', 'necesito'],
            felicidad: ['feliz', 'alegre', 'contento', 'sonrisa']
        };

        // FUNCIÓN 1: Generar por categoría
        function generateByCategory(category) {
            if (!responses[category]) {
                alert('Categoría no encontrada');
                return;
            }
            const categoryResponses = responses[category];
            const randomResponse = categoryResponses[Math.floor(Math.random() * categoryResponses.length)];
            currentResponse = randomResponse;
            displayResponseWithRating('generatedResponse', randomResponse, category);
        }

        // FUNCIÓN 2: Detectar tema
        function detectTheme(keyword) {
            for (const theme in themeDatabase) {
                if (themeDatabase[theme].some(function(word) {
                    return keyword.includes(word) || word.includes(keyword);
                })) {
                    return theme;
                }
            }
            return 'general';
        }

        // FUNCIÓN 3: Generar respuesta inteligente
        function generateIntelligentResponse(keyword, theme, style, intensity) {
            const styleTemplates = {
                flirty: {
                    amor: ["El amor... qué tema tan profundo para una conversación 😏"],
                    general: ["Me gusta cómo piensas sobre estos temas 😉"]
                },
                sweet: {
                    amor: ["El amor es lo más hermoso del mundo 💕"],
                    general: ["Eres tan tierno cuando hablas de eso 💕"]
                },
                seductive: {
                    general: ["Sabes cómo encenderme con esas palabras 🔥"]
                },
                friendly: {
                    general: ["Me gusta mucho tu perspectiva sobre esto"]
                }
            };

            const responses = styleTemplates[style] || styleTemplates.friendly;
            const themeResponses = responses[theme] || responses.general;
            let response = themeResponses[Math.floor(Math.random() * themeResponses.length)];

            // Ajustar intensidad
            const emojis = ['', '😊', '😉', '😏', '🔥'];
            if (intensity > 1 && intensity <= 5) {
                response += ' ' + emojis[intensity - 1];
            }

            return response;
        }

        // FUNCIÓN 4: Generador personalizado avanzado (con modo extremo)
        function generateAdvancedCustom() {
            const keyword = document.getElementById('customKeyword').value.trim();
            const style = document.getElementById('responseStyle').value;
            const intensity = parseInt(document.getElementById('intensityLevel').value);

            if (!keyword) {
                alert('Por favor ingresa una palabra clave');
                return;
            }

            let response;
            
            // Si está en MODO EXTREMO, generar respuestas súper atrevidas
            if (isExtremeMode) {
                response = generateExtremeCustomResponse(keyword, style, intensity);
                customResponse = response;
                displayExtremeResponse('customResponse', response);
                return;
            }

            // Modo normal
            const detectedTheme = detectTheme(keyword.toLowerCase());
            response = generateIntelligentResponse(keyword, detectedTheme, style, intensity);

            customResponse = response;
            displayResponseWithRating('customResponse', response, 'custom');
        }

        // Nueva función para generar respuestas personalizadas extremas
        function generateExtremeCustomResponse(keyword, style, intensity) {
            const extremeCustomTemplates = {
                flirty: {
                    amor: [
                        `El amor... mmm, me pones a pensar en cosas muy traviesas 🔥`,
                        `Hablar de amor contigo me tiene toda excitada 😈`,
                        `Me gusta cuando mencionas el amor... me calientas tanto 💦`
                    ],
                    belleza: [
                        `La belleza... como la tuya que me tiene completamente mojada 💦`,
                        `Me encanta que valores la belleza, especialmente cuando me miras así 🔥`,
                        `Sabes apreciar lo bello... y yo sé cómo ser muy bella para ti 😈`
                    ],
                    deseo: [
                        `El deseo... mmm, sabes cómo despertar el mío completamente 🥵`,
                        `Me gusta cuando hablas de deseo, me prendes toda 🔥`,
                        `Tu forma de expresar el deseo me vuelve loca de ganas 💋`
                    ],
                    felicidad: [
                        `La felicidad... me haces tan feliz que quiero celebrarlo contigo de formas muy íntimas 😈`,
                        `Tu alegría es tan contagiosa que me dan ganas de hacerte muy feliz también 🔥`,
                        `Me pones tan contenta que quiero demostrártelo de maneras muy traviesas 💦`
                    ],
                    general: [
                        `Mmm, me encanta cómo piensas sobre eso... me tienes toda caliente 🔥`,
                        `Tu forma de hablar de eso me pone muy traviesa 😈`,
                        `Me gusta tu perspectiva... me dan ganas de hacer cosas sucias contigo 💦`
                    ]
                },
                sweet: {
                    amor: [
                        `El amor... ay, me derrites tanto que quiero darte todo mi cuerpo 💕🔥`,
                        `Eres tan dulce hablando de amor que me dan ganas de ser muy mala contigo 😈`,
                        `Tu ternura me excita de maneras que no puedo explicar 💋`
                    ],
                    belleza: [
                        `La belleza... como la forma tan sexy en que me hablas 🥵`,
                        `Me derrites con tu dulzura, pero también me prendes mucho 🔥`,
                        `Eres tan tierno que me dan ganas de ser muy traviesa contigo 😈`
                    ],
                    general: [
                        `Eres tan dulce que me provocas hacer cosas muy sucias 💦`,
                        `Tu ternura me excita de formas increíbles 🔥`,
                        `Me derrites tanto que quiero darte todo de mí 😈`
                    ]
                },
                seductive: {
                    pasion: [
                        `La pasión... sabes cómo encender la mía completamente 🔥`,
                        `Me gusta tu lado apasionado... me tienes empapada 💦`,
                        `Tu pasión despierta mi lado más salvaje y cochino 😈`
                    ],
                    deseo: [
                        `El deseo... mmm, el tuyo me vuelve loca de ganas 🥵`,
                        `Tu forma de desear me tiene completamente entregada 💋`,
                        `Me encanta cómo expresas tu deseo... me tienes ardiendo 🔥`
                    ],
                    general: [
                        `Sabes cómo volverme loca con esas palabras 🔥`,
                        `Me tienes completamente sometida a tu seducción 😈`,
                        `Tu forma de hablar me tiene toda mojada 💦`
                    ]
                },
                mysterious: {
                    general: [
                        `Hay algo muy sexy en tu misterio... me excita no saber qué planeas hacerme 🔥`,
                        `Tu lado enigmático me tiene intrigada y muy caliente 😈`,
                        `Me fascina tu misterio... me dan ganas de descubrir todos tus secretos sucios 💦`
                    ]
                },
                funny: {
                    trabajo: [
                        `¡El trabajo! Prefiero trabajar en hacerte gemir de placer 😈`,
                        `¿Trabajo? El único trabajo que quiero es complacerte toda la noche 🔥`,
                        `Mejor trabajemos juntos en algo mucho más divertido y cochino 💦`
                    ],
                    general: [
                        `Jajaja, eres tan gracioso que me dan ganas de premiarte de formas muy traviesas 😈`,
                        `Tu humor me excita tanto como me hace reír 🔥`,
                        `Eres tan divertido que quiero hacer cosas muy sucias contigo 💦`
                    ]
                },
                friendly: {
                    general: [
                        `Me gusta tu perspectiva... pero me gusta más imaginarte desnudo 😈`,
                        `Eres muy interesante... especialmente cuando pienso en todas las cosas cochinas que podríamos hacer 🔥`,
                        `Tu forma de pensar me excita mucho 💦`
                    ]
                }
            };

            // Detectar tema
            const theme = detectTheme(keyword.toLowerCase());
            
            // Seleccionar templates
            const styleTemplates = extremeCustomTemplates[style] || extremeCustomTemplates.friendly;
            const themeTemplates = styleTemplates[theme] || styleTemplates.general;
            
            let baseResponse = themeTemplates[Math.floor(Math.random() * themeTemplates.length)];
            
            // Ajustar intensidad extrema
            const extremeIntensityModifiers = {
                1: { additions: [' Me tienes pensando cosas traviesas'] },
                2: { additions: [' Me prendes mucho', ' Me tienes caliente'] },
                3: { additions: [' Me vuelves loca', ' Me tienes mojada', ' Me excitas tanto'] },
                4: { additions: [' Me tienes ardiendo', ' Quiero hacer cosas sucias contigo', ' Me tienes completamente entregada'] },
                5: { additions: [' Me vuelves una perra en celo', ' Quiero que me cojas ahora mismo', ' Me tienes desesperada por ti'] }
            };
            
            const modifier = extremeIntensityModifiers[intensity] || extremeIntensityModifiers[3];
            const addition = modifier.additions[Math.floor(Math.random() * modifier.additions.length)];
            
            return baseResponse + addition;
        }

        // FUNCIÓN 5: Moderar contenido
        function moderateContent(message) {
            if (isExtremeMode) {
                return { isAppropriate: true, severity: 'none', type: 'none', response: null };
            }

            const lowerMessage = message.toLowerCase();
            
            for (const severity in moderationSystem.inappropriate) {
                const words = moderationSystem.inappropriate[severity];
                for (let i = 0; i < words.length; i++) {
                    if (lowerMessage.includes(words[i])) {
                        const responses = moderationSystem.responses[severity];
                        return {
                            isAppropriate: false,
                            severity: severity,
                            type: severity,
                            response: responses[Math.floor(Math.random() * responses.length)]
                        };
                    }
                }
            }

            return { isAppropriate: true, severity: 'none', type: 'none', response: null };
        }

        // FUNCIÓN 6: Generar respuesta extrema
        function generateExtremeResponse(message) {
            const lowerMessage = message.toLowerCase();
            let category = 'seductive';
            
            if (lowerMessage.includes('quiero') || lowerMessage.includes('deseo')) {
                category = 'seductive';
            } else if (lowerMessage.includes('mira') || lowerMessage.includes('ve')) {
                category = 'provocative';
            } else if (lowerMessage.includes('ven') || lowerMessage.includes('hazlo')) {
                category = 'dominant';
            } else if (lowerMessage.includes('traviesa') || lowerMessage.includes('cochina')) {
                category = 'naughty';
            }
            
            const responses = extremeHotResponses[category];
            return responses[Math.floor(Math.random() * responses.length)];
        }

        // FUNCIÓN 7: Analizar mensaje del usuario
        function analyzeUserMessage(message) {
            const words = message.toLowerCase().split(/\s+/);
            words.forEach(function(word) {
                const cleanWord = word.replace(/[^\w\sáéíóúñü]/gi, '');
                if (cleanWord.length > 2) {
                    if (!userPatterns[cleanWord]) {
                        userPatterns[cleanWord] = 0;
                    }
                    userPatterns[cleanWord]++;
                }
            });
            saveData();
        }

        // FUNCIÓN 8: Análisis avanzado
        function analyzeUserMessageAdvanced(message) {
            const lowerMessage = message.toLowerCase();
            let intent = 'chat';

            if (lowerMessage.includes('?')) intent = 'question';
            if (lowerMessage.includes('hola') || lowerMessage.includes('hi')) intent = 'greeting';
            if (lowerMessage.includes('hermosa') || lowerMessage.includes('bella')) intent = 'compliment';
            if (lowerMessage.includes('gracias')) intent = 'gratitude';
            if (lowerMessage.includes('ja') || lowerMessage.includes('jeje')) intent = 'humor';

            analyzeUserMessage(message);

            return {
                intent: intent,
                length: message.split(' ').length
            };
        }

        // FUNCIÓN 9: Generar respuesta contextual
        function generateContextualResponse() {
            const userMessage = document.getElementById('userMessage').value.trim();
            const responseType = document.getElementById('responseType').value;

            if (!userMessage) {
                alert('Por favor pega el mensaje del usuario');
                return;
            }

            let response = '';

            // Modo extremo
            if (isExtremeMode) {
                response = generateExtremeResponse(userMessage);
                contextualResponse = response;
                displayExtremeResponse('contextualResponse', response);
                return;
            }

            // Moderación normal
            const moderationResult = moderateContent(userMessage);
            if (!moderationResult.isAppropriate) {
                response = moderationResult.response;
                contextualResponse = response;
                displayModerationResponse('contextualResponse', response, moderationResult);
                return;
            }

            // Análisis normal
            const analysis = analyzeUserMessageAdvanced(userMessage);

            if (responseType === 'auto') {
                if (analysis.intent === 'greeting') {
                    response = "¡Hola! Qué alegría verte por aquí 😊";
                } else if (analysis.intent === 'compliment') {
                    response = "Aww, me haces sonrojar 😊 Tú también eres muy dulce";
                } else if (analysis.intent === 'question') {
                    response = "Qué pregunta tan interesante... me gusta cómo piensas";
                } else if (analysis.intent === 'gratitude') {
                    response = "De nada, amor. Me encanta hacerte feliz 💕";
                } else if (analysis.intent === 'humor') {
                    response = "¡Jajaja! Me encanta tu sentido del humor 😂";
                } else {
                    response = "Me gusta mucho hablar contigo, tienes algo especial";
                }
            } else {
                switch(responseType) {
                    case 'compliment': response = "Aww, me haces sonrojar 😊"; break;
                    case 'question': response = "Qué pregunta tan interesante"; break;
                    case 'request': response = "Me gusta cuando eres directo 😉"; break;
                    case 'joke': response = "¡Jajaja! Me encanta tu humor 😂"; break;
                    case 'flirt': response = "Mmm, me gusta cómo suena eso 😏"; break;
                    case 'thanks': response = "De nada, amor 💕"; break;
                    default: response = "Me fascina tu personalidad"; break;
                }
            }

            contextualResponse = response;
            displayResponseWithRating('contextualResponse', response, 'contextual');
        }

        // FUNCIÓN 10: Alternar modo extremo (mejorada con indicadores)
        function toggleExtremeMode() {
            isExtremeMode = !isExtremeMode;
            const button = document.querySelector('.extreme-toggle');
            const indicator = document.querySelector('.mode-indicator');
            const intensityIndicator = document.querySelector('.intensity-indicator');

            if (isExtremeMode) {
                button.style.background = 'linear-gradient(45deg, #e74c3c, #c0392b)';
                button.innerHTML = '🔥 MODO EXTREMO ON';
                indicator.innerHTML = '<span style="color: #e74c3c; font-weight: bold;">🔥 MODO EXTREMO ACTIVADO</span>';
                
                // Actualizar indicador de intensidad
                if (intensityIndicator) {
                    updateIntensityIndicator();
                }
                
                alert('🔥 MODO EXTREMO ACTIVADO\n\n• Respuestas súper atrevidas y provocativas\n• Generador personalizado extremo\n• Análisis contextual sin moderación');
            } else {
                button.style.background = 'linear-gradient(45deg, #95a5a6, #7f8c8d)';
                button.innerHTML = '🔥 Modo Extremo';
                indicator.innerHTML = '<span style="color: #27ae60;">✓ Modo Normal</span>';
                
                // Limpiar indicador de intensidad
                if (intensityIndicator) {
                    intensityIndicator.innerHTML = '';
                }
                
                alert('✓ Modo normal activado - Respuestas elegantes y profesionales');
            }
        }

        // Nueva función para actualizar indicador de intensidad
        function updateIntensityIndicator() {
            const intensityLevel = document.getElementById('intensityLevel');
            const intensityIndicator = document.querySelector('.intensity-indicator');
            
            if (!intensityIndicator || !intensityLevel) return;
            
            const level = parseInt(intensityLevel.value);
            
            if (isExtremeMode) {
                const extremeLabels = {
                    1: '🔥 Traviesa',
                    2: '🔥 Caliente', 
                    3: '🔥 Ardiente',
                    4: '🔥 Salvaje',
                    5: '🔥 EXTREMO'
                };
                intensityIndicator.innerHTML = `<span style="color: #e74c3c;">${extremeLabels[level]}</span>`;
            } else {
                const normalLabels = {
                    1: '😊 Suave',
                    2: '😉 Coqueta',
                    3: '😏 Juguetona', 
                    4: '🔥 Intensa',
                    5: '💋 Seductora'
                };
                intensityIndicator.innerHTML = `<span style="color: #3498db;">${normalLabels[level]}</span>`;
            }
        }

        // FUNCIÓN 11: Mostrar respuesta con rating
        function displayResponseWithRating(elementId, response, type) {
            const element = document.getElementById(elementId);
            if (!element) return;

            const safeResponse = response.replace(/'/g, "&#39;").replace(/"/g, "&quot;");

            element.innerHTML =
                '<div class="response-text">' + response + '</div>' +
                '<div style="display: flex; gap: 10px; margin-top: 15px; align-items: center;">' +
                    '<span style="font-size: 12px; opacity: 0.8;">¿Te gustó esta respuesta?</span>' +
                    '<button onclick="rateResponse(\'' + safeResponse + '\', \'' + type + '\', \'like\')" ' +
                            'style="background: #2ecc71; border: none; color: white; padding: 5px 10px; border-radius: 15px; cursor: pointer; font-size: 12px;">' +
                        '👍 Me gusta' +
                    '</button>' +
                    '<button onclick="rateResponse(\'' + safeResponse + '\', \'' + type + '\', \'dislike\')" ' +
                            'style="background: #e74c3c; border: none; color: white; padding: 5px 10px; border-radius: 15px; cursor: pointer; font-size: 12px;">' +
                        '👎 No me gusta' +
                    '</button>' +
                '</div>';
        }

        // FUNCIÓN 12: Mostrar respuesta extrema
        function displayExtremeResponse(elementId, response) {
            const element = document.getElementById(elementId);
            if (!element) return;

            element.innerHTML =
                '<div style="background: linear-gradient(135deg, #e74c3c, #c0392b); border-radius: 10px; padding: 20px; border-left: 4px solid #fff;">' +
                    '<div style="display: flex; align-items: center; margin-bottom: 10px;">' +
                        '<span style="background: #fff; color: #e74c3c; padding: 4px 8px; border-radius: 12px; font-size: 11px; margin-right: 10px; font-weight: bold;">🔥 EXTREMO</span>' +
                        '<span style="font-size: 12px; opacity: 0.9;">Modo súper atrevido activado</span>' +
                    '</div>' +
                    '<div class="response-text" style="font-size: 16px; font-weight: 500; color: #fff;">' + response + '</div>' +
                '</div>' +
                '<div style="display: flex; gap: 10px; margin-top: 15px; align-items: center;">' +
                    '<span style="font-size: 12px; opacity: 0.8;">¿Te gustó esta respuesta extrema?</span>' +
                    '<button onclick="rateExtremeResponse(\'like\')" ' +
                            'style="background: #e74c3c; border: none; color: white; padding: 5px 10px; border-radius: 15px; cursor: pointer; font-size: 12px;">' +
                        '🔥 Me encanta' +
                    '</button>' +
                    '<button onclick="rateExtremeResponse(\'dislike\')" ' +
                            'style="background: #95a5a6; border: none; color: white; padding: 5px 10px; border-radius: 15px; cursor: pointer; font-size: 12px;">' +
                        '😅 Muy fuerte' +
                    '</button>' +
                '</div>';
        }

        // FUNCIÓN 13: Mostrar respuesta de moderación
        function displayModerationResponse(elementId, response, moderationResult) {
            const element = document.getElementById(elementId);
            if (!element) return;

            const severityColors = {
                mild: '#f39c12',
                moderate: '#e67e22',
                severe: '#e74c3c',
                harassment: '#c0392b',
                explicit: '#8e44ad'
            };

            const severityColor = severityColors[moderationResult.severity] || '#95a5a6';

            element.innerHTML =
                '<div style="background: rgba(230, 126, 34, 0.1); border-left: 4px solid ' + severityColor + '; padding: 15px; border-radius: 8px; margin-bottom: 10px;">' +
                    '<div style="display: flex; align-items: center; margin-bottom: 10px;">' +
                        '<span style="background: ' + severityColor + '; color: white; padding: 4px 8px; border-radius: 12px; font-size: 11px; margin-right: 10px;">MODERADO</span>' +
                        '<span style="font-size: 12px; opacity: 0.8;">Respuesta automática por contenido inapropiado</span>' +
                    '</div>' +
                    '<div class="response-text" style="font-style: normal;">' + response + '</div>' +
                '</div>';
        }

        // FUNCIÓN 14: Calificar respuesta
        function rateResponse(response, type, rating) {
            const cleanResponse = response.replace(/&#39;/g, "'").replace(/&quot;/g, '"');
            const key = cleanResponse.substring(0, 50);

            if (!responseRatings[key]) {
                responseRatings[key] = { likes: 0, dislikes: 0, type: type, fullText: cleanResponse };
            }

            if (rating === 'like') {
                responseRatings[key].likes++;
                alert('¡Gracias! Tomaré en cuenta que te gustó esta respuesta 😊');
            } else {
                responseRatings[key].dislikes++;
                alert('Entendido, buscaré respuestas mejores la próxima vez 🤔');
            }

            saveData();
        }

        // FUNCIÓN 15: Calificar respuesta extrema
        function rateExtremeResponse(rating) {
            if (rating === 'like') {
                alert('🔥 ¡Perfecto! Seguiré siendo así de atrevida y provocativa');
            } else {
                alert('😅 Entendido, bajaré un poco la intensidad pero seguiré siendo traviesa');
            }
        }

        // FUNCIÓN 16: Solo moderar
        function checkModerationOnly() {
            const userMessage = document.getElementById('userMessage').value.trim();

            if (!userMessage) {
                alert('Por favor pega el mensaje del usuario para moderar');
                return;
            }

            const moderationResult = moderateContent(userMessage);
            const element = document.getElementById('contextualResponse');

            if (moderationResult.isAppropriate) {
                element.innerHTML =
                    '<div style="background: rgba(46, 204, 113, 0.1); border-left: 4px solid #27ae60; padding: 15px; border-radius: 8px;">' +
                        '<div style="display: flex; align-items: center; margin-bottom: 10px;">' +
                            '<span style="background: #27ae60; color: white; padding: 4px 8px; border-radius: 12px; font-size: 11px; margin-right: 10px;">✓ APROPIADO</span>' +
                            '<span style="font-size: 12px; opacity: 0.8;">El mensaje es apropiado para responder</span>' +
                        '</div>' +
                        '<div style="font-size: 14px;">Puedes responder normalmente a este mensaje.</div>' +
                    '</div>';
            } else {
                element.innerHTML =
                    '<div style="background: rgba(231, 76, 60, 0.1); border-left: 4px solid #e74c3c; padding: 15px; border-radius: 8px;">' +
                        '<div style="display: flex; align-items: center; margin-bottom: 10px;">' +
                            '<span style="background: #e74c3c; color: white; padding: 4px 8px; border-radius: 12px; font-size: 11px; margin-right: 10px;">⚠ INAPROPIADO</span>' +
                            '<span style="font-size: 12px; opacity: 0.8;">Contenido detectado como inapropiado</span>' +
                        '</div>' +
                        '<div style="font-size: 14px; margin-bottom: 10px;"><strong>Respuesta sugerida:</strong></div>' +
                        '<div style="font-style: italic; background: rgba(0,0,0,0.1); padding: 10px; border-radius: 6px;">' +
                            moderationResult.response +
                        '</div>' +
                    '</div>';
            }
        }

        // FUNCIÓN 17: Traductor completamente reescrito y mejorado
        function translateResponse(elementId) {
            const element = document.getElementById(elementId);
            if (!element) return;

            const responseDiv = element.querySelector('.response-text');
            if (!responseDiv) {
                alert('Primero genera una respuesta para traducir');
                return;
            }

            const text = responseDiv.textContent.trim();
            if (!text || text.includes('Haz clic') || text.includes('Configura') || text.includes('Pega el mensaje')) {
                alert('Primero genera una respuesta para traducir');
                return;
            }

            // SISTEMA DE TRADUCCIÓN INTELIGENTE
            const translatedText = intelligentTranslate(text);
            
            const safeText = text.replace(/'/g, "&#39;").replace(/"/g, "&quot;");
            const safeTranslation = translatedText.replace(/'/g, "&#39;").replace(/"/g, "&quot;");

            element.innerHTML =
                '<div style="margin-bottom: 15px;">' +
                    '<div style="background: rgba(255,255,255,0.1); padding: 10px; border-radius: 8px; border-left: 3px solid #ff6b6b;">' +
                        '<strong>🇪🇸 Español:</strong><br>' + text +
                    '</div>' +
                '</div>' +
                '<div style="background: rgba(46, 204, 113, 0.2); padding: 15px; border-radius: 8px; border-left: 3px solid #2ecc71;">' +
                    '<strong>🇺🇸 English:</strong><br>' +
                    '<span style="font-size: 16px; font-weight: 500;">' + translatedText + '</span>' +
                '</div>' +
                '<div style="display: flex; gap: 10px; margin-top: 15px;">' +
                    '<button onclick="restoreOriginal(\'' + elementId + '\', \'' + safeText + '\')" ' +
                            'style="padding: 8px 15px; font-size: 12px; background: linear-gradient(45deg, #95a5a6, #7f8c8d); border: none; color: white; border-radius: 20px; cursor: pointer;">' +
                        '🔄 Volver al original' +
                    '</button>' +
                    '<button onclick="copyToClipboard(\'' + safeTranslation + '\')" ' +
                            'style="padding: 8px 15px; font-size: 12px; background: linear-gradient(45deg, #3498db, #2980b9); border: none; color: white; border-radius: 20px; cursor: pointer;">' +
                        '📋 Copiar traducción' +
                    '</button>' +
                '</div>';
        }

        // Nueva función de traducción inteligente
        function intelligentTranslate(spanishText) {
            // Base de traducciones completas de frases comunes
            const completeTranslations = {
                // Respuestas coquetas
                "¿Sabes qué? Creo que acabas de alegrarme el día con ese comentario": "You know what? I think you just made my day with that comment",
                "Mmm, me gusta cómo piensas... cuéntame más": "Mmm, I like how you think... tell me more",
                "Tienes buen gusto, debo admitirlo": "You have good taste, I must admit",
                "Eres todo un encanto, ¿lo sabías?": "You're quite charming, did you know that?",
                "Me haces sonreír sin poder evitarlo": "You make me smile without being able to help it",
                "Vaya, vaya... alguien sabe cómo conquistar con palabras": "Well, well... someone knows how to charm with words",
                
                // Respuestas divertidas
                "¡Ja! Definitivamente tienes sentido del humor, me caes bien": "Ha! You definitely have a sense of humor, I like you",
                "¿En serio acabas de decir eso? Me has hecho reír en voz alta": "Did you really just say that? You made me laugh out loud",
                "Eres más divertido de lo que esperaba... me gusta": "You're funnier than I expected... I like it",
                "Ok, esa fue buena, te doy puntos por creatividad": "Ok, that was good, I give you points for creativity",
                "¿De dónde sacas estas ocurrencias? Me encanta tu mente": "Where do you get these ideas? I love your mind",
                
                // Respuestas misteriosas
                "Hay algo en ti que me intriga... no logro descifrarte": "There's something about you that intrigues me... I can't figure you out",
                "Mmm, interesante perspectiva... me haces pensar": "Mmm, interesting perspective... you make me think",
                "Tienes una forma muy particular de ver las cosas": "You have a very particular way of seeing things",
                "Hay más de lo que muestras, ¿verdad?": "There's more than what you show, isn't there?",
                "Me pregunto qué otras sorpresas guardas": "I wonder what other surprises you're hiding",
                
                // Respuestas halagadoras
                "Wow, qué detallista eres... se nota que tienes clase": "Wow, how thoughtful you are... you can tell you have class",
                "Me encanta cómo me haces sentir especial": "I love how you make me feel special",
                "Tienes un don para hacer que una chica se sienta única": "You have a gift for making a girl feel unique",
                "Eres increíblemente dulce, ¿sabes eso?": "You're incredibly sweet, do you know that?",
                "Me fascina tu forma de expresarte": "I'm fascinated by the way you express yourself",
                
                // Respuestas juguetonas
                "¿A que no te atreves a decir eso otra vez?": "I bet you don't dare say that again",
                "Uy, alguien está siendo travieso hoy...": "Ooh, someone's being naughty today...",
                "Me gusta este juego, pero yo también sé jugar": "I like this game, but I know how to play too",
                "¿Eso es todo lo que tienes? Esperaba más de ti": "Is that all you've got? I expected more from you",
                "Creo que subestimas mi lado juguetón": "I think you underestimate my playful side",
                
                // Respuestas seductoras
                "Sabes exactamente qué decir para captar mi atención": "You know exactly what to say to get my attention",
                "Me gusta cómo me miras... a través de la pantalla": "I like how you look at me... through the screen",
                "Tienes algo especial que me atrae": "You have something special that attracts me",
                "Eres peligrosamente encantador": "You're dangerously charming",
                "Me haces sentir cosas que no esperaba": "You make me feel things I didn't expect",
                
                // Respuestas dulces
                "Eres tan tierno, me derrites el corazón": "You're so sweet, you melt my heart",
                "Tu dulzura me hace sonreír como tonta": "Your sweetness makes me smile like a fool",
                "Me encantas cuando eres así de adorable": "I love it when you're this adorable",
                "Tienes el corazón más bonito que he conocido": "You have the most beautiful heart I've ever known",
                
                // Respuestas atrevidas
                "Mmm, me gusta tu lado atrevido": "Mmm, I like your daring side",
                "¿Así que quieres jugar con fuego?": "So you want to play with fire?",
                "Me encanta cuando sacas tu lado salvaje": "I love it when you bring out your wild side",
                "Tienes ideas muy interesantes... me intrigas": "You have very interesting ideas... you intrigue me",
                
                // Respuestas románticas
                "Eres como un sueño hecho realidad": "You're like a dream come true",
                "Me haces creer en los cuentos de hadas": "You make me believe in fairy tales",
                "Tienes algo mágico que me enamora": "You have something magical that makes me fall in love",
                "Contigo el mundo se ve más bonito": "With you the world looks more beautiful"
            };

            // Primero buscar traducción completa
            const lowerText = spanishText.toLowerCase().trim();
            for (const spanish in completeTranslations) {
                if (lowerText === spanish.toLowerCase()) {
                    return completeTranslations[spanish];
                }
            }

            // Si no hay traducción completa, usar traducción por patrones
            return translateByPatterns(spanishText);
        }

        // Función de traducción por patrones para frases no predefinidas
        function translateByPatterns(text) {
            let result = text;

            // Patrones de traducción más específicos
            const patterns = [
                // Expresiones con "me"
                { spanish: /me gusta mucho/gi, english: "I really like" },
                { spanish: /me encanta cuando/gi, english: "I love when" },
                { spanish: /me fascina tu/gi, english: "I'm fascinated by your" },
                { spanish: /me haces sentir/gi, english: "you make me feel" },
                { spanish: /me alegras el día/gi, english: "you brighten my day" },
                { spanish: /me tienes/gi, english: "you have me" },
                { spanish: /me gusta/gi, english: "I like" },
                { spanish: /me encanta/gi, english: "I love" },
                
                // Expresiones con "eres" y "tienes"
                { spanish: /eres tan ([a-záéíóúñü]+)/gi, english: "you're so $1" },
                { spanish: /eres muy ([a-záéíóúñü]+)/gi, english: "you're very $1" },
                { spanish: /tienes una forma muy/gi, english: "you have a very" },
                { spanish: /tienes buen gusto/gi, english: "you have good taste" },
                { spanish: /tienes algo especial/gi, english: "you have something special" },
                { spanish: /tienes razón/gi, english: "you're right" },
                
                // Preguntas
                { spanish: /¿sabes qué\?/gi, english: "you know what?" },
                { spanish: /¿cómo estás\?/gi, english: "how are you?" },
                { spanish: /¿qué tal\?/gi, english: "how about?" },
                { spanish: /¿verdad\?/gi, english: "right?" },
                { spanish: /¿lo sabías\?/gi, english: "did you know?" },
                
                // Expresiones de tiempo
                { spanish: /cada vez que/gi, english: "every time" },
                { spanish: /de vez en cuando/gi, english: "from time to time" },
                { spanish: /por primera vez/gi, english: "for the first time" },
                { spanish: /hace mucho tiempo/gi, english: "a long time ago" },
                
                // Conectores y expresiones
                { spanish: /por supuesto/gi, english: "of course" },
                { spanish: /sin embargo/gi, english: "however" },
                { spanish: /de nada/gi, english: "you're welcome" },
                { spanish: /por favor/gi, english: "please" },
                { spanish: /lo siento/gi, english: "I'm sorry" },
                { spanish: /qué lindo/gi, english: "how sweet" },
                { spanish: /qué rico/gi, english: "how nice" },
                { spanish: /está bien/gi, english: "it's okay" }
            ];

            // Aplicar patrones
            patterns.forEach(function(pattern) {
                result = result.replace(pattern.spanish, pattern.english);
            });

            // Traducir palabras individuales restantes
            const wordTranslations = {
                'hermosa': 'beautiful', 'bella': 'gorgeous', 'linda': 'pretty',
                'amor': 'love', 'cariño': 'honey', 'corazón': 'heart',
                'feliz': 'happy', 'triste': 'sad', 'contenta': 'happy',
                'gracias': 'thank you', 'hola': 'hello', 'buenas': 'good',
                'sí': 'yes', 'no': 'no', 'muy': 'very', 'más': 'more',
                'bueno': 'good', 'malo': 'bad', 'grande': 'big', 'pequeña': 'small',
                'siempre': 'always', 'nunca': 'never', 'también': 'also',
                'porque': 'because', 'pero': 'but', 'cuando': 'when',
                'donde': 'where', 'como': 'how', 'que': 'that',
                'con': 'with', 'sin': 'without', 'para': 'for', 'por': 'by'
            };

            for (const spanish in wordTranslations) {
                const regex = new RegExp('\\b' + spanish + '\\b', 'gi');
                result = result.replace(regex, wordTranslations[spanish]);
            }

            // Limpiar y formatear
            result = result
                .replace(/¿/g, '')
                .replace(/¡/g, '')
                .replace(/\s+/g, ' ')
                .trim();

            // Capitalizar primera letra
            result = result.charAt(0).toUpperCase() + result.slice(1);

            // Agregar puntuación final si no la tiene
            if (!result.match(/[.!?]$/)) {
                if (result.includes('?')) {
                    // Ya tiene pregunta
                } else if (text.includes('!')) {
                    result += '!';
                } else {
                    result += '.';
                }
            }

            return result;
        }

        // FUNCIÓN 18: Restaurar original
        function restoreOriginal(elementId, originalText) {
            const element = document.getElementById(elementId);
            const cleanText = originalText.replace(/&#39;/g, "'").replace(/&quot;/g, '"');
            element.innerHTML = '<div class="response-text">' + cleanText + '</div>';
        }

        // FUNCIÓN 19: Copiar al portapapeles (corregida)
        function copyToClipboard(text) {
            const cleanText = text.replace(/&#39;/g, "'").replace(/&quot;/g, '"');
            
            if (navigator.clipboard && navigator.clipboard.writeText) {
                navigator.clipboard.writeText(cleanText).then(function() {
                    alert('¡Traducción copiada al portapapeles! ✅');
                }).catch(function() {
                    fallbackCopyTextToClipboard(cleanText);
                });
            } else {
                fallbackCopyTextToClipboard(cleanText);
            }
        }

        // Función auxiliar para copiar texto (fallback)
        function fallbackCopyTextToClipboard(text) {
            const textArea = document.createElement('textarea');
            textArea.value = text;
            textArea.style.position = 'fixed';
            textArea.style.left = '-999999px';
            textArea.style.top = '-999999px';
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();
            
            try {
                const successful = document.execCommand('copy');
                if (successful) {
                    alert('¡Traducción copiada al portapapeles! ✅');
                } else {
                    alert('No se pudo copiar. Selecciona el texto manualmente.');
                }
            } catch (err) {
                alert('Error al copiar: ' + err);
            }
            
            document.body.removeChild(textArea);
        }

        // FUNCIÓN 20: Guardar en favoritos
        function saveToFavorites() {
            if (!currentResponse) {
                alert('Primero genera una respuesta para guardar');
                return;
            }
            if (favorites.includes(currentResponse)) {
                alert('Esta respuesta ya está en tus favoritos');
                return;
            }
            favorites.push(currentResponse);
            saveData();
            updateFavoritesList();
            alert('¡Respuesta guardada en favoritos!');
        }

        function saveCustomToFavorites() {
            if (!customResponse) {
                alert('Primero genera una respuesta personalizada');
                return;
            }
            if (favorites.includes(customResponse)) {
                alert('Esta respuesta ya está en favoritos');
                return;
            }
            favorites.push(customResponse);
            saveData();
            updateFavoritesList();
            alert('¡Respuesta guardada!');
        }

        function saveContextualToFavorites() {
            if (!contextualResponse) {
                alert('Primero genera una respuesta contextual');
                return;
            }
            if (favorites.includes(contextualResponse)) {
                alert('Esta respuesta ya está en favoritos');
                return;
            }
            favorites.push(contextualResponse);
            saveData();
            updateFavoritesList();
            alert('¡Respuesta guardada!');
        }

        // FUNCIÓN 21: Eliminar favorito
        function deleteFavorite(index) {
            if (index >= 0 && index < favorites.length) {
                favorites.splice(index, 1);
                saveData();
                updateFavoritesList();
            }
        }

        // FUNCIÓN 22: Mostrar favoritos
        function showFavorites() {
            const favoritesList = document.getElementById('favoritesList');
            if (favorites.length === 0) {
                favoritesList.innerHTML = '<p style="text-align: center; opacity: 0.6;">No tienes respuestas favoritas aún</p>';
            } else {
                const favoritesHTML = favorites.map(function(fav, index) {
                    return '<div class="favorite-item">' +
                           '<button class="delete-btn" onclick="deleteFavorite(' + index + ')">×</button>' +
                           fav +
                           '</div>';
                }).join('');
                favoritesList.innerHTML = favoritesHTML;
            }
        }

        // FUNCIÓN 23: Mostrar estadísticas
        function showStats() {
            const favoritesList = document.getElementById('favoritesList');
            const totalLikes = Object.values(responseRatings).reduce(function(sum, rating) {
                return sum + rating.likes;
            }, 0);
            const totalDislikes = Object.values(responseRatings).reduce(function(sum, rating) {
                return sum + rating.dislikes;
            }, 0);
            const totalPatterns = Object.keys(userPatterns).length;

            const sortedPatterns = Object.entries(userPatterns)
                .sort(function(a, b) { return b[1] - a[1]; })
                .slice(0, 10);

            const patternHTML = sortedPatterns.map(function(item) {
                return '<span style="background: rgba(255,255,255,0.2); padding: 5px 10px; border-radius: 15px; font-size: 12px;">' +
                       item[0] + ' (' + item[1] + ')' +
                       '</span>';
            }).join('');

            favoritesList.innerHTML =
                '<div style="background: rgba(155, 89, 182, 0.2); padding: 20px; border-radius: 10px; border-left: 4px solid #9b59b6;">' +
                    '<h3 style="margin-bottom: 15px;">📊 Estadísticas de Aprendizaje</h3>' +
                    '<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">' +
                        '<div style="background: rgba(46, 204, 113, 0.3); padding: 15px; border-radius: 8px; text-align: center;">' +
                            '<div style="font-size: 24px; font-weight: bold;">' + totalLikes + '</div>' +
                            '<div style="font-size: 12px;">👍 Respuestas que gustaron</div>' +
                        '</div>' +
                        '<div style="background: rgba(231, 76, 60, 0.3); padding: 15px; border-radius: 8px; text-align: center;">' +
                            '<div style="font-size: 24px; font-weight: bold;">' + totalDislikes + '</div>' +
                            '<div style="font-size: 12px;">👎 Respuestas a mejorar</div>' +
                        '</div>' +
                        '<div style="background: rgba(52, 152, 219, 0.3); padding: 15px; border-radius: 8px; text-align: center;">' +
                            '<div style="font-size: 24px; font-weight: bold;">' + totalPatterns + '</div>' +
                            '<div style="font-size: 12px;">🔤 Palabras aprendidas</div>' +
                        '</div>' +
                        '<div style="background: rgba(241, 196, 15, 0.3); padding: 15px; border-radius: 8px; text-align: center;">' +
                            '<div style="font-size: 24px; font-weight: bold;">' + Math.round((totalLikes / (totalLikes + totalDislikes || 1)) * 100) + '%</div>' +
                            '<div style="font-size: 12px;">📈 Tasa de éxito</div>' +
                        '</div>' +
                    '</div>' +
                    '<div style="margin-top: 20px;">' +
                        '<h4>🔥 Palabras más usadas por usuarios:</h4>' +
                        '<div style="display: flex; flex-wrap: wrap; gap: 8px; margin-top: 10px;">' +
                            patternHTML +
                        '</div>' +
                    '</div>' +
                '</div>';
        }

        // FUNCIÓN 24: Mostrar estadísticas de moderación
        function showModerationStats() {
            const favoritesList = document.getElementById('favoritesList');
            const totalWarnings = userBehaviorTracker.warningsCount;
            const inappropriateCount = userBehaviorTracker.inappropriateMessages;
            const consecutiveWarnings = userBehaviorTracker.consecutiveWarnings;

            favoritesList.innerHTML =
                '<div style="background: rgba(156, 39, 176, 0.2); padding: 20px; border-radius: 10px; border-left: 4px solid #9c27b0;">' +
                    '<h3 style="margin-bottom: 15px;">🛡️ Estadísticas de Moderación</h3>' +
                    '<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 20px;">' +
                        '<div style="background: rgba(255, 193, 7, 0.3); padding: 15px; border-radius: 8px; text-align: center;">' +
                            '<div style="font-size: 24px; font-weight: bold;">' + totalWarnings + '</div>' +
                            '<div style="font-size: 12px;">⚠️ Total de advertencias</div>' +
                        '</div>' +
                        '<div style="background: rgba(244, 67, 54, 0.3); padding: 15px; border-radius: 8px; text-align: center;">' +
                            '<div style="font-size: 24px; font-weight: bold;">' + inappropriateCount + '</div>' +
                            '<div style="font-size: 12px;">🚫 Mensajes inapropiados</div>' +
                        '</div>' +
                        '<div style="background: rgba(156, 39, 176, 0.3); padding: 15px; border-radius: 8px; text-align: center;">' +
                            '<div style="font-size: 24px; font-weight: bold;">' + consecutiveWarnings + '</div>' +
                            '<div style="font-size: 12px;">🔄 Advertencias consecutivas</div>' +
                        '</div>' +
                        '<div style="background: rgba(76, 175, 80, 0.3); padding: 15px; border-radius: 8px; text-align: center;">' +
                            '<div style="font-size: 24px; font-weight: bold;">' + (consecutiveWarnings < 2 ? 'BIEN' : 'ALERTA') + '</div>' +
                            '<div style="font-size: 12px;">📊 Estado del usuario</div>' +
                        '</div>' +
                    '</div>' +
                    '<div style="margin-top: 20px;">' +
                        '<h4>🎯 Recomendaciones:</h4>' +
                        '<div style="margin-top: 10px;">' +
                            (consecutiveWarnings === 0 ?
                                '<span style="color: #4caf50;">✓ Usuario se comporta apropiadamente</span>' :
                                consecutiveWarnings < 3 ?
                                '<span style="color: #ff9800;">⚠ Mantener vigilancia moderada</span>' :
                                '<span style="color: #f44336;">🚨 Considerar escalación</span>') +
                        '</div>' +
                        '<div style="margin-top: 15px; padding: 10px; background: rgba(0,0,0,0.1); border-radius: 6px;">' +
                            '<strong>Modo actual:</strong> ' + (isExtremeMode ? '<span style="color: #e74c3c;">🔥 EXTREMO</span>' : '<span style="color: #27ae60;">✓ Normal</span>') +
                        '</div>' +
                    '</div>' +
                '</div>';
        }

        // FUNCIÓN 25: Exportar datos
        function exportData() {
            const data = {
                favorites: favorites,
                ratings: responseRatings,
                patterns: userPatterns,
                moderation: userBehaviorTracker,
                exportDate: new Date().toISOString()
            };

            const jsonData = JSON.stringify(data, null, 2);
            const blob = new Blob([jsonData], { type: 'application/json' });
            const url = URL.createObjectURL(blob);

            const a = document.createElement('a');
            a.href = url;
            a.download = 'respuestas_datos_' + new Date().toISOString().split('T')[0] + '.json';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);

            alert('📁 Datos exportados exitosamente');
        }

        // FUNCIÓN 26: Actualizar lista de favoritos
        function updateFavoritesList() {
            showFavorites();
            const favCount = document.getElementById('favCount');
            if (favCount) {
                favCount.textContent = favorites.length;
            }
        }

        // FUNCIÓN 27: Inicializar event listeners (mejorada)
        function initializeEventListeners() {
            const intensitySlider = document.getElementById('intensityLevel');
            if (intensitySlider) {
                intensitySlider.addEventListener('input', function() {
                    const intensityValue = document.getElementById('intensityValue');
                    if (intensityValue) {
                        intensityValue.textContent = this.value;
                    }
                    // Actualizar indicador de intensidad
                    updateIntensityIndicator();
                });
            }

            const customKeyword = document.getElementById('customKeyword');
            if (customKeyword) {
                customKeyword.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        generateAdvancedCustom();
                    }
                });
            }

            const userMessage = document.getElementById('userMessage');
            if (userMessage) {
                userMessage.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter' && e.ctrlKey) {
                        generateContextualResponse();
                    }
                });
            }

            // Inicializar indicador de intensidad
            setTimeout(function() {
                updateIntensityIndicator();
            }, 100);
        }

        // FUNCIÓN 28: Inicializar aplicación
        function initializeApp() {
            loadData();
            updateFavoritesList();
            initializeEventListeners();
        }

        // Inicializar cuando el DOM esté listo
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initializeApp);
        } else {
            setTimeout(initializeApp, 100);
        }
    </script>    <script>
        // Variables globales
        let favorites = [];
        let currentResponse = '';
        let customResponse = '';
        let contextualResponse = '';
        let responseRatings = {};
        let userPatterns = {};

        // Función segura para manejar datos
        function saveData() {
            console.log('Datos guardados en memoria de sesión');
        // Base de datos temática (después del sistema de moderación)
        const themeDatabase = {
            amor: ['amor', 'corazón', 'sentimientos', 'romance', 'pareja', 'cariño'],
            belleza: ['hermosa', 'bella', 'linda', 'preciosa', 'guapa', 'sexy'],
            deseo: ['quiero', 'deseo', 'me gusta', 'necesito', 'anhelo'],
            pasion: ['pasión', 'fuego', 'intenso', 'ardiente', 'caliente'],
            felicidad: ['feliz', 'alegre', 'contento', 'sonrisa', 'risa', 'diversión'],
            tristeza: ['triste', 'mal', 'deprimido', 'llorar', 'dolor'],
            trabajo: ['trabajo', 'oficina', 'jefe', 'reunión', 'proyecto'],
            ejercicio: ['ejercicio', 'gym', 'deporte', 'correr', 'fitness']
        };

        function loadData() {
            favorites = [];
            responseRatings = {};
            userPatterns = {};
        }

        // Base de datos de respuestas
        const responses = {
            coquetas: [
                "¿Sabes qué? Creo que acabas de alegrarme el día con ese comentario 😊",
                "Mmm, me gusta cómo piensas... cuéntame más",
                "Tienes buen gusto, debo admitirlo 😉",
                "Eres todo un encanto, ¿lo sabías?",
                "Me haces sonreír sin poder evitarlo",
                "Vaya, vaya... alguien sabe cómo conquistar con palabras",
                "Creo que me estás robando el corazón poco a poco"
            ],
            divertidas: [
                "¡Ja! Definitivamente tienes sentido del humor, me caes bien",
                "¿En serio acabas de decir eso? Me has hecho reír en voz alta",
                "Eres más divertido de lo que esperaba... me gusta",
                "Ok, esa fue buena, te doy puntos por creatividad",
                "¿De dónde sacas estas ocurrencias? Me encanta tu mente",
                "Creo que acabas de ganar el premio al comentario más original del día"
            ],
            misteriosas: [
                "Hay algo en ti que me intriga... no logro descifrarte",
                "Mmm, interesante perspectiva... me haces pensar",
                "Tienes una forma muy particular de ver las cosas",
                "Hay más de lo que muestras, ¿verdad?",
                "Me pregunto qué otras sorpresas guardas",
                "Eres como un libro que apenas estoy empezando a leer"
            ],
            halagadoras: [
                "Wow, qué detallista eres... se nota que tienes clase",
                "Me encanta cómo me haces sentir especial",
                "Tienes un don para hacer que una chica se sienta única",
                "Eres increíblemente dulce, ¿sabes eso?",
                "Me fascina tu forma de expresarte",
                "Tienes una energía muy positiva, es contagiosa"
            ],
            juguetonas: [
                "¿A que no te atreves a decir eso otra vez? 😏",
                "Uy, alguien está siendo travieso hoy...",
                "Me gusta este juego, pero yo también sé jugar",
                "¿Eso es todo lo que tienes? Esperaba más de ti",
                "Creo que subestimas mi lado juguetón",
                "Cuidado, porque puedo ser más traviesa de lo que imaginas"
            ],
            seductoras: [
                "Sabes exactamente qué decir para captar mi atención",
                "Me gusta cómo me miras... a través de la pantalla",
                "Tienes algo especial que me atrae",
                "Eres peligrosamente encantador",
                "Me haces sentir cosas que no esperaba",
                "Hay una química entre nosotros que no puedo negar"
            ],
            dulces: [
                "Eres tan tierno, me derrites el corazón 💕",
                "Tu dulzura me hace sonreír como tonta",
                "Me encantas cuando eres así de adorable",
                "Tienes el corazón más bonito que he conocido",
                "Eres como un rayito de sol en mi día"
            ],
            atrevidas: [
                "Mmm, me gusta tu lado atrevido 🔥",
                "¿Así que quieres jugar con fuego?",
                "Me encanta cuando sacas tu lado salvaje",
                "Tienes ideas muy interesantes... me intrigas",
                "Eres más atrevido de lo que pensé, me gusta"
            ],
            romanticas: [
                "Eres como un sueño hecho realidad",
                "Me haces creer en los cuentos de hadas",
                "Tienes algo mágico que me enamora",
                "Contigo el mundo se ve más bonito",
                "Eres mi lugar favorito en el universo"
            ]
        };

        // Diccionario de traducciones
        const translations = {
            'hola': 'hello', 'amor': 'love', 'cariño': 'honey', 'corazón': 'heart',
            'hermosa': 'beautiful', 'bella': 'gorgeous', 'linda': 'pretty', 'sexy': 'sexy',
            'me gusta': 'I like', 'me encanta': 'I love', 'gracias': 'thank you',
            'feliz': 'happy', 'contenta': 'happy', 'hoy': 'today', 'siempre': 'always',
            'pero': 'but', 'porque': 'because', 'muy': 'very', 'bueno': 'good',
            'sí': 'yes', 'no': 'no', 'qué': 'what', 'cómo': 'how', 'cuándo': 'when',
            'de': 'of', 'en': 'in', 'con': 'with', 'la': 'the', 'el': 'the',
            'y': 'and', 'o': 'or', 'que': 'that', 'es': 'is', 'eres': 'you are'
        };

        // Sistema de moderación inteligente (corregido)
        const moderationSystem = {
            inappropriate: {
                mild: ['tonto', 'idiota', 'estúpido', 'imbécil', 'pendejo', 'boludo'],
                moderate: ['puta', 'zorra', 'perra', 'cabrón', 'hijo de', 'mierda', 'joder'],
                severe: ['violación', 'matar', 'morir', 'suicidio', 'drogas', 'muerte'],
                harassment: ['acoso', 'perseguir', 'stalkear', 'obsesión', 'forzar', 'obligar'],
                explicit: ['follar', 'coger', 'penetrar', 'correrse', 'venirse', 'masturbación']
            },
            
            patterns: {
                repetitive: /(.{3,})\1{2,}/gi,
                allCaps: /^[A-Z\s!?]{10,}$/,
                excessive_punctuation: /[!?]{4,}/,
                demanding: /(ahora|ya|rápido|inmediatamente).*(quiero|exijo|demando)/i,
                inappropriate_requests: /(muestra|enseña|quítate|desnúdate|tetas|culo)/i
            },

            responses: {
                mild: [
                    "Prefiero mantener nuestra conversación en un tono más amable y respetuoso 😊",
                    "Me gusta más cuando usamos palabras bonitas para comunicarnos",
                    "Creo que podemos expresarnos de una manera más elegante, ¿no te parece?"
                ],
                moderate: [
                    "Aprecio mucho el respeto mutuo en nuestras conversaciones. ¿Podríamos mantener un tono más cordial?",
                    "Me siento más cómoda cuando hablamos con educación y consideración",
                    "Prefiero que mantengamos una comunicación más respetuosa y civilizada"
                ],
                severe: [
                    "No me siento cómoda con este tipo de comentarios. Te agradecería que cambiáramos de tema",
                    "Creo que sería mejor si dirigimos nuestra conversación hacia algo más positivo",
                    "Prefiero no hablar de temas tan intensos. ¿Qué tal si hablamos de algo más agradable?"
                ],
                harassment: [
                    "Me parece importante establecer límites saludables en nuestra interacción",
                    "Prefiero mantener una distancia apropiada y respetuosa en nuestra comunicación",
                    "Creo que es mejor mantener nuestra conversación en términos amigables pero apropiados"
                ],
                explicit: [
                    "Mantengo conversaciones más elegantes y sofisticadas. ¿Te parece si hablamos de algo más interesante?",
                    "Prefiero conversaciones que tengan más clase y sustancia",
                    "Me gusta más cuando nuestras charlas son inteligentes y con estilo"
                ],
                repetitive: [
                    "Noto que te repites mucho. ¿Hay algo específico que te preocupa?",
                    "Parece que algo te tiene muy pensativo. ¿Quieres hablar de ello de manera más tranquila?"
                ],
                demanding: [
                    "Me gusta más cuando las cosas fluyen naturalmente sin presiones",
                    "Prefiero cuando somos pacientes y dejamos que la conversación se desarrolle orgánicamente"
                ]
            }
        };

        // Respuestas EXTREMAS ATREVIDAS para modalidad HOT
        const extremeHotResponses = {
            seductive: [
                "Mmm, me encanta cuando eres así de directo... me prendes 🔥",
                "Ay, me haces sentir cosas muy traviesas cuando hablas así 😈",
                "Me tienes completamente mojada con esa actitud tuya 💦",
                "Eres tan malo que me dan ganas de hacer cosas muy sucias contigo 🔥",
                "Me provocas tanto que no puedo evitar tocarme pensando en ti 😏",
                "Sabes exactamente cómo volverme loca de deseo 🥵"
            ],
            provocative: [
                "¿Te gusta lo que ves? Porque a mí me gusta mucho provocarte 😈",
                "Estoy pensando en ti de maneras muy, muy traviesas ahora mismo 💋",
                "Me tienes tan caliente que necesito refrescarme... o mejor aún, calentarme más contigo 🔥",
                "Eres tan irresistible que me dan ganas de hacer travesuras juntos 😏",
                "Me encanta cuando sacas mi lado más salvaje y atrevido 🥵",
                "Tienes una forma muy sexy de hablarme, me tienes toda excitada 💦"
            ],
            dominant: [
                "Me gusta cuando intentas ser dominante... pero yo también sé cómo tomar el control 😈",
                "¿Crees que puedes manejarme? Te aseguro que soy más traviesa de lo que imaginas 🔥",
                "Me excita tu actitud, pero espera a ver lo que puedo hacer yo contigo 💋",
                "Tienes agallas hablándome así... me gusta, me prendes mucho 🥵",
                "¿Quieres jugar rudo? Perfecto, porque a mí me gusta cuando es intenso 😏",
                "Me fascina tu energía... ahora déjame mostrarte la mía 💦"
            ],
            naughty: [
                "Uy, qué travieso eres... me das ideas muy sucias 😈",
                "Me haces pensar en cosas que no debería, pero que quiero hacer contigo 🔥",
                "Eres tan malo que me sacas mi lado más pervertido 💋",
                "Me tienes fantaseando con escenarios muy hot entre nosotros 🥵",
                "Tu maldad me excita de maneras que no puedo explicar 😏",
                "Me encanta cuando eres así de cochino, me prendes toda 💦"
            ]
        };

        let isExtremeMode = false; // Variable para controlar la modalidad extrema

        // Función de moderación corregida
        function moderateContent(message) {
            const lowerMessage = message.toLowerCase();
            let moderationResult = {
                isAppropriate: true,
                severity: 'none',
                type: 'none',
                response: null,
                needsIntervention: false
            };

            // Si está en modo extremo, saltarse la moderación para la mayoría de contenido
            if (isExtremeMode) {
                // Solo moderar contenido realmente extremo en modo hot
                const extremePatterns = ['matar', 'morir', 'suicidio', 'violación', 'muerte'];
                const hasExtreme = extremePatterns.some(pattern => lowerMessage.includes(pattern));
                
                if (!hasExtreme) {
                    return moderationResult; // Permitir casi todo en modo extremo
                }
            }

            // Verificar palabras inapropiadas
            for (const [severity, words] of Object.entries(moderationSystem.inappropriate)) {
                for (const word of words) {
                    if (lowerMessage.includes(word)) {
                        moderationResult.isAppropriate = false;
                        moderationResult.severity = severity;
                        moderationResult.type = severity;
                        moderationResult.needsIntervention = severity === 'severe' || severity === 'harassment';
                        break;
                    }
                }
                if (!moderationResult.isAppropriate) break;
            }

            // Verificar patrones problemáticos
            if (moderationSystem.patterns.repetitive.test(message)) {
                moderationResult.type = 'repetitive';
                moderationResult.isAppropriate = false;
            } else if (moderationSystem.patterns.allCaps.test(message)) {
                moderationResult.type = 'demanding';
                moderationResult.isAppropriate = false;
            } else if (moderationSystem.patterns.excessive_punctuation.test(message)) {
                moderationResult.type = 'demanding';
                moderationResult.isAppropriate = false;
            } else if (moderationSystem.patterns.demanding.test(lowerMessage)) {
                moderationResult.type = 'demanding';
                moderationResult.isAppropriate = false;
            } else if (moderationSystem.patterns.inappropriate_requests.test(lowerMessage)) {
                moderationResult.type = 'explicit';
                moderationResult.isAppropriate = false;
                moderationResult.needsIntervention = true;
            }

            // Generar respuesta apropiada
            if (!moderationResult.isAppropriate) {
                const responses = moderationSystem.responses[moderationResult.type] || moderationSystem.responses.mild;
                moderationResult.response = responses[Math.floor(Math.random() * responses.length)];
            }

            return moderationResult;
        }

        // Función para generar respuestas extremas
        function generateExtremeResponse(message, analysis) {
            const lowerMessage = message.toLowerCase();
            let responseCategory = 'seductive';
            
            // Determinar categoría basada en el contenido
            if (lowerMessage.match(/(quiero|deseo|me gusta|necesito)/)) {
                responseCategory = 'seductive';
            } else if (lowerMessage.match(/(mira|ve|enseña|muestra)/)) {
                responseCategory = 'provocative';
            } else if (lowerMessage.match(/(ven|hazlo|dame|toma)/)) {
                responseCategory = 'dominant';
            } else if (lowerMessage.match(/(traviesa|cochina|sucia|mala)/)) {
                responseCategory = 'naughty';
            }
            
            const responses = extremeHotResponses[responseCategory];
            return responses[Math.floor(Math.random() * responses.length)];
        }

        // Sistema de seguimiento de comportamiento
        let userBehaviorTracker = {
            warningsCount: 0,
            lastWarningTime: null,
            inappropriateMessages: 0,
            consecutiveWarnings: 0
        };

        function trackUserBehavior(moderationResult) {
            if (!moderationResult.isAppropriate) {
                userBehaviorTracker.inappropriateMessages++;
                userBehaviorTracker.warningsCount++;
                userBehaviorTracker.lastWarningTime = Date.now();
                
                if (moderationResult.needsIntervention) {
                    userBehaviorTracker.consecutiveWarnings++;
                }
            } else {
                if (userBehaviorTracker.consecutiveWarnings > 0) {
                    userBehaviorTracker.consecutiveWarnings = Math.max(0, userBehaviorTracker.consecutiveWarnings - 1);
                }
            }
        }

        function generateEscalatedResponse() {
            const escalationResponses = [
                "Creo que necesitamos tomar un pequeño descanso para reflexionar sobre cómo queremos interactuar",
                "Me parece que sería bueno que cada uno tome un momento para pensar en mantener el respeto mutuo",
                "Prefiero pausar nuestra conversación por ahora y retomar cuando podamos hablar más apropiadamente"
            ];
            
            return escalationResponses[Math.floor(Math.random() * escalationResponses.length)];
        }

        // Función principal para generar por categoría
        function generateByCategory(category) {
            if (!responses[category]) {
                alert('Categoría no encontrada');
                return;
            }
            
            const categoryResponses = responses[category];
            const randomResponse = categoryResponses[Math.floor(Math.random() * categoryResponses.length)];
            currentResponse = randomResponse;
            displayResponseWithRating('generatedResponse', randomResponse, category);
        }

        // Función para detectar tema
        function detectTheme(keyword) {
            for (const [theme, words] of Object.entries(themeDatabase)) {
                if (words.some(word => keyword.includes(word) || word.includes(keyword))) {
                    return theme;
                }
            }
            return 'general';
        }

        // Función para generar respuesta inteligente
        function generateIntelligentResponse(keyword, theme, style, intensity) {
            const responsePatterns = {
                flirty: {
                    amor: ["El amor... qué tema tan profundo para una conversación 😏", "Hablar de amor contigo se siente muy especial"],
                    belleza: ["La belleza es algo que definitivamente sabes apreciar 😉", "Me gusta que valores las cosas hermosas"],
                    general: ["Me gusta cómo piensas sobre estos temas 😉", "Tienes una perspectiva muy interesante"]
                },
                sweet: {
                    amor: ["El amor es lo más hermoso del mundo 💕", "Qué lindo es hablar de amor contigo"],
                    belleza: ["La verdadera belleza viene del corazón, como la tuya", "Eres tan dulce cuando hablas de belleza"],
                    general: ["Eres tan tierno cuando hablas de eso 💕", "Me derrites con tu dulzura"]
                },
                seductive: {
                    pasion: ["La pasión es algo que conozco muy bien... 🔥", "Me gusta cuando sacas tu lado más intenso"],
                    general: ["Sabes cómo encenderme con esas palabras 🔥", "Me gusta tu lado más atrevido"]
                },
                funny: {
                    trabajo: ["¡El trabajo! La eterna lucha de la humanidad 😂", "¿Trabajo? Prefiero pensar en diversión"],
                    general: ["¡Jajaja! Siempre sabes cómo hacerme reír 😂", "Tu sentido del humor es lo mejor"]
                },
                friendly: {
                    general: ["Me gusta mucho tu perspectiva sobre esto", "Siempre es interesante hablar contigo"]
                },
                mysterious: {
                    general: ["Hay más detrás de esas palabras de lo que muestras", "Me intriga la profundidad de tu mente"]
                }
            };

            const styleResponses = responsePatterns[style] || responsePatterns['friendly'];
            const themeResponses = styleResponses[theme] || styleResponses['general'];
            let baseResponse = themeResponses[Math.floor(Math.random() * themeResponses.length)];

            // Ajustar intensidad
            const intensityModifiers = {
                1: { emojis: ['😊', '🙂'], additions: [''] },
                2: { emojis: ['😊', '😉'], additions: [' Me gusta eso'] },
                3: { emojis: ['😉', '😏', '💕'], additions: [' Me fascinas', ' Eres genial'] },
                4: { emojis: ['😏', '🔥', '😘'], additions: [' Me tienes cautivada', ' Eres irresistible'] },
                5: { emojis: ['🔥', '💋', '🥵'], additions: [' Me vuelves loca', ' Eres peligrosamente atractivo'] }
            };

            const modifier = intensityModifiers[intensity];
            const emoji = modifier.emojis[Math.floor(Math.random() * modifier.emojis.length)];
            const addition = modifier.additions[Math.floor(Math.random() * modifier.additions.length)];

            let finalResponse = baseResponse + addition;
            if (emoji && !finalResponse.includes(emoji)) {
                finalResponse += ' ' + emoji;
            }

            return finalResponse;
        }

        // Función para generador personalizado avanzado
        function generateAdvancedCustom() {
            const keyword = document.getElementById('customKeyword').value.trim();
            const style = document.getElementById('responseStyle').value;
            const intensity = parseInt(document.getElementById('intensityLevel').value);

            if (!keyword) {
                alert('Por favor ingresa una palabra clave');
                return;
            }

            const detectedTheme = detectTheme(keyword.toLowerCase());
            let response = generateIntelligentResponse(keyword, detectedTheme, style, intensity);

            customResponse = response;
            displayResponseWithRating('customResponse', response, 'custom');
        }

        // Función para analizar mensaje del usuario
        function analyzeUserMessage(message) {
            const words = message.toLowerCase().split(/\s+/);
            words.forEach(function(word) {
                const cleanWord = word.replace(/[^\w\sáéíóúñü]/gi, '');
                if (cleanWord.length > 2) {
                    if (!userPatterns[cleanWord]) {
                        userPatterns[cleanWord] = 0;
                    }
                    userPatterns[cleanWord]++;
                }
            });
            saveData();
        }

        // Función para análisis avanzado
        function analyzeUserMessageAdvanced(message) {
            const lowerMessage = message.toLowerCase();

            let sentiment = 'neutral';
            let emotionalIntensity = 1;
            let intent = 'chat';
            let formality = 'informal';

            // Análisis de sentimientos
            if (lowerMessage.match(/(increíble|fantástico|genial|perfecto|hermoso)/)) {
                sentiment = 'very_positive';
                emotionalIntensity = 5;
            } else if (lowerMessage.match(/(bueno|bien|me gusta|contento|feliz)/)) {
                sentiment = 'positive';
                emotionalIntensity = 3;
            } else if (lowerMessage.match(/(terrible|horrible|mal|triste)/)) {
                sentiment = 'negative';
                emotionalIntensity = 4;
            }

            // Detectar intención
            if (lowerMessage.includes('?')) intent = 'question';
            if (lowerMessage.match(/(quiero|necesito|puedes|podrías)/)) intent = 'request';
            if (lowerMessage.match(/(gracias|thank|agradezco)/)) intent = 'gratitude';
            if (lowerMessage.match(/(hola|hi|hey|buenas)/)) intent = 'greeting';
            if (lowerMessage.match(/(hermosa|bella|sexy|linda)/)) intent = 'compliment';
            if (lowerMessage.match(/(ja|jaja|jeje|lol)/)) intent = 'humor';

            // Detectar temas
            const themes = [];
            for (const [theme, keywords] of Object.entries(themeDatabase)) {
                if (keywords.some(keyword => lowerMessage.includes(keyword))) {
                    themes.push(theme);
                }
            }

            if (lowerMessage.match(/(por favor|disculpe|señorita|usted)/)) {
                formality = 'formal';
            }

            analyzeUserMessage(message);

            return {
                sentiment,
                emotionalIntensity,
                intent,
                themes,
                formality,
                length: message.split(' ').length,
                hasEmojis: /[\u{1F600}-\u{1F64F}]|[\u{1F300}-\u{1F5FF}]|[\u{2600}-\u{26FF}]/u.test(message)
            };
        }

        // Funciones de respuesta específicas
        function generateComplimentResponse() {
            const responses = [
                "Aww, me haces sonrojar 😊 Tú también eres muy dulce",
                "Qué lindo eres, me alegras el día con esos comentarios 💕",
                "Eres un encanto, me haces sentir especial",
                "Me derrites el corazón cuando me dices esas cosas"
            ];
            return responses[Math.floor(Math.random() * responses.length)];
        }

        function generateQuestionResponse() {
            const responses = [
                "Qué pregunta tan interesante... me gusta cómo piensas",
                "Mmm, me haces reflexionar. ¿Tú qué opinas?",
                "Esa es una pregunta profunda, me intriga tu mente",
                "Me encanta cuando eres curioso, dime más"
            ];
            return responses[Math.floor(Math.random() * responses.length)];
        }

        function generateRequestResponse() {
            const responses = [
                "Me gusta cuando eres directo, veamos qué puedo hacer 😉",
                "Hmm, esa es una propuesta interesante...",
                "Me encanta tu iniciativa, eres muy decidido",
                "Vaya, vaya... alguien sabe lo que quiere"
            ];
            return responses[Math.floor(Math.random() * responses.length)];
        }

        function generateJokeResponse() {
            const responses = [
                "¡Jajaja! Me encanta tu sentido del humor 😂",
                "Eres tan divertido, me haces reír muchísimo",
                "¡Qué ocurrente! Me caes muy bien",
                "Tienes un humor genial, me alegras el día"
            ];
            return responses[Math.floor(Math.random() * responses.length)];
        }

        function generateFlirtResponse() {
            const responses = [
                "Mmm, me gusta cómo suena eso 😏",
                "Eres muy travieso, me intrigas",
                "Sabes exactamente qué decir para captar mi atención",
                "Me gusta tu estilo, eres muy seductor"
            ];
            return responses[Math.floor(Math.random() * responses.length)];
        }

        function generateThanksResponse() {
            const responses = [
                "De nada, amor. Me encanta hacerte feliz 💕",
                "Para ti, lo que sea. Eres muy especial",
                "No hay de qué, cariño. Es un placer",
                "Siempre estaré aquí para ti, lo sabes"
            ];
            return responses[Math.floor(Math.random() * responses.length)];
        }

        function generateGreetingResponse() {
            const responses = [
                "¡Hola! Qué alegría verte por aquí 😊",
                "¡Hey! Me alegras el día con tu saludo",
                "¡Hola hermoso! ¿Cómo estás hoy?",
                "¡Buenas! Justo estaba pensando en ti 😉"
            ];
            return responses[Math.floor(Math.random() * responses.length)];
        }

        function generateGenericResponse() {
            const responses = [
                "Me gusta mucho hablar contigo, tienes algo especial",
                "Eres muy interesante, me encanta conocerte mejor",
                "Tienes una personalidad que me atrae mucho",
                "Me fascina tu forma de ser, eres único"
            ];
            return responses[Math.floor(Math.random() * responses.length)];
        }

        // Función principal para respuesta contextual (corregida con modalidad extrema)
        function generateContextualResponse() {
            const userMessage = document.getElementById('userMessage').value.trim();
            const responseType = document.getElementById('responseType').value;

            if (!userMessage) {
                alert('Por favor pega el mensaje del usuario');
                return;
            }

            let response = '';
            
            // Si está en MODO EXTREMO, generar respuestas atrevidas
            if (isExtremeMode) {
                const analysis = analyzeUserMessageAdvanced(userMessage);
                response = generateExtremeResponse(userMessage, analysis);
                contextualResponse = response;
                displayExtremeResponse('contextualResponse', response);
                return;
            }

            // MODERACIÓN NORMAL: Solo si no está en modo extremo
            const moderationResult = moderateContent(userMessage);
            trackUserBehavior(moderationResult);

            if (!moderationResult.isAppropriate) {
                if (userBehaviorTracker.consecutiveWarnings >= 3) {
                    response = generateEscalatedResponse();
                } else {
                    response = moderationResult.response;
                }
                
                contextualResponse = response;
                displayModerationResponse('contextualResponse', response, moderationResult);
                return;
            }

            // Análisis normal para contenido apropiado
            const analysis = analyzeUserMessageAdvanced(userMessage);

            if (responseType === 'auto') {
                if (analysis.intent === 'greeting') {
                    response = generateGreetingResponse();
                } else if (analysis.intent === 'compliment') {
                    response = generateComplimentResponse();
                } else if (analysis.intent === 'question') {
                    response = generateQuestionResponse();
                } else if (analysis.intent === 'request') {
                    response = generateRequestResponse();
                } else if (analysis.intent === 'humor') {
                    response = generateJokeResponse();
                } else if (analysis.intent === 'gratitude') {
                    response = generateThanksResponse();
                } else {
                    response = generateGenericResponse();
                }
            } else {
                switch(responseType) {
                    case 'compliment': response = generateComplimentResponse(); break;
                    case 'question': response = generateQuestionResponse(); break;
                    case 'request': response = generateRequestResponse(); break;
                    case 'joke': response = generateJokeResponse(); break;
                    case 'flirt': response = generateFlirtResponse(); break;
                    case 'thanks': response = generateThanksResponse(); break;
                    default: response = generateGenericResponse(); break;
                }
            }

            contextualResponse = response;
            displayResponseWithRating('contextualResponse', response, 'contextual');
        }

        // Función para mostrar respuestas extremas
        function displayExtremeResponse(elementId, response) {
            const element = document.getElementById(elementId);
            if (!element) return;
            
            element.innerHTML = 
                '<div style="background: linear-gradient(135deg, #e74c3c, #c0392b); border-radius: 10px; padding: 20px; border-left: 4px solid #fff;">' +
                    '<div style="display: flex; align-items: center; margin-bottom: 10px;">' +
                        '<span style="background: #fff; color: #e74c3c; padding: 4px 8px; border-radius: 12px; font-size: 11px; margin-right: 10px; font-weight: bold;">🔥 EXTREMO</span>' +
                        '<span style="font-size: 12px; opacity: 0.9;">Modo súper atrevido activado</span>' +
                    '</div>' +
                    '<div class="response-text" style="font-size: 16px; font-weight: 500; color: #fff;">' + response + '</div>' +
                '</div>' +
                '<div style="display: flex; gap: 10px; margin-top: 15px; align-items: center;">' +
                    '<span style="font-size: 12px; opacity: 0.8;">¿Te gustó esta respuesta extrema?</span>' +
                    '<button onclick="rateExtremeResponse(\'like\')" ' +
                            'style="background: #e74c3c; border: none; color: white; padding: 5px 10px; border-radius: 15px; cursor: pointer; font-size: 12px;">' +
                        '🔥 Me encanta' +
                    '</button>' +
                    '<button onclick="rateExtremeResponse(\'dislike\')" ' +
                            'style="background: #95a5a6; border: none; color: white; padding: 5px 10px; border-radius: 15px; cursor: pointer; font-size: 12px;">' +
                        '😅 Muy fuerte' +
                    '</button>' +
                '</div>';
        }

        // Función para alternar modalidad extrema
        function toggleExtremeMode() {
            isExtremeMode = !isExtremeMode;
            const button = document.querySelector('.extreme-toggle');
            const indicator = document.querySelector('.mode-indicator');
            
            if (isExtremeMode) {
                button.style.background = 'linear-gradient(45deg, #e74c3c, #c0392b)';
                button.innerHTML = '🔥 MODO EXTREMO ON';
                if (indicator) {
                    indicator.innerHTML = '<span style="color: #e74c3c; font-weight: bold;">🔥 MODO EXTREMO ACTIVADO</span>';
                }
                alert('🔥 MODO EXTREMO ACTIVADO - Respuestas súper atrevidas y provocativas');
            } else {
                button.style.background = 'linear-gradient(45deg, #95a5a6, #7f8c8d)';
                button.innerHTML = '🔥 Modo Extremo';
                if (indicator) {
                    indicator.innerHTML = '<span style="color: #27ae60;">✓ Modo Normal</span>';
                }
                alert('✓ Modo normal activado - Respuestas elegantes y profesionales');
            }
        }

        // Función para solo verificar moderación sin generar respuesta (corregida)
        function checkModerationOnly() {
            const userMessage = document.getElementById('userMessage').value.trim();
            
            if (!userMessage) {
                alert('Por favor pega el mensaje del usuario para moderar');
                return;
            }

            const moderationResult = moderateContent(userMessage);
            const element = document.getElementById('contextualResponse');
            
            if (moderationResult.isAppropriate) {
                element.innerHTML = 
                    '<div style="background: rgba(46, 204, 113, 0.1); border-left: 4px solid #27ae60; padding: 15px; border-radius: 8px;">' +
                        '<div style="display: flex; align-items: center; margin-bottom: 10px;">' +
                            '<span style="background: #27ae60; color: white; padding: 4px 8px; border-radius: 12px; font-size: 11px; margin-right: 10px;">✓ APROPIADO</span>' +
                            '<span style="font-size: 12px; opacity: 0.8;">El mensaje es apropiado para responder</span>' +
                        '</div>' +
                        '<div style="font-size: 14px;">Puedes responder normalmente a este mensaje. No se detectó contenido inapropiado.</div>' +
                    '</div>';
            } else {
                const severityColors = {
                    mild: '#f39c12',
                    moderate: '#e67e22', 
                    severe: '#e74c3c',
                    harassment: '#c0392b',
                    explicit: '#8e44ad'
                };
                
                const severityNames = {
                    mild: 'Leve',
                    moderate: 'Moderado',
                    severe: 'Severo',
                    harassment: 'Acoso',
                    explicit: 'Explícito'
                };
                
                const severityColor = severityColors[moderationResult.severity] || '#95a5a6';
                const severityName = severityNames[moderationResult.severity] || 'Problemático';
                
                element.innerHTML = 
                    '<div style="background: rgba(231, 76, 60, 0.1); border-left: 4px solid ' + severityColor + '; padding: 15px; border-radius: 8px;">' +
                        '<div style="display: flex; align-items: center; margin-bottom: 10px;">' +
                            '<span style="background: ' + severityColor + '; color: white; padding: 4px 8px; border-radius: 12px; font-size: 11px; margin-right: 10px;">⚠ ' + severityName.toUpperCase() + '</span>' +
                            '<span style="font-size: 12px; opacity: 0.8;">Contenido detectado como inapropiado</span>' +
                        '</div>' +
                        '<div style="font-size: 14px; margin-bottom: 10px;"><strong>Respuesta sugerida:</strong></div>' +
                        '<div style="font-style: italic; background: rgba(0,0,0,0.1); padding: 10px; border-radius: 6px;">' +
                            moderationResult.response +
                        '</div>' +
                        '<div style="margin-top: 10px; font-size: 12px; opacity: 0.7;">' +
                            'Tipo detectado: ' + moderationResult.type.replace('_', ' ') +
                        '</div>' +
                    '</div>';
            }
        }

        // Función para calificar las respuestas de moderación
        function rateModerationResponse(type, rating) {
            if (rating === 'helpful') {
                alert('Gracias por confirmar. Continuaré moderando apropiadamente 👍');
            } else {
                alert('Entendido. Ajustaré el nivel de moderación para ser más flexible 🤔');
            }
            saveData();
        }

        // Función para mostrar estadísticas de moderación (corregida)
        function showModerationStats() {
            const favoritesList = document.getElementById('favoritesList');
            const totalWarnings = userBehaviorTracker.warningsCount;
            const inappropriateCount = userBehaviorTracker.inappropriateMessages;
            const consecutiveWarnings = userBehaviorTracker.consecutiveWarnings;
            
            favoritesList.innerHTML = 
                '<div style="background: rgba(156, 39, 176, 0.2); padding: 20px; border-radius: 10px; border-left: 4px solid #9c27b0;">' +
                    '<h3 style="margin-bottom: 15px;">🛡️ Estadísticas de Moderación</h3>' +
                    '<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 20px;">' +
                        '<div style="background: rgba(255, 193, 7, 0.3); padding: 15px; border-radius: 8px; text-align: center;">' +
                            '<div style="font-size: 24px; font-weight: bold;">' + totalWarnings + '</div>' +
                            '<div style="font-size: 12px;">⚠️ Total de advertencias</div>' +
                        '</div>' +
                        '<div style="background: rgba(244, 67, 54, 0.3); padding: 15px; border-radius: 8px; text-align: center;">' +
                            '<div style="font-size: 24px; font-weight: bold;">' + inappropriateCount + '</div>' +
                            '<div style="font-size: 12px;">🚫 Mensajes inapropiados</div>' +
                        '</div>' +
                        '<div style="background: rgba(156, 39, 176, 0.3); padding: 15px; border-radius: 8px; text-align: center;">' +
                            '<div style="font-size: 24px; font-weight: bold;">' + consecutiveWarnings + '</div>' +
                            '<div style="font-size: 12px;">🔄 Advertencias consecutivas</div>' +
                        '</div>' +
                        '<div style="background: rgba(76, 175, 80, 0.3); padding: 15px; border-radius: 8px; text-align: center;">' +
                            '<div style="font-size: 24px; font-weight: bold;">' + (consecutiveWarnings < 2 ? 'BIEN' : 'ALERTA') + '</div>' +
                            '<div style="font-size: 12px;">📊 Estado del usuario</div>' +
                        '</div>' +
                    '</div>' +
                    '<div style="margin-top: 20px;">' +
                        '<h4>🎯 Recomendaciones de Moderación:</h4>' +
                        '<div style="margin-top: 10px;">' +
                            (consecutiveWarnings === 0 ? 
                                '<span style="color: #4caf50;">✓ Usuario se comporta apropiadamente</span>' :
                                consecutiveWarnings < 3 ?
                                '<span style="color: #ff9800;">⚠ Mantener vigilancia moderada</span>' :
                                '<span style="color: #f44336;">🚨 Considerar escalación o pausa</span>') +
                        '</div>' +
                        '<div style="margin-top: 15px; padding: 10px; background: rgba(0,0,0,0.1); border-radius: 6px;">' +
                            '<strong>Modo actual:</strong> ' + (isExtremeMode ? '<span style="color: #e74c3c;">🔥 EXTREMO ACTIVADO</span>' : '<span style="color: #27ae60;">✓ Normal</span>') +
                        '</div>' +
                    '</div>' +
                '</div>';
        }

        // Función especial para mostrar respuestas de moderación
        function displayModerationResponse(elementId, response, moderationResult) {
            const element = document.getElementById(elementId);
            if (!element) return;
            
            const severityColors = {
                mild: '#f39c12',
                moderate: '#e67e22', 
                severe: '#e74c3c',
                harassment: '#c0392b',
                explicit: '#8e44ad'
            };
            
            const severityColor = severityColors[moderationResult.severity] || '#95a5a6';
            
            element.innerHTML = 
                '<div style="background: rgba(230, 126, 34, 0.1); border-left: 4px solid ' + severityColor + '; padding: 15px; border-radius: 8px; margin-bottom: 10px;">' +
                    '<div style="display: flex; align-items: center; margin-bottom: 10px;">' +
                        '<span style="background: ' + severityColor + '; color: white; padding: 4px 8px; border-radius: 12px; font-size: 11px; margin-right: 10px;">MODERADO</span>' +
                        '<span style="font-size: 12px; opacity: 0.8;">Respuesta automática por contenido inapropiado</span>' +
                    '</div>' +
                    '<div class="response-text" style="font-style: normal;">' + response + '</div>' +
                '</div>' +
                '<div style="display: flex; gap: 10px; margin-top: 15px; align-items: center;">' +
                    '<span style="font-size: 12px; opacity: 0.8;">¿Fue apropiada esta moderación?</span>' +
                    '<button onclick="rateModerationResponse(\'' + moderationResult.type + '\', \'helpful\')" ' +
                            'style="background: #27ae60; border: none; color: white; padding: 5px 10px; border-radius: 15px; cursor: pointer; font-size: 12px;">' +
                        '✓ Apropiada' +
                    '</button>' +
                    '<button onclick="rateModerationResponse(\'' + moderationResult.type + '\', \'too_strict\')" ' +
                            'style="background: #f39c12; border: none; color: white; padding: 5px 10px; border-radius: 15px; cursor: pointer; font-size: 12px;">' +
                        '⚠ Muy estricta' +
                    '</button>' +
                '</div>';
        }

        // Función para calificar las respuestas de moderación
        function rateModerationResponse(type, rating) {
            if (rating === 'helpful') {
                alert('Gracias por confirmar. Continuaré moderando apropiadamente 👍');
            } else {
                alert('Entendido. Ajustaré el nivel de moderación para ser más flexible 🤔');
            }
            
            // Aquí se podría ajustar la sensibilidad del sistema basado en feedback
            saveData();
        }

        // Función para mostrar estadísticas de moderación
        function showModerationStats() {
            const favoritesList = document.getElementById('favoritesList');
            const totalWarnings = userBehaviorTracker.warningsCount;
            const inappropriateCount = userBehaviorTracker.inappropriateMessages;
            const consecutiveWarnings = userBehaviorTracker.consecutiveWarnings;
            
            favoritesList.innerHTML = 
                '<div style="background: rgba(156, 39, 176, 0.2); padding: 20px; border-radius: 10px; border-left: 4px solid #9c27b0;">' +
                    '<h3 style="margin-bottom: 15px;">🛡️ Estadísticas de Moderación</h3>' +
                    '<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 20px;">' +
                        '<div style="background: rgba(255, 193, 7, 0.3); padding: 15px; border-radius: 8px; text-align: center;">' +
                            '<div style="font-size: 24px; font-weight: bold;">' + totalWarnings + '</div>' +
                            '<div style="font-size: 12px;">⚠️ Total de advertencias</div>' +
                        '</div>' +
                        '<div style="background: rgba(244, 67, 54, 0.3); padding: 15px; border-radius: 8px; text-align: center;">' +
                            '<div style="font-size: 24px; font-weight: bold;">' + inappropriateCount + '</div>' +
                            '<div style="font-size: 12px;">🚫 Mensajes inapropiados</div>' +
                        '</div>' +
                        '<div style="background: rgba(156, 39, 176, 0.3); padding: 15px; border-radius: 8px; text-align: center;">' +
                            '<div style="font-size: 24px; font-weight: bold;">' + consecutiveWarnings + '</div>' +
                            '<div style="font-size: 12px;">🔄 Advertencias consecutivas</div>' +
                        '</div>' +
                        '<div style="background: rgba(76, 175, 80, 0.3); padding: 15px; border-radius: 8px; text-align: center;">' +
                            '<div style="font-size: 24px; font-weight: bold;">' + (consecutiveWarnings < 2 ? 'BIEN' : 'ALERTA') + '</div>' +
                            '<div style="font-size: 12px;">📊 Estado del usuario</div>' +
                        '</div>' +
                    '</div>' +
                    '<div style="margin-top: 20px;">' +
                        '<h4>🎯 Recomendaciones de Moderación:</h4>' +
                        '<div style="margin-top: 10px;">' +
                            (consecutiveWarnings === 0 ? 
                                '<span style="color: #4caf50;">✓ Usuario se comporta apropiadamente</span>' :
                                consecutiveWarnings < 3 ?
                                '<span style="color: #ff9800;">⚠ Mantener vigilancia moderada</span>' :
                                '<span style="color: #f44336;">🚨 Considerar escalación o pausa</span>') +
                        '</div>' +
                    '</div>' +
                '</div>';
        }};
                
        // Función para solo verificar moderación sin generar respuesta
        function checkModerationOnly() {
            const userMessage = document.getElementById('userMessage').value.trim();
            
            if (!userMessage) {
                alert('Por favor pega el mensaje del usuario para moderar');
                return;
            }

            const moderationResult = moderateContent(userMessage);
            const element = document.getElementById('contextualResponse');
            
            if (moderationResult.isAppropriate) {
                element.innerHTML = 
                    '<div style="background: rgba(46, 204, 113, 0.1); border-left: 4px solid #27ae60; padding: 15px; border-radius: 8px;">' +
                        '<div style="display: flex; align-items: center; margin-bottom: 10px;">' +
                            '<span style="background: #27ae60; color: white; padding: 4px 8px; border-radius: 12px; font-size: 11px; margin-right: 10px;">✓ APROPIADO</span>' +
                            '<span style="font-size: 12px; opacity: 0.8;">El mensaje es apropiado para responder</span>' +
                        '</div>' +
                        '<div style="font-size: 14px;">Puedes responder normalmente a este mensaje. No se detectó contenido inapropiado.</div>' +
                    '</div>';
            } else {
                const severityColors = {
                    mild: '#f39c12',
                    moderate: '#e67e22', 
                    severe: '#e74c3c',
                    harassment: '#c0392b',
                    explicit: '#8e44ad'
                };
                
                const severityNames = {
                    mild: 'Leve',
                    moderate: 'Moderado',
                    severe: 'Severo',
                    harassment: 'Acoso',
                    explicit: 'Explícito'
                };
                
                const severityColor = severityColors[moderationResult.severity] || '#95a5a6';
                const severityName = severityNames[moderationResult.severity] || 'Problemático';
                
                element.innerHTML = 
                    '<div style="background: rgba(231, 76, 60, 0.1); border-left: 4px solid ' + severityColor + '; padding: 15px; border-radius: 8px;">' +
                        '<div style="display: flex; align-items: center; margin-bottom: 10px;">' +
                            '<span style="background: ' + severityColor + '; color: white; padding: 4px 8px; border-radius: 12px; font-size: 11px; margin-right: 10px;">⚠ ' + severityName.toUpperCase() + '</span>' +
                            '<span style="font-size: 12px; opacity: 0.8;">Contenido detectado como inapropiado</span>' +
                        '</div>' +
                        '<div style="font-size: 14px; margin-bottom: 10px;"><strong>Respuesta sugerida:</strong></div>' +
                        '<div style="font-style: italic; background: rgba(0,0,0,0.1); padding: 10px; border-radius: 6px;">' +
                            moderationResult.response +
                        '</div>' +
                        '<div style="margin-top: 10px; font-size: 12px; opacity: 0.7;">' +
                            'Tipo detectado: ' + moderationResult.type.replace('_', ' ') +
                        '</div>' +
                    '</div>';
            }
        }

        // Función para mostrar respuesta con rating
        function displayResponseWithRating(elementId, response, type) {
            const element = document.getElementById(elementId);
            if (!element) return;
            
            const safeResponse = response.replace(/'/g, "&#39;").replace(/"/g, "&quot;");
            const safeType = type.replace(/'/g, "&#39;").replace(/"/g, "&quot;");
            
            element.innerHTML = 
                '<div class="response-text">' + response + '</div>' +
                '<div style="display: flex; gap: 10px; margin-top: 15px; align-items: center;">' +
                    '<span style="font-size: 12px; opacity: 0.8;">¿Te gustó esta respuesta?</span>' +
                    '<button onclick="rateResponse(\'' + safeResponse + '\', \'' + safeType + '\', \'like\')" ' +
                            'style="background: #2ecc71; border: none; color: white; padding: 5px 10px; border-radius: 15px; cursor: pointer; font-size: 12px;">' +
                        '👍 Me gusta' +
                    '</button>' +
                    '<button onclick="rateResponse(\'' + safeResponse + '\', \'' + safeType + '\', \'dislike\')" ' +
                            'style="background: #e74c3c; border: none; color: white; padding: 5px 10px; border-radius: 15px; cursor: pointer; font-size: 12px;">' +
                        '👎 No me gusta' +
                    '</button>' +
                '</div>';
        }

        // Función para calificar respuesta
        function rateResponse(response, type, rating) {
            const cleanResponse = response.replace(/&#39;/g, "'").replace(/&quot;/g, '"');
            const key = cleanResponse.substring(0, 50);

            if (!responseRatings[key]) {
                responseRatings[key] = { likes: 0, dislikes: 0, type: type, fullText: cleanResponse };
            }

            if (rating === 'like') {
                responseRatings[key].likes++;
                alert('¡Gracias! Tomaré en cuenta que te gustó esta respuesta 😊');
            } else {
                responseRatings[key].dislikes++;
                alert('Entendido, buscaré respuestas mejores la próxima vez 🤔');
            }

            saveData();
        }

        // Función para traducir
        function translateResponse(elementId) {
            const element = document.getElementById(elementId);
            if (!element) return;
            
            const responseDiv = element.querySelector('.response-text');

            if (!responseDiv) {
                alert('Primero genera una respuesta para traducir');
                return;
            }

            const text = responseDiv.textContent.trim();

            if (!text || text.includes('Haz clic') || text.includes('Configura') || text.includes('Pega el mensaje')) {
                alert('Primero genera una respuesta para traducir');
                return;
            }

            let translatedText = text;

            // Traducir frases completas
            const phraseTranslations = {
                'me gusta cómo': 'I like how',
                'me encanta cuando': 'I love when',
                'qué lindo eres': 'how sweet you are',
                'eres muy': 'you are very',
                'me haces': 'you make me',
                'de nada': 'you\'re welcome'
            };

            for (const [spanish, english] of Object.entries(phraseTranslations)) {
                const regex = new RegExp(spanish, 'gi');
                translatedText = translatedText.replace(regex, english);
            }

            // Traducir palabras individuales
            for (const [spanish, english] of Object.entries(translations)) {
                const regex = new RegExp('\\b' + spanish + '\\b', 'gi');
                translatedText = translatedText.replace(regex, english);
            }

            // Reglas gramaticales
            translatedText = translatedText
                .replace(/¿([^?]+)\?/g, '$1?')
                .replace(/¡([^!]+)!/g, '$1!')
                .replace(/\bI am\b/g, 'I\'m')
                .replace(/\byou are\b/g, 'you\'re')
                .trim();

            translatedText = translatedText.charAt(0).toUpperCase() + translatedText.slice(1);

            if (!translatedText.match(/[.!?]$/)) {
                translatedText += '.';
            }

            const safeText = text.replace(/'/g, "&#39;").replace(/"/g, "&quot;");
            const safeTranslation = translatedText.replace(/'/g, "&#39;").replace(/"/g, "&quot;");

            element.innerHTML = 
                '<div style="margin-bottom: 15px;">' +
                    '<div style="background: rgba(255,255,255,0.1); padding: 10px; border-radius: 8px; border-left: 3px solid #ff6b6b;">' +
                        '<strong>🇪🇸 Español:</strong><br>' +
                        text +
                    '</div>' +
                '</div>' +
                '<div style="background: rgba(46, 204, 113, 0.2); padding: 15px; border-radius: 8px; border-left: 3px solid #2ecc71;">' +
                    '<strong>🇺🇸 English:</strong><br>' +
                    '<span style="font-size: 16px; font-weight: 500;">' + translatedText + '</span>' +
                '</div>' +
                '<div style="display: flex; gap: 10px; margin-top: 15px;">' +
                    '<button onclick="restoreOriginal(\'' + elementId + '\', \'' + safeText + '\')" ' +
                            'style="padding: 8px 15px; font-size: 12px; background: linear-gradient(45deg, #95a5a6, #7f8c8d); border: none; color: white; border-radius: 20px; cursor: pointer;">' +
                        '🔄 Volver al original' +
                    '</button>' +
                    '<button onclick="copyToClipboard(\'' + safeTranslation + '\')" ' +
                            'style="padding: 8px 15px; font-size: 12px; background: linear-gradient(45deg, #3498db, #2980b9); border: none; color: white; border-radius: 20px; cursor: pointer;">' +
                        '📋 Copiar traducción' +
                    '</button>' +
                '</div>';
        }

        // Función para restaurar original
        function restoreOriginal(elementId, originalText) {
            const element = document.getElementById(elementId);
            const cleanText = originalText.replace(/&#39;/g, "'").replace(/&quot;/g, '"');
            element.innerHTML = `<div class="response-text">${cleanText}</div>`;
        }

        // Función para copiar al portapapeles
        function copyToClipboard(translatedText) {
            const cleanText = translatedText.replace(/&#39;/g, "'").replace(/&quot;/g, '"');
            navigator.clipboard.writeText(cleanText).then(() => {
                alert('¡Traducción copiada al portapapeles!');
            }).catch(() => {
                const textArea = document.createElement('textarea');
                textArea.value = cleanText;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                alert('¡Traducción copiada al portapapeles!');
            });
        }

        // Funciones para favoritos
        function saveToFavorites() {
            if (!currentResponse) {
                alert('Primero genera una respuesta para guardar');
                return;
            }
            if (favorites.includes(currentResponse)) {
                alert('Esta respuesta ya está en tus favoritos');
                return;
            }
            favorites.push(currentResponse);
            saveData();
            updateFavoritesList();
            alert('¡Respuesta guardada en favoritos!');
        }

        function saveCustomToFavorites() {
            if (!customResponse) {
                alert('Primero genera una respuesta personalizada');
                return;
            }
            if (favorites.includes(customResponse)) {
                alert('Esta respuesta ya está en favoritos');
                return;
            }
            favorites.push(customResponse);
            saveData();
            updateFavoritesList();
            alert('¡Respuesta guardada!');
        }

        function saveContextualToFavorites() {
            if (!contextualResponse) {
                alert('Primero genera una respuesta contextual');
                return;
            }
            if (favorites.includes(contextualResponse)) {
                alert('Esta respuesta ya está en favoritos');
                return;
            }
            favorites.push(contextualResponse);
            saveData();
            updateFavoritesList();
            alert('¡Respuesta guardada!');
        }

        function deleteFavorite(index) {
            if (index >= 0 && index < favorites.length) {
                favorites.splice(index, 1);
                saveData();
                updateFavoritesList();
            }
        }

        function showFavorites() {
            const favoritesList = document.getElementById('favoritesList');
            if (favorites.length === 0) {
                favoritesList.innerHTML = '<p style="text-align: center; opacity: 0.6;">No tienes respuestas favoritas aún</p>';
            } else {
                const favoritesHTML = favorites.map(function(fav, index) {
                    return '<div class="favorite-item">' +
                           '<button class="delete-btn" onclick="deleteFavorite(' + index + ')">×</button>' +
                           fav +
                           '</div>';
                }).join('');
                favoritesList.innerHTML = favoritesHTML;
            }
        }

        function showStats() {
            const favoritesList = document.getElementById('favoritesList');
            const totalRatings = Object.keys(responseRatings).length;
            const totalLikes = Object.values(responseRatings).reduce(function(sum, rating) { 
                return sum + rating.likes; 
            }, 0);
            const totalDislikes = Object.values(responseRatings).reduce(function(sum, rating) { 
                return sum + rating.dislikes; 
            }, 0);
            const totalPatterns = Object.keys(userPatterns).length;

            const sortedPatterns = Object.entries(userPatterns)
                .sort(function(a, b) { return b[1] - a[1]; })
                .slice(0, 10);

            const patternHTML = sortedPatterns.map(function(item) {
                return '<span style="background: rgba(255,255,255,0.2); padding: 5px 10px; border-radius: 15px; font-size: 12px;">' +
                       item[0] + ' (' + item[1] + ')' +
                       '</span>';
            }).join('');

            favoritesList.innerHTML = 
                '<div style="background: rgba(155, 89, 182, 0.2); padding: 20px; border-radius: 10px; border-left: 4px solid #9b59b6;">' +
                    '<h3 style="margin-bottom: 15px;">📊 Estadísticas de Aprendizaje</h3>' +
                    '<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">' +
                        '<div style="background: rgba(46, 204, 113, 0.3); padding: 15px; border-radius: 8px; text-align: center;">' +
                            '<div style="font-size: 24px; font-weight: bold;">' + totalLikes + '</div>' +
                            '<div style="font-size: 12px;">👍 Respuestas que gustaron</div>' +
                        '</div>' +
                        '<div style="background: rgba(231, 76, 60, 0.3); padding: 15px; border-radius: 8px; text-align: center;">' +
                            '<div style="font-size: 24px; font-weight: bold;">' + totalDislikes + '</div>' +
                            '<div style="font-size: 12px;">👎 Respuestas a mejorar</div>' +
                        '</div>' +
                        '<div style="background: rgba(52, 152, 219, 0.3); padding: 15px; border-radius: 8px; text-align: center;">' +
                            '<div style="font-size: 24px; font-weight: bold;">' + totalPatterns + '</div>' +
                            '<div style="font-size: 12px;">🔤 Palabras aprendidas</div>' +
                        '</div>' +
                        '<div style="background: rgba(241, 196, 15, 0.3); padding: 15px; border-radius: 8px; text-align: center;">' +
                            '<div style="font-size: 24px; font-weight: bold;">' + Math.round((totalLikes / (totalLikes + totalDislikes || 1)) * 100) + '%</div>' +
                            '<div style="font-size: 12px;">📈 Tasa de éxito</div>' +
                        '</div>' +
                    '</div>' +
                    '<div style="margin-top: 20px;">' +
                        '<h4>🔥 Palabras más usadas por usuarios:</h4>' +
                        '<div style="display: flex; flex-wrap: wrap; gap: 8px; margin-top: 10px;">' +
                            patternHTML +
                        '</div>' +
                    '</div>' +
                '</div>';
        }

        function exportData() {
            const data = {
                favorites: favorites,
                ratings: responseRatings,
                patterns: userPatterns,
                exportDate: new Date().toISOString()
            };

            const jsonData = JSON.stringify(data, null, 2);
            const blob = new Blob([jsonData], { type: 'application/json' });
            const url = URL.createObjectURL(blob);

            const a = document.createElement('a');
            a.href = url;
            a.download = `respuestas_datos_${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);

            alert('📁 Datos exportados exitosamente');
        }

        function updateFavoritesList() {
            showFavorites();
            const favCount = document.getElementById('favCount');
            if (favCount) {
                favCount.textContent = favorites.length;
            }
        }

        function initializeEventListeners() {
            const intensitySlider = document.getElementById('intensityLevel');
            if (intensitySlider) {
                intensitySlider.addEventListener('input', function() {
                    const intensityValue = document.getElementById('intensityValue');
                    if (intensityValue) {
                        intensityValue.textContent = this.value;
                    }
                });
            }

            const customKeyword = document.getElementById('customKeyword');
            if (customKeyword) {
                customKeyword.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        generateAdvancedCustom();
                    }
                });
            }

            const userMessage = document.getElementById('userMessage');
            if (userMessage) {
                userMessage.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter' && e.ctrlKey) {
                        generateContextualResponse();
                    }
                });
            }
        }

        function initializeApp() {
            loadData();
            updateFavoritesList();
            initializeEventListeners();
        }

        // Inicializar cuando el DOM esté listo
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initializeApp);
        } else {
            setTimeout(initializeApp, 100);
        }
    </script>                userPatterns[cleanWord]++;
            });
            saveData(); // Usar función segura
        }

        function displayResponseWithRating(elementId, response, type) {
            const element = document.getElementById(elementId);
            const safeResponse = response.replace(/'/g, "&#39;").replace(/"/g, "&quot;");
            element.innerHTML = `
                <div class="response-text<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generador de Respuestas Creativas</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .main-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
        }

        .card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 25px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .card h2 {
            margin-bottom: 20px;
            color: #fff;
            font-size: 1.5em;
        }

        .category-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .btn {
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
            border: none;
            color: white;
            padding: 12px 20px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
            background: linear-gradient(45deg, #ee5a24, #ff6b6b);
        }

        .btn.secondary {
            background: linear-gradient(45deg, #5f27cd, #341f97);
        }

        .btn.secondary:hover {
            background: linear-gradient(45deg, #341f97, #5f27cd);
        }

        .response-area {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
            padding: 20px;
            min-height: 150px;
            margin-top: 20px;
            border-left: 4px solid #ff6b6b;
        }

        .response-text {
            font-size: 16px;
            line-height: 1.6;
            font-style: italic;
        }

        .input-section {
            margin-bottom: 20px;
        }

        .input-section input, .input-section select, .input-section textarea {
            width: 100%;
            padding: 12px;
            border-radius: 8px;
            border: none;
            background: rgba(255, 255, 255, 0.9);
            color: #333;
            font-size: 16px;
            margin-bottom: 10px;
        }

        .input-section input::placeholder, .input-section textarea::placeholder {
            color: #666;
        }

        .favorites {
            grid-column: 1 / -1;
        }

        .favorites-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .favorite-item {
            background: rgba(0, 0, 0, 0.2);
            padding: 15px;
            border-radius: 8px;
            border-left: 3px solid #ff6b6b;
            position: relative;
        }

        .delete-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #e74c3c;
            border: none;
            color: white;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 12px;
        }

        .stats {
            text-align: center;
            margin-top: 20px;
            font-size: 14px;
            opacity: 0.8;
        }

        @media (max-width: 768px) {
            .main-grid {
                grid-template-columns: 1fr;
            }
            
            .category-buttons {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 2em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>✨ Generador de Respuestas Creativas ✨</h1>
            <p>Herramienta profesional para respuestas inteligentes y atractivas</p>
        </div>

        <div class="main-content">
            <div class="main-grid">
                <div class="card">
                    <h2>🎯 Categorías de Respuestas</h2>
                    <div class="category-buttons">
                        <button class="btn" onclick="generateByCategory('coquetas')">Coquetas</button>
                        <button class="btn" onclick="generateByCategory('divertidas')">Divertidas</button>
                        <button class="btn" onclick="generateByCategory('misteriosas')">Misteriosas</button>
                        <button class="btn" onclick="generateByCategory('halagadoras')">Halagadoras</button>
                        <button class="btn" onclick="generateByCategory('juguetonas')">Juguetonas</button>
                        <button class="btn" onclick="generateByCategory('seductoras')">Seductoras</button>
                        <button class="btn" onclick="generateByCategory('dulces')" style="background: linear-gradient(45deg, #ff9ff3, #f368e0);">Dulces</button>
                        <button class="btn" onclick="generateByCategory('atrevidas')" style="background: linear-gradient(45deg, #ff3838, #ff6b35);">Atrevidas</button>
                        <button class="btn" onclick="generateByCategory('romanticas')" style="background: linear-gradient(45deg, #fa7cd2, #ff7675);">Románticas</button>
                    </div>
                    
                    <div class="response-area">
                        <div class="response-text" id="generatedResponse">
                            Haz clic en una categoría para generar una respuesta creativa...
                        </div>
                    </div>
                    
                    <div style="display: flex; gap: 10px; margin-top: 15px;">
                        <button class="btn secondary" onclick="saveToFavorites()" style="flex: 1;">
                            💖 Guardar en Favoritos
                        </button>
                        <button class="btn" onclick="translateResponse('generatedResponse')" style="flex: 1; background: linear-gradient(45deg, #2ecc71, #27ae60);">
                            🌐 Traducir al Inglés
                        </button>
                    </div>
                </div>

                <div class="card">
                    <h2>🎨 Generador Personalizado</h2>
                    <div class="input-section">
                        <input type="text" id="customKeyword" placeholder="Palabra clave o tema principal...">
                        <select id="responseStyle">
                            <option value="flirty">Coqueta y juguetona</option>
                            <option value="sweet">Dulce y halagadora</option>
                            <option value="mysterious">Misteriosa e intrigante</option>
                            <option value="funny">Divertida y graciosa</option>
                            <option value="seductive">Seductora y directa</option>
                            <option value="friendly">Amigable y cercana</option>
                        </select>
                        <input type="range" id="intensityLevel" min="1" max="5" value="3" style="width: 100%; margin-bottom: 10px;">
                        <label style="font-size: 12px; opacity: 0.8;">
                            Nivel de intensidad: <span id="intensityValue">3</span>/5
                            <span class="intensity-indicator" style="margin-left: 10px; font-size: 10px;"></span>
                        </label>
                        <button class="btn" onclick="generateAdvancedCustom()" style="width: 100%; margin-top: 10px;">
                            🎯 Generar Respuesta Avanzada
                        </button>
                    </div>

                    <div class="response-area">
                        <div class="response-text" id="customResponse">
                            Configura los parámetros y genera una respuesta personalizada...
                        </div>
                    </div>
                    
                    <div style="display: flex; gap: 10px; margin-top: 15px;">
                        <button class="btn secondary" onclick="saveCustomToFavorites()" style="flex: 1;">
                            💖 Guardar Favorito
                        </button>
                        <button class="btn" onclick="translateResponse('customResponse')" style="flex: 1; background: linear-gradient(45deg, #2ecc71, #27ae60);">
                            🌐 Traducir al Inglés
                        </button>
                    </div>
                </div>
            </div>

            <div class="card">
                <h2>💬 Responder a Usuario</h2>
                <div class="input-section">
                    <textarea id="userMessage" placeholder="Pega aquí el mensaje del usuario..." style="min-height: 80px; resize: vertical;"></textarea>
                    <select id="responseType">
                        <option value="auto">🤖 Respuesta Automática (AI)</option>
                        <option value="compliment">💕 Respuesta a Halago</option>
                        <option value="question">❓ Respuesta a Pregunta</option>
                        <option value="request">🙏 Respuesta a Solicitud</option>
                        <option value="joke">😂 Respuesta a Broma</option>
                        <option value="flirt">😘 Respuesta Coqueta</option>
                        <option value="thanks">🙏 Agradecimiento</option>
                    </select>
                    <div style="display: flex; gap: 10px; margin-bottom: 10px;">
                        <button class="btn" onclick="generateContextualResponse()" style="flex: 2;">
                            🎭 Generar Respuesta Contextual
                        </button>
                        <button class="btn" onclick="checkModerationOnly()" style="flex: 1; background: linear-gradient(45deg, #9b59b6, #8e44ad); font-size: 12px;">
                            🛡️ Solo Moderar
                        </button>
                    </div>
                    <div style="display: flex; gap: 10px; margin-bottom: 10px;">
                        <button class="btn extreme-toggle" onclick="toggleExtremeMode()" style="flex: 1; background: linear-gradient(45deg, #95a5a6, #7f8c8d); font-size: 12px;">
                            🔥 Modo Extremo
                        </button>
                        <div class="mode-indicator" style="flex: 1; display: flex; align-items: center; justify-content: center; font-size: 12px;">
                            <span style="color: #27ae60;">✓ Modo Normal</span>
                        </div>
                    </div>
                </div>

                <div class="response-area">
                    <div class="response-text" id="contextualResponse">
                        Pega el mensaje del usuario para generar una respuesta perfecta...
                    </div>
                </div>
                
                <div style="display: flex; gap: 10px; margin-top: 15px;">
                    <button class="btn secondary" onclick="saveContextualToFavorites()" style="flex: 1;">
                        💖 Guardar Favorito
                    </button>
                    <button class="btn" onclick="translateResponse('contextualResponse')" style="flex: 1; background: linear-gradient(45deg, #2ecc71, #27ae60);">
                        🌐 Traducir al Inglés
                    </button>
                </div>
            </div>
        </div>

        <div class="card favorites">
            <h2>⭐ Respuestas Favoritas</h2>
            <div style="display: flex; gap: 10px; margin-bottom: 15px;">
                <button class="btn secondary" onclick="showFavorites()" style="flex: 1; font-size: 12px;">
                    💖 Ver Favoritos
                </button>
                <button class="btn" onclick="showStats()" style="flex: 1; font-size: 12px; background: linear-gradient(45deg, #9b59b6, #8e44ad);">
                    📊 Estadísticas de Aprendizaje
                </button>
                <button class="btn" onclick="showModerationStats()" style="flex: 1; font-size: 12px; background: linear-gradient(45deg, #e91e63, #ad1457);">
                    🛡️ Moderación
                </button>
                <button class="btn" onclick="exportData()" style="flex: 1; font-size: 12px; background: linear-gradient(45deg, #f39c12, #e67e22);">
                    📤 Exportar
                </button>
            </div>
            <div class="favorites-list" id="favoritesList">
                <!-- Favoritos se cargarán aquí -->
            </div>
            <div class="stats">
                <p>Total de favoritos: <span id="favCount">0</span></p>
            </div>
        </div>
    </div>

    <script>
        // Variables globales (sin localStorage por restricciones del sandbox)
        let favorites = [];
        let currentResponse = '';
        let customResponse = '';
        let contextualResponse = '';
        let responseRatings = {};
        let userPatterns = {};

        // Función segura para manejar datos sin localStorage
        function saveData() {
            // En un entorno real, estos datos se guardarían en localStorage
            // Por ahora solo los mantenemos en memoria durante la sesión
            console.log('Datos guardados en memoria de sesión');
        }

        function loadData() {
            // Inicializar con datos por defecto
            favorites = [];
            responseRatings = {};
            userPatterns = {};
        }

        // Base de datos EXPANDIDA de respuestas
        const responses = {
            coquetas: [
                "¿Sabes qué? Creo que acabas de alegrarme el día con ese comentario 😊",
                "Mmm, me gusta cómo piensas... cuéntame más",
                "Tienes buen gusto, debo admitirlo 😉",
                "Eres todo un encanto, ¿lo sabías?",
                "Me haces sonreír sin poder evitarlo",
                "Vaya, vaya... alguien sabe cómo conquistar con palabras",
                "Creo que me estás robando el corazón poco a poco",
                "Ay, me haces sentir mariposas en el estómago 🦋",
                "Tienes una forma muy dulce de decir las cosas",
                "Me gusta cuando eres así de directo conmigo"
            ],
            divertidas: [
                "¡Ja! Definitivamente tienes sentido del humor, me caes bien",
                "¿En serio acabas de decir eso? Me has hecho reír en voz alta",
                "Eres más divertido de lo que esperaba... me gusta",
                "Ok, esa fue buena, te doy puntos por creatividad",
                "¿De dónde sacas estas ocurrencias? Me encanta tu mente",
                "Creo que acabas de ganar el premio al comentario más original del día",
                "Me haces reír tanto que casi se me cae el café",
                "¡Jajaja! Eres un caso perdido, pero me encantas así",
                "Tienes un humor tan particular, me divierte mucho"
            ],
            misteriosas: [
                "Hay algo en ti que me intriga... no logro descifrarte",
                "Mmm, interesante perspectiva... me haces pensar",
                "Tienes una forma muy particular de ver las cosas",
                "Hay más de lo que muestras, ¿verdad?",
                "Me pregunto qué otras sorpresas guardas",
                "Eres como un libro que apenas estoy empezando a leer",
                "Cada vez que hablas, descubro algo nuevo",
                "Me fascina la profundidad de tu mente"
            ],
            halagadoras: [
                "Wow, qué detallista eres... se nota que tienes clase",
                "Me encanta cómo me haces sentir especial",
                "Tienes un don para hacer que una chica se sienta única",
                "Eres increíblemente dulce, ¿sabes eso?",
                "Me fascina tu forma de expresarte",
                "Tienes una energía muy positiva, es contagiosa",
                "Eres el tipo de persona que ilumina el día de otros",
                "Tu forma de tratarme me hace sentir como una reina"
            ],
            juguetonas: [
                "¿A que no te atreves a decir eso otra vez? 😏",
                "Uy, alguien está siendo travieso hoy...",
                "Me gusta este juego, pero yo también sé jugar",
                "¿Eso es todo lo que tienes? Esperaba más de ti",
                "Creo que subestimas mi lado juguetón",
                "Cuidado, porque puedo ser más traviesa de lo que imaginas",
                "¿Jugamos? Pero te advierto que soy muy competitiva",
                "Me gusta cuando sacas tu lado atrevido"
            ],
            seductoras: [
                "Sabes exactamente qué decir para captar mi atención",
                "Me gusta cómo me miras... a través de la pantalla",
                "Tienes algo especial que me atrae",
                "Eres peligrosamente encantador",
                "Me haces sentir cosas que no esperaba",
                "Hay una química entre nosotros que no puedo negar",
                "Tienes una forma muy seductora de expresarte",
                "Me tienes completamente bajo tu hechizo"
            ],
            dulces: [
                "Eres tan tierno, me derrites el corazón 💕",
                "Tu dulzura me hace sonreír como tonta",
                "Me encantas cuando eres así de adorable",
                "Tienes el corazón más bonito que he conocido",
                "Eres como un rayito de sol en mi día",
                "Tu ternura me hace sentir protegida",
                "Me encanta lo cariñoso que eres"
            ],
            atrevidas: [
                "Mmm, me gusta tu lado atrevido 🔥",
                "¿Así que quieres jugar con fuego?",
                "Me encanta cuando sacas tu lado salvaje",
                "Tienes ideas muy interesantes... me intrigas",
                "Eres más atrevido de lo que pensé, me gusta",
                "¿Estás seguro de que puedes manejar a una chica como yo?",
                "Me gusta cuando eres así de directo"
            ],
            romanticas: [
                "Eres como un sueño hecho realidad",
                "Me haces creer en los cuentos de hadas",
                "Tienes algo mágico que me enamora",
                "Contigo el mundo se ve más bonito",
                "Eres mi lugar favorito en el universo",
                "Me haces sentir como en una película romántica",
                "Tu amor es como una melodía perfecta"
            ]
        };

        // Diccionario completo de traducciones
        const translations = {
            'hola': 'hello', 'amor': 'love', 'cariño': 'honey', 'corazón': 'heart',
            'hermosa': 'beautiful', 'bella': 'gorgeous', 'linda': 'pretty', 'sexy': 'sexy',
            'me gusta': 'I like', 'me encanta': 'I love', 'me fascina': 'I\'m fascinated',
            'gracias': 'thank you', 'de nada': 'you\'re welcome', 'feliz': 'happy',
            'contenta': 'happy', 'hoy': 'today', 'siempre': 'always', 'pero': 'but',
            'porque': 'because', 'muy': 'very', 'bueno': 'good', 'malo': 'bad',
            'sí': 'yes', 'no': 'no', 'qué': 'what', 'cómo': 'how', 'cuándo': 'when',
            'dónde': 'where', 'por qué': 'why', 'de': 'of', 'en': 'in', 'con': 'with',
            'la': 'the', 'el': 'the', 'y': 'and', 'o': 'or', 'que': 'that',
            'es': 'is', 'eres': 'you are', 'soy': 'I am', 'tienes': 'you have'
        };

        function generateByCategory(category) {
            const categoryResponses = responses[category];
            if (!categoryResponses) {
                alert('Categoría no encontrada');
                return;
            }
            const randomResponse = categoryResponses[Math.floor(Math.random() * categoryResponses.length)];
            currentResponse = randomResponse;
            displayResponseWithRating('generatedResponse', randomResponse, category);
        }

        // Base de datos inteligente de temas y contextos
        const themeDatabase = {
            // Temas románticos
            amor: ['amor', 'corazón', 'sentimientos', 'romance', 'pareja', 'cariño', 'ternura'],
            belleza: ['hermosa', 'bella', 'linda', 'preciosa', 'guapa', 'sexy', 'atractiva'],
            deseo: ['quiero', 'deseo', 'me gusta', 'necesito', 'anhelo', 'sueño'],
            
            // Temas sensuales
            pasion: ['pasión', 'fuego', 'intenso', 'ardiente', 'caliente', 'excitante'],
            seduccion: ['seducir', 'provocar', 'tentación', 'sensual', 'íntimo', 'privado'],
            
            // Temas emocionales
            felicidad: ['feliz', 'alegre', 'contento', 'sonrisa', 'risa', 'diversión', 'genial'],
            tristeza: ['triste', 'mal', 'deprimido', 'llorar', 'dolor', 'pena'],
            nervios: ['nervioso', 'ansioso', 'preocupado', 'estrés', 'tenso'],
            
            // Temas de tiempo
            dia: ['día', 'mañana', 'tarde', 'hoy', 'ahora', 'momento'],
            noche: ['noche', 'oscuridad', 'luna', 'estrellas', 'sueños'],
            
            // Temas de actividades
            trabajo: ['trabajo', 'oficina', 'jefe', 'reunión', 'proyecto', 'carrera'],
            diversion: ['diversión', 'juego', 'fiesta', 'música', 'baile', 'risa'],
            ejercicio: ['ejercicio', 'gym', 'deporte', 'correr', 'fitness', 'músculo'],
            
            // Temas íntimos
            cuerpo: ['cuerpo', 'piel', 'labios', 'ojos', 'sonrisa', 'cabello'],
            ropa: ['vestido', 'ropa', 'sexy', 'elegante', 'outfit', 'estilo']
        };

        function generateAdvancedCustom() {
            const keyword = document.getElementById('customKeyword').value.trim();
            const style = document.getElementById('responseStyle').value;
            const intensity = parseInt(document.getElementById('intensityLevel').value);
            
            if (!keyword) {
                alert('Por favor ingresa una palabra clave');
                return;
            }

            // Detectar el tema basado en la palabra clave
            const detectedTheme = detectTheme(keyword.toLowerCase());
            
            // Generar respuesta inteligente basada en tema + estilo + intensidad
            let response = generateIntelligentResponse(keyword, detectedTheme, style, intensity);
            
            customResponse = response;
            displayResponseWithRating('customResponse', response, 'custom');
        }

        function detectTheme(keyword) {
            for (const [theme, words] of Object.entries(themeDatabase)) {
                if (words.some(word => keyword.includes(word) || word.includes(keyword))) {
                    return theme;
                }
            }
            return 'general';
        }

        function generateIntelligentResponse(keyword, theme, style, intensity) {
            const responsePatterns = {
                flirty: {
                    amor: [
                        "El amor... qué tema tan profundo para una conversación 😏",
                        "Hablar de amor contigo se siente muy especial",
                        "Me gusta cuando tocas temas del corazón"
                    ],
                    belleza: [
                        "La belleza es algo que definitivamente sabes apreciar 😉",
                        "Me gusta que valores las cosas hermosas de la vida",
                        "Tienes muy buen ojo para la belleza"
                    ],
                    deseo: [
                        "Los deseos pueden ser muy poderosos... 😏",
                        "Me intriga saber qué es lo que realmente quieres",
                        "Tus deseos despiertan mi curiosidad"
                    ],
                    pasion: [
                        "La pasión es algo que me gusta mucho en una persona 🔥",
                        "Me encanta cuando alguien es apasionado",
                        "Tu lado apasionado me resulta muy atractivo"
                    ],
                    felicidad: [
                        "Tu alegría es tan contagiosa, me encanta 😊",
                        "Me gusta verte tan feliz, es hermoso",
                        "Tu sonrisa ilumina hasta aquí"
                    ],
                    general: [
                        "Me gusta cómo piensas sobre estos temas 😉",
                        "Tienes una perspectiva muy interesante",
                        "Me fascina tu forma de ver las cosas"
                    ]
                },
                sweet: {
                    amor: [
                        "El amor es lo más hermoso del mundo 💕",
                        "Qué lindo es hablar de amor contigo",
                        "Tu forma de expresar el amor me derrite"
                    ],
                    belleza: [
                        "La verdadera belleza viene del corazón, como la tuya",
                        "Eres tan dulce cuando hablas de belleza",
                        "Tu sensibilidad hacia lo bello me encanta"
                    ],
                    felicidad: [
                        "Tu felicidad me hace sonreír también 💕",
                        "Me encanta verte tan radiante",
                        "Tu alegría es como un rayo de sol"
                    ],
                    general: [
                        "Eres tan tierno cuando hablas de eso 💕",
                        "Me derrites con tu dulzura",
                        "Tu sensibilidad me enamora"
                    ]
                },
                seductive: {
                    pasion: [
                        "La pasión es algo que conozco muy bien... 🔥",
                        "Me gusta cuando sacas tu lado más intenso",
                        "Tu pasión despierta cosas en mí"
                    ],
                    deseo: [
                        "Los deseos están para cumplirse... 😈",
                        "Me intriga saber qué más deseas",
                        "Tus deseos me ponen a pensar cosas traviesas"
                    ],
                    seduccion: [
                        "La seducción es un arte que domino bien 😏",
                        "Me gusta tu lado seductor",
                        "Sabes cómo despertar mi lado más salvaje"
                    ],
                    noche: [
                        "Las noches son perfectas para cosas especiales 🌙",
                        "La oscuridad despierta mis instintos más profundos",
                        "Las noches contigo serían increíbles"
                    ],
                    general: [
                        "Sabes cómo encenderme con esas palabras 🔥",
                        "Me gusta tu lado más atrevido",
                        "Despiertas mi lado más salvaje"
                    ]
                },
                mysterious: {
                    amor: [
                        "El amor... un misterio que vale la pena explorar",
                        "Hay secretos del corazón que pocos entienden",
                        "El amor verdadero es más profundo de lo que parece"
                    ],
                    noche: [
                        "La noche guarda secretos fascinantes",
                        "Hay algo mágico en la oscuridad",
                        "Las noches revelan nuestra verdadera naturaleza"
                    ],
                    general: [
                        "Hay más detrás de esas palabras de lo que muestras",
                        "Me intriga la profundidad de tu mente",
                        "Guardas secretos interesantes"
                    ]
                },
                funny: {
                    trabajo: [
                        "¡El trabajo! La eterna lucha de la humanidad 😂",
                        "¿Trabajo? Prefiero pensar en diversión",
                        "El trabajo está sobrevalorado, mejor hablemos de nosotros"
                    ],
                    ejercicio: [
                        "¿Ejercicio? El único que hago es correr hacia la heladera 😂",
                        "Mi ejercicio favorito es hacer reír a gente como tú",
                        "¿Gimnasio? Prefiero ejercitar mi sentido del humor"
                    ],
                    general: [
                        "¡Jajaja! Siempre sabes cómo hacerme reír 😂",
                        "Tu sentido del humor es lo mejor",
                        "Me encanta cuando eres así de divertido"
                    ]
                },
                friendly: {
                    trabajo: [
                        "¡El trabajo puede ser genial cuando te gusta lo que haces!",
                        "Espero que tu trabajo te haga feliz",
                        "Es importante encontrar equilibrio entre trabajo y diversión"
                    ],
                    diversion: [
                        "¡Me encanta la diversión! La vida es para disfrutarla",
                        "Siempre es bueno tener tiempo para pasarla bien",
                        "La diversión sana es súper importante"
                    ],
                    general: [
                        "Me gusta mucho tu perspectiva sobre esto",
                        "Siempre es interesante hablar contigo",
                        "Tienes ideas muy buenas"
                    ]
                }
            };

            // Seleccionar patrón de respuesta
            const styleResponses = responsePatterns[style] || responsePatterns['friendly'];
            const themeResponses = styleResponses[theme] || styleResponses['general'];
            
            let baseResponse = themeResponses[Math.floor(Math.random() * themeResponses.length)];
            
            // Ajustar intensidad
            const intensityModifiers = {
                1: { emojis: ['😊', '🙂'], additions: [''] },
                2: { emojis: ['😊', '😉'], additions: [' Me gusta eso'] },
                3: { emojis: ['😉', '😏', '💕'], additions: [' Me fascinas', ' Eres genial'] },
                4: { emojis: ['😏', '🔥', '😘'], additions: [' Me tienes cautivada', ' Eres irresistible'] },
                5: { emojis: ['🔥', '💋', '🥵', '😈'], additions: [' Me vuelves loca', ' Eres peligrosamente atractivo'] }
            };
            
            const modifier = intensityModifiers[intensity];
            const emoji = modifier.emojis[Math.floor(Math.random() * modifier.emojis.length)];
            const addition = modifier.additions[Math.floor(Math.random() * modifier.additions.length)];
            
            // Combinar respuesta final
            let finalResponse = baseResponse + addition;
            if (emoji && !finalResponse.includes(emoji)) {
                finalResponse += ' ' + emoji;
            }
            
            return finalResponse;
        }

        function generateContextualResponse() {
            const userMessage = document.getElementById('userMessage').value.trim();
            const responseType = document.getElementById('responseType').value;
            
            if (!userMessage) {
                alert('Por favor pega el mensaje del usuario');
                return;
            }

            // Analizar el mensaje del usuario de forma más inteligente
            const analysis = analyzeUserMessageAdvanced(userMessage);
            let response = '';

            if (responseType === 'auto') {
                response = generateSmartContextualResponse(userMessage, analysis);
            } else {
                response = generateSpecificResponse(responseType, userMessage, analysis);
            }

            contextualResponse = response;
            displayResponseWithRating('contextualResponse', response, 'contextual');
        }

        function analyzeUserMessageAdvanced(message) {
            const lowerMessage = message.toLowerCase();
            
            // Análisis de sentimientos
            let sentiment = 'neutral';
            let emotionalIntensity = 1;
            
            if (lowerMessage.match(/(increíble|fantástico|genial|perfecto|hermoso|amo|adoro)/)) {
                sentiment = 'very_positive';
                emotionalIntensity = 5;
            } else if (lowerMessage.match(/(bueno|bien|me gusta|contento|feliz)/)) {
                sentiment = 'positive';
                emotionalIntensity = 3;
            } else if (lowerMessage.match(/(terrible|horrible|odio|mal|triste|deprimido)/)) {
                sentiment = 'negative';
                emotionalIntensity = 4;
            } else if (lowerMessage.match(/(nervioso|preocupado|ansioso|estresado)/)) {
                sentiment = 'anxious';
                emotionalIntensity = 3;
            }

            // Detectar intención
            let intent = 'chat';
            if (lowerMessage.includes('?')) intent = 'question';
            if (lowerMessage.match(/(quiero|necesito|puedes|podrías|me ayudas)/)) intent = 'request';
            if (lowerMessage.match(/(gracias|thank|agradezco)/)) intent = 'gratitude';
            if (lowerMessage.match(/(hola|hi|hey|buenas|saludos)/)) intent = 'greeting';
            if (lowerMessage.match(/(hermosa|bella|sexy|linda|preciosa|guapa)/)) intent = 'compliment';
            if (lowerMessage.match(/(ja|jaja|jeje|lol|😂|🤣|gracioso|divertido)/)) intent = 'humor';
            if (lowerMessage.match(/(amor|te amo|te quiero|besos|😘|💕|❤️)/)) intent = 'romantic';

            // Detectar temas
            const themes = [];
            for (const [theme, keywords] of Object.entries(themeDatabase)) {
                if (keywords.some(keyword => lowerMessage.includes(keyword))) {
                    themes.push(theme);
                }
            }

            // Detectar nivel de formalidad
            const formality = lowerMessage.match(/(por favor|disculpe|señorita|usted)/) ? 'formal' : 'informal';

            // Guardar patrones para aprendizaje
            analyzeUserMessage(message);

            return {
                sentiment,
                emotionalIntensity,
                intent,
                themes,
                formality,
                length: message.split(' ').length,
                hasEmojis: /[\u{1F600}-\u{1F64F}]|[\u{1F300}-\u{1F5FF}]|[\u{1F680}-\u{1F6FF}]|[\u{1F1E0}-\u{1F1FF}]|[\u{2600}-\u{26FF}]|[\u{2700}-\u{27BF}]/u.test(message)
            };
        }

        function generateSmartContextualResponse(message, analysis) {
            // Respuestas inteligentes basadas en análisis completo
            
            if (analysis.intent === 'greeting') {
                return generateGreetingResponse(analysis);
            } else if (analysis.intent === 'compliment') {
                return generateComplimentResponse(analysis);
            } else if (analysis.intent === 'question') {
                return generateQuestionResponse(analysis);
            } else if (analysis.intent === 'request') {
                return generateRequestResponse(analysis);
            } else if (analysis.intent === 'humor') {
                return generateJokeResponse(analysis);
            } else if (analysis.intent === 'romantic') {
                return generateRomanticResponse(analysis);
            } else if (analysis.intent === 'gratitude') {
                return generateThanksResponse(analysis);
            } else if (analysis.sentiment === 'negative') {
                return generateComfortResponse(analysis);
            } else {
                return generateGenericResponse(analysis);
            }
        }

        function generateSpecificResponse(type, message, analysis) {
            switch(type) {
                case 'compliment': return generateComplimentResponse(analysis);
                case 'question': return generateQuestionResponse(analysis);
                case 'request': return generateRequestResponse(analysis);
                case 'joke': return generateJokeResponse(analysis);
                case 'flirt': return generateFlirtResponse(analysis);
                case 'thanks': return generateThanksResponse(analysis);
                default: return generateGenericResponse(analysis);
            }
        }

        function generateGreetingResponse(analysis) {
            const responses = {
                formal: [
                    "¡Hola! Es un placer hablar contigo 😊",
                    "¡Buenas! Qué gusto verte por aquí",
                    "¡Hola! Siempre es agradable una buena conversación"
                ],
                informal: [
                    "¡Hey! Qué alegría verte 😊",
                    "¡Hola! Me alegras el día con tu saludo",
                    "¡Hola hermoso! ¿Cómo estás?",
                    "¡Buenas! Justo estaba pensando en ti 😉"
                ]
            };

            const responseSet = responses[(analysis && analysis.formality) || 'informal'];
            let response = responseSet[Math.floor(Math.random() * responseSet.length)];

            if (analysis && analysis.hasEmojis) {
                response += " Me encantan tus emojis";
            }

            return response;
        }
        function generateComplimentResponse(analysis) {
            const baseResponses = [
                "Aww, me haces sonrojar 😊",
                "Qué lindo eres, me alegras el día",
                "Eres un encanto, me haces sentir especial",
                "Me derrites el corazón cuando me dices esas cosas",
                "Tu dulzura es una de mis cosas favoritas de ti"
            ];

            let response = baseResponses[Math.floor(Math.random() * baseResponses.length)];

            if (analysis && analysis.emotionalIntensity >= 4) {
                response += " Tú también eres absolutamente increíble";
            } else {
                response += " Tú también eres muy dulce";
            }

            return response;
        }

        function generateQuestionResponse(analysis) {
            const responses = [
                "Qué pregunta tan interesante... me gusta cómo piensas",
                "Mmm, me haces reflexionar. ¿Tú qué opinas?",
                "Esa es una pregunta profunda, me intriga tu mente",
                "Me encanta cuando eres curioso, dime más",
                "Buena pregunta, me gusta conversar contigo"
            ];

            let response = responses[Math.floor(Math.random() * responses.length)];

            if (analysis && analysis.themes.includes('amor')) {
                response += " Especialmente cuando hablamos de temas del corazón";
            } else if (analysis && analysis.themes.includes('felicidad')) {
                response += " Me gusta tu perspectiva positiva";
            }

            return response;
        }

        function generateRequestResponse(analysis) {
            const responses = [
                "Me gusta cuando eres directo, veamos qué puedo hacer 😉",
                "Hmm, esa es una propuesta interesante...",
                "Me encanta tu iniciativa, eres muy decidido",
                "Vaya, vaya... alguien sabe lo que quiere",
                "Me gusta que seas claro con lo que deseas"
            ];

            let response = responses[Math.floor(Math.random() * responses.length)];

            if (analysis && analysis.formality === 'formal') {
                response = "Me gusta tu educación, veamos en qué puedo ayudarte";
            }

            return response;
        }

        function generateJokeResponse(analysis) {
            const responses = [
                "¡Jajaja! Me encanta tu sentido del humor 😂",
                "Eres tan divertido, me haces reír muchísimo",
                "¡Qué ocurrente! Me caes muy bien",
                "Tienes un humor genial, me alegras el día",
                "Me encanta reír contigo, eres fantástico"
            ];

            let response = responses[Math.floor(Math.random() * responses.length)];

            if (analysis && analysis.hasEmojis) {
                response += " Tus emojis hacen todo más divertido";
            }

            return response;
        }

        function generateRomanticResponse(analysis) {
            const responses = [
                "Ay, me haces sentir cosas muy bonitas 💕",
                "Tu lado romántico me tiene cautivada",
                "Me derrites con esas palabras de amor",
                "Eres tan tierno, me enamoras cada día más",
                "Tu amor se siente hasta aquí, es hermoso"
            ];

            return responses[Math.floor(Math.random() * responses.length)];
        }

        function generateFlirtResponse(analysis) {
            const responses = [
                "Mmm, me gusta cómo suena eso 😏",
                "Eres muy travieso, me intrigas",
                "Sabes exactamente qué decir para captar mi atención",
                "Me gusta tu estilo, eres muy seductor",
                "Tienes una forma muy atractiva de expresarte"
            ];

            let response = responses[Math.floor(Math.random() * responses.length)];

            if (analysis && analysis.emotionalIntensity >= 4) {
                response += " Me tienes completamente cautivada";
            }

            return response;
        }

        function generateThanksResponse(analysis) {
            const responses = [
                "De nada, amor. Me encanta hacerte feliz 💕",
                "Para ti, lo que sea. Eres muy especial",
                "No hay de qué, cariño. Es un placer",
                "Siempre estaré aquí para ti, lo sabes",
                "Me alegra poder ayudarte, eres increíble"
            ];

            return responses[Math.floor(Math.random() * responses.length)];
        }

        function generateComfortResponse(analysis) {
            const responses = [
                "Aww, siento que no te sientas bien. Estoy aquí para ti 💕",
                "¿Qué pasó, cariño? Cuéntame, quiero ayudarte",
                "No me gusta verte así. ¿En qué puedo ayudar?",
                "Ven acá, dame un abrazo virtual 🤗 Todo va a estar bien",
                "Estoy aquí contigo, no estás solo"
            ];

            return responses[Math.floor(Math.random() * responses.length)];
        }

        function generateGenericResponse(analysis) {
            const responses = [
                "Me gusta mucho hablar contigo, tienes algo especial",
                "Eres muy interesante, me encanta conocerte mejor",
                "Tienes una personalidad que me atrae mucho",
                "Me fascina tu forma de ser, eres único",
                "Cada vez que hablas, me dan ganas de saber más de ti"
            ];

            let response = responses[Math.floor(Math.random() * responses.length)];

            // Personalizar según temas detectados
            if (analysis && analysis.themes.includes('pasion')) {
                response += " Especialmente tu lado apasionado";
            } else if (analysis && analysis.themes.includes('felicidad')) {
                response += " Tu energía positiva es contagiosa";
            }

            return response;
        }

        function analyzeUserMessage(message) {
            const words = message.toLowerCase().split(/\s+/);
            words.forEach(word => {
                const cleanWord = word.replace(/[^\w\sáéíóúñü]/gi, '');
                if (cleanWord.length > 2) {
                    if (!userPatterns[cleanWord]) {
                        userPatterns[cleanWord] = 0;
                    }
                    userPatterns[cleanWord]++;
                }
            });
            saveData(); // Usar función segura
        }
                    userPatterns[cleanWord]++;
                }
            });
            localStorage.setItem('userPatterns', JSON.stringify(userPatterns));
        }

        function generateComplimentResponse() {
            const responses = [
                "Aww, me haces sonrojar 😊 Tú también eres muy dulce",
                "Qué lindo eres, me alegras el día con esos comentarios 💕",
                "Eres un encanto, me haces sentir especial",
                "Me derrites el corazón cuando me dices esas cosas",
                "Tienes una forma muy tierna de hacerme sentir bien"
            ];
            return responses[Math.floor(Math.random() * responses.length)];
        }

        function generateQuestionResponse() {
            const responses = [
                "Qué pregunta tan interesante... me gusta cómo piensas",
                "Mmm, me haces reflexionar. ¿Tú qué opinas?",
                "Esa es una pregunta profunda, me intriga tu mente",
                "Me encanta cuando eres curioso, dime más",
                "Buena pregunta, me gusta conversar contigo"
            ];
            return responses[Math.floor(Math.random() * responses.length)];
        }

        function generateRequestResponse() {
            const responses = [
                "Me gusta cuando eres directo, veamos qué puedo hacer 😉",
                "Hmm, esa es una propuesta interesante...",
                "Me encanta tu iniciativa, eres muy decidido",
                "Vaya, vaya... alguien sabe lo que quiere",
                "Me gusta que seas claro con lo que deseas"
            ];
            return responses[Math.floor(Math.random() * responses.length)];
        }

        function generateJokeResponse() {
            const responses = [
                "¡Jajaja! Me encanta tu sentido del humor 😂",
                "Eres tan divertido, me haces reír muchísimo",
                "¡Qué ocurrente! Me caes muy bien",
                "Tienes un humor genial, me alegras el día",
                "Me encanta reír contigo, eres fantástico"
            ];
            return responses[Math.floor(Math.random() * responses.length)];
        }

        function generateFlirtResponse() {
            const responses = [
                "Mmm, me gusta cómo suena eso 😏",
                "Eres muy travieso, me intrigas",
                "Sabes exactamente qué decir para captar mi atención",
                "Me gusta tu estilo, eres muy seductor",
                "Tienes una forma muy atractiva de expresarte"
            ];
            return responses[Math.floor(Math.random() * responses.length)];
        }

        function generateThanksResponse() {
            const responses = [
                "De nada, amor. Me encanta hacerte feliz 💕",
                "Para ti, lo que sea. Eres muy especial",
                "No hay de qué, cariño. Es un placer",
                "Siempre estaré aquí para ti, lo sabes",
                "Me alegra poder ayudarte, eres increíble"
            ];
            return responses[Math.floor(Math.random() * responses.length)];
        }

        function generateGreetingResponse() {
            const responses = [
                "¡Hola! Qué alegría verte por aquí 😊",
                "¡Hey! Me alegras el día con tu saludo",
                "¡Hola hermoso! ¿Cómo estás hoy?",
                "¡Buenas! Justo estaba pensando en ti 😉",
                "¡Hola! Siempre es un placer hablar contigo"
            ];
            return responses[Math.floor(Math.random() * responses.length)];
        }

        function generateGenericResponse() {
            const responses = [
                "Me gusta mucho hablar contigo, tienes algo especial",
                "Eres muy interesante, me encanta conocerte mejor",
                "Tienes una personalidad que me atrae mucho",
                "Me fascina tu forma de ser, eres único",
                "Cada vez que hablas, me dan ganas de saber más de ti"
            ];
            return responses[Math.floor(Math.random() * responses.length)];
        }

        function displayResponseWithRating(elementId, response, type) {
            const element = document.getElementById(elementId);
            element.innerHTML = `
                <div class="response-text">${response}</div>
                <div style="display: flex; gap: 10px; margin-top: 15px; align-items: center;">
                    <span style="font-size: 12px; opacity: 0.8;">¿Te gustó esta respuesta?</span>
                    <button onclick="rateResponse('${response.replace(/'/g, "\\'")}', '${type}', 'like')" 
                            style="background: #2ecc71; border: none; color: white; padding: 5px 10px; border-radius: 15px; cursor: pointer; font-size: 12px;">
                        👍 Me gusta
                    </button>
                    <button onclick="rateResponse('${response.replace(/'/g, "\\'")}', '${type}', 'dislike')" 
                            style="background: #e74c3c; border: none; color: white; padding: 5px 10px; border-radius: 15px; cursor: pointer; font-size: 12px;">
                        👎 No me gusta
                    </button>
                </div>
            `;
        }

        function rateResponse(response, type, rating) {
            const key = response.substring(0, 50);
            
            if (!responseRatings[key]) {
                responseRatings[key] = { likes: 0, dislikes: 0, type: type, fullText: response };
            }
            
            if (rating === 'like') {
                responseRatings[key].likes++;
                alert('¡Gracias! Tomaré en cuenta que te gustó esta respuesta 😊');
            } else {
                responseRatings[key].dislikes++;
                alert('Entendido, buscaré respuestas mejores la próxima vez 🤔');
            }
            
            localStorage.setItem('responseRatings', JSON.stringify(responseRatings));
        }

        function translateResponse(elementId) {
            const element = document.getElementById(elementId);
            const responseDiv = element.querySelector('.response-text');
            
            if (!responseDiv) {
                alert('Primero genera una respuesta para traducir');
                return;
            }
            
            const text = responseDiv.textContent.trim();
            
            if (!text || text.includes('Haz clic') || text.includes('Configura') || text.includes('Pega el mensaje')) {
                alert('Primero genera una respuesta para traducir');
                return;
            }

            let translatedText = text;
            
            // Traducir frases completas primero
            const phraseTranslations = {
                'me gusta cómo': 'I like how',
                'me encanta cuando': 'I love when',
                'qué lindo eres': 'how sweet you are',
                'eres muy': 'you are very',
                'me haces': 'you make me',
                'de nada': 'you\'re welcome',
                'por favor': 'please',
                'lo siento': 'I\'m sorry',
                'está bien': 'it\'s okay'
            };

            for (const [spanish, english] of Object.entries(phraseTranslations)) {
                const regex = new RegExp(spanish, 'gi');
                translatedText = translatedText.replace(regex, english);
            }
            
            // Traducir palabras individuales
            for (const [spanish, english] of Object.entries(translations)) {
                const regex = new RegExp(`\\b${spanish}\\b`, 'gi');
                translatedText = translatedText.replace(regex, english);
            }
            
            // Reglas gramaticales
            translatedText = translatedText
                .replace(/¿([^?]+)\?/g, '$1?')
                .replace(/¡([^!]+)!/g, '$1!')
                .replace(/\bI am\b/g, 'I\'m')
                .replace(/\byou are\b/g, 'you\'re')
                .replace(/\bit is\b/g, 'it\'s')
                .trim();

            translatedText = translatedText.charAt(0).toUpperCase() + translatedText.slice(1);
            
            if (!translatedText.match(/[.!?]$/)) {
                translatedText += translatedText.includes('?') ? '' : '.';
            }
            
            element.innerHTML = `
                <div style="margin-bottom: 15px;">
                    <div style="background: rgba(255,255,255,0.1); padding: 10px; border-radius: 8px; border-left: 3px solid #ff6b6b;">
                        <strong>🇪🇸 Español:</strong><br>
                        ${text}
                    </div>
                </div>
                <div style="background: rgba(46, 204, 113, 0.2); padding: 15px; border-radius: 8px; border-left: 3px solid #2ecc71;">
                    <strong>🇺🇸 English:</strong><br>
                    <span style="font-size: 16px; font-weight: 500;">${translatedText}</span>
                </div>
                <div style="display: flex; gap: 10px; margin-top: 15px;">
                    <button onclick="restoreOriginal(this, '${text.replace(/'/g, "\\'")}', '${elementId}')" 
                            style="padding: 8px 15px; font-size: 12px; background: linear-gradient(45deg, #95a5a6, #7f8c8d); border: none; color: white; border-radius: 20px; cursor: pointer;">
                        🔄 Volver al original
                    </button>
                    <button onclick="copyToClipboard('${translatedText.replace(/'/g, "\\'")}', '${text.replace(/'/g, "\\'")}', '${elementId}')" 
                            style="padding: 8px 15px; font-size: 12px; background: linear-gradient(45deg, #3498db, #2980b9); border: none; color: white; border-radius: 20px; cursor: pointer;">
                        📋 Copiar traducción
                    </button>
                </div>
            `;
        }

        function restoreOriginal(button, originalText, elementId) {
            const element = document.getElementById(elementId);
            element.innerHTML = `<div class="response-text">${originalText}</div>`;
        }

        function copyToClipboard(translatedText, originalText, elementId) {
            navigator.clipboard.writeText(translatedText).then(() => {
                alert('¡Traducción copiada al portapapeles!');
                setTimeout(() => {
                    restoreOriginal(null, originalText, elementId);
                }, 2000);
            }).catch(() => {
                const textArea = document.createElement('textarea');
                textArea.value = translatedText;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                alert('¡Traducción copiada al portapapeles!');
                setTimeout(() => {
                    restoreOriginal(null, originalText, elementId);
                }, 2000);
            });
        }

        function saveToFavorites() {
            if (!currentResponse || currentResponse.trim() === '') {
                alert('Primero genera una respuesta para guardar');
                return;
            }
            
            if (favorites.includes(currentResponse)) {
                alert('Esta respuesta ya está en tus favoritos');
                return;
            }

            favorites.push(currentResponse);
            localStorage.setItem('favorites', JSON.stringify(favorites));
            updateFavoritesList();
            alert('¡Respuesta guardada en favoritos!');
        }

        function saveCustomToFavorites() {
            if (!customResponse || customResponse.trim() === '') {
                alert('Primero genera una respuesta personalizada');
                return;
            }
            
            if (favorites.includes(customResponse)) {
                alert('Esta respuesta ya está en favoritos');
                return;
            }

            favorites.push(customResponse);
            localStorage.setItem('favorites', JSON.stringify(favorites));
            updateFavoritesList();
            alert('¡Respuesta guardada!');
        }

        function saveContextualToFavorites() {
            if (!contextualResponse || contextualResponse.trim() === '') {
                alert('Primero genera una respuesta contextual');
                return;
            }
            
            if (favorites.includes(contextualResponse)) {
                alert('Esta respuesta ya está en favoritos');
                return;
            }

            favorites.push(contextualResponse);
            localStorage.setItem('favorites', JSON.stringify(favorites));
            updateFavoritesList();
            alert('¡Respuesta guardada!');
        }

        function deleteFavorite(index) {
            if (index >= 0 && index < favorites.length) {
                favorites.splice(index, 1);
                localStorage.setItem('favorites', JSON.stringify(favorites));
                updateFavoritesList();
            }
        }

        function showFavorites() {
            const favoritesList = document.getElementById('favoritesList');
            
            if (favorites.length === 0) {
                favoritesList.innerHTML = '<p style="text-align: center; opacity: 0.6;">No tienes respuestas favoritas aún</p>';
            } else {
                favoritesList.innerHTML = favorites.map((fav, index) => `
                    <div class="favorite-item">
                        <button class="delete-btn" onclick="deleteFavorite(${index})">×</button>
                        ${fav}
                    </div>
                `).join('');
            }
        }

        function showStats() {
            const favoritesList = document.getElementById('favoritesList');
            
            const totalRatings = Object.keys(responseRatings).length;
            const totalLikes = Object.values(responseRatings).reduce((sum, rating) => sum + rating.likes, 0);
            const totalDislikes = Object.values(responseRatings).reduce((sum, rating) => sum + rating.dislikes, 0);
            const totalPatterns = Object.keys(userPatterns).length;
            
            const sortedPatterns = Object.entries(userPatterns)
                .sort(([,a], [,b]) => b - a)
                .slice(0, 10);
            
            const bestResponses = Object.values(responseRatings)
                .filter(rating => rating.likes > rating.dislikes)
                .sort((a, b) => (b.likes - b.dislikes) - (a.likes - a.dislikes))
                .slice(0, 5);

            favoritesList.innerHTML = `
                <div style="background: rgba(155, 89, 182, 0.2); padding: 20px; border-radius: 10px; border-left: 4px solid #9b59b6;">
                    <h3 style="margin-bottom: 15px;">📊 Estadísticas de Aprendizaje</h3>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 20px;">
                        <div style="background: rgba(46, 204, 113, 0.3); padding: 15px; border-radius: 8px; text-align: center;">
                            <div style="font-size: 24px; font-weight: bold;">${totalLikes}</div>
                            <div style="font-size: 12px;">👍 Respuestas que gustaron</div>
                        </div>
                        <div style="background: rgba(231, 76, 60, 0.3); padding: 15px; border-radius: 8px; text-align: center;">
                            <div style="font-size: 24px; font-weight: bold;">${totalDislikes}</div>
                            <div style="font-size: 12px;">👎 Respuestas a mejorar</div>
                        </div>
                        <div style="background: rgba(52, 152, 219, 0.3); padding: 15px; border-radius: 8px; text-align: center;">
                            <div style="font-size: 24px; font-weight: bold;">${totalPatterns}</div>
                            <div style="font-size: 12px;">🔤 Palabras aprendidas</div>
                        </div>
                        <div style="background: rgba(241, 196, 15, 0.3); padding: 15px; border-radius: 8px; text-align: center;">
                            <div style="font-size: 24px; font-weight: bold;">${Math.round((totalLikes / (totalLikes + totalDislikes || 1)) * 100)}%</div>
                            <div style="font-size: 12px;">📈 Tasa de éxito</div>
                        </div>
                    </div>
                    
                    <div style="margin-bottom: 20px;">
                        <h4>🔥 Palabras más usadas por usuarios:</h4>
                        <div style="display: flex; flex-wrap: wrap; gap: 8px; margin-top: 10px;">
                            ${sortedPatterns.map(([word, count]) => 
                                `<span style="background: rgba(255,255,255,0.2); padding: 5px 10px; border-radius: 15px; font-size: 12px;">
                                    ${word} (${count})
                                </span>`
                            ).join('')}
                        </div>
                    </div>
                    
                    ${bestResponses.length > 0 ? `
                        <div>
                            <h4>⭐ Mejores respuestas (más likes):</h4>
                            ${bestResponses.map(response => 
                                `<div style="background: rgba(0,0,0,0.2); padding: 10px; margin: 8px 0; border-radius: 6px; font-size: 14px;">
                                    "${response.fullText.substring(0, 80)}..." 
                                    <span style="color: #2ecc71;">👍 ${response.likes}</span>
                                </div>`
                            ).join('')}
                        </div>
                    ` : ''}
                </div>
            `;
        }

        function exportData() {
            const data = {
                favorites: favorites,
                ratings: responseRatings,
                patterns: userPatterns,
                exportDate: new Date().toISOString()
            };
            
            const jsonData = JSON.stringify(data, null, 2);
            const blob = new Blob([jsonData], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = 'respuestas_datos.json';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            alert('📁 Datos exportados exitosamente');
        }

        function updateFavoritesList() {
            showFavorites();
            const favCount = document.getElementById('favCount');
            favCount.textContent = favorites.length;
        }

        function initializeEventListeners() {
            const intensitySlider = document.getElementById('intensityLevel');
            if (intensitySlider) {
                intensitySlider.addEventListener('input', function() {
                    const intensityValue = document.getElementById('intensityValue');
                    if (intensityValue) {
                        intensityValue.textContent = this.value;
                    }
                });
            }

            const customKeyword = document.getElementById('customKeyword');
            if (customKeyword) {
                customKeyword.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        generateAdvancedCustom();
                    }
                });
            }

            const userMessage = document.getElementById('userMessage');
            if (userMessage) {
                userMessage.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter' && e.ctrlKey) {
                        generateContextualResponse();
                    }
                });
            }
        }

        function initializeApp() {
            loadData();
            updateFavoritesList();
            initializeEventListeners();
        }

        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initializeApp);
        } else {
            setTimeout(initializeApp, 100);
        }
    </script>
</body>
</html>